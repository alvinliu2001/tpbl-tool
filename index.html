<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Title -->
    <title>TPBL | ç¤¾ç¾¤æ–‡æ¡ˆç”Ÿæˆå·¥å…·</title>
    <meta name="description" content="TPBL è·ç±ƒè¯ç›Ÿç¤¾ç¾¤æ–‡æ¡ˆè‡ªå‹•ç”Ÿæˆèˆ‡ç®¡ç†å·¥å…·">
    
    <!-- Favicon -->
    <link rel="icon" href="https://tpbl.basketball/favicon.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/alvinliu2001/tpbl-tool/refs/heads/main/apple-touch-icon.png">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Sidebar Styles */
        .sidebar-item.active { background-color: #D8BF98; color: #19191A; font-weight: 700; }
        .sidebar-item:hover { color: #ffffff !important; }

        /* Scrollbar Hiding */
        ::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Custom Colors */
        .text-brand-gold { color: #D8BF98; }
        .bg-brand-dark { background-color: #19191A; }
        .bg-brand-gold { background-color: #D8BF98; }
        .border-brand-gold { border-color: #D8BF98; }
        .focus-ring-gold:focus { --tw-ring-color: #D8BF98; }

        /* Disabled Input Style */
        .disabled-input { background-color: #f3f4f6; cursor: not-allowed; color: #9ca3af; }
        input[readonly] { background-color: #f3f4f6; color: #4b5563; }

        /* Custom Select */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem !important;
        }

        /* Date Input Fixes */
        input[type="date"] {
            -webkit-appearance: none;
            appearance: none;
            background-color: white;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            font-family: 'Noto Sans TC', sans-serif;
            display: block;
            text-align: left;
        }
        /* Mobile-only min-height for touch targets */
        @media (max-width: 768px) {
            input[type="date"] {
                min-height: 2.75rem;
            }
        }
        /* Fix for iOS date alignment */
        input[type="date"]::-webkit-date-and-time-value { text-align: left; }

        /* Animations */
        .fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-out;
            pointer-events: none;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Status Indicator */
        #sync-status {
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        /* Prevent body scroll when menu is bouncing */
        #sidebar-nav {
            overscroll-behavior: contain;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#19191A',
                            gold: '#D8BF98',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-800 h-screen overflow-hidden">

    <!-- LANDING PAGE -->
    <div id="landing-page" class="fixed inset-0 z-50 bg-brand-dark flex flex-col md:flex-row overflow-hidden">
        <!-- Left Side: Content -->
        <div class="w-full md:w-1/2 h-full flex flex-col justify-center px-8 md:px-24 relative z-10 bg-brand-dark overflow-y-auto">
            <div class="flex-1 flex flex-col justify-center min-h-[400px]">
                <!-- Logo -->
                <div class="mb-6 flex justify-start">
                    <img src="https://raw.githubusercontent.com/alvinliu2001/tpbl-tool/refs/heads/main/tpbl-logo-white.png" alt="TPBL Logo" class="h-10 md:h-12 w-auto">
                </div>
                <!-- Title -->
                <h1 class="text-3xl md:text-4xl font-semibold text-white mb-3 tracking-wide text-left">ç¤¾ç¾¤æ–‡æ¡ˆç”Ÿæˆå·¥å…·</h1>
                <p class="text-gray-400 text-lg md:text-xl mb-10 font-extralight text-left">ä¸€å€‹ç°¡å–®å¯¦ç”¨çš„å·¥å…·ï¼Œå¹«åŠ©åœ˜éšŠé«˜æ•ˆç”¢å‡ºæ–‡æ¡ˆã€‚</p>
                <!-- Button -->
                <div class="flex justify-start">
                    <button onclick="enterApp()" class="bg-brand-gold text-brand-dark text-lg font-bold py-3 px-12 rounded-full hover:bg-white hover:scale-105 transition-all duration-300 shadow-lg flex items-center gap-2">
                        é–‹å§‹ä½¿ç”¨ <span>â†’</span>
                    </button>
                </div>
            </div>
            <!-- Footer -->
            <div class="py-6 w-full flex flex-col items-center justify-center text-gray-600 text-xs md:text-sm flex-shrink-0">
                <p>powered by Alvin LIU</p>
                <p class="mt-1">Â© TPBL 2025 All rights reserved.</p>
            </div>
        </div>
        <!-- Right Side: Image -->
        <div class="hidden md:block w-1/2 h-full relative">
             <img src="https://assets.tpbl.basketball/production/banners/kl3My9saHVdhrTmoezJC3Am9KyBrMzgES3lVQYm2.jpg?20250930145249" alt="TPBL Season Visual" class="w-full h-full object-cover opacity-90">
            <div class="absolute inset-0 bg-black/10"></div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-container" class="hidden w-full h-full flex flex-col md:flex-row overflow-hidden fixed inset-0 z-0">
        <!-- Sidebar -->
        <aside class="w-full md:w-64 bg-brand-dark text-gray-400 flex flex-col flex-shrink-0 md:h-full z-50 relative shadow-lg md:shadow-none">
            <!-- Sidebar Header -->
            <div id="sidebar-header" class="p-4 md:p-6 border-b border-gray-800 flex justify-between items-center bg-brand-dark z-50 relative flex-shrink-0">
                <div class="flex items-center gap-3">
                    <div id="logo-container" onclick="location.reload()" class="cursor-pointer" title="è¿”å›é¦–é ">
                        <img src="https://raw.githubusercontent.com/alvinliu2001/tpbl-tool/refs/heads/main/tpbl-logo-white.png" alt="TPBL Logo" class="h-6 md:h-7 w-auto">
                    </div>
                </div>
                <!-- Mobile Menu Button -->
                <button onclick="toggleSidebar()" class="md:hidden bg-white text-black rounded-full w-8 h-8 flex items-center justify-center focus:outline-none hover:bg-gray-100 transition shadow-sm z-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 9h16M4 15h16" />
                    </svg>
                </button>
            </div>
            
            <!-- Sidebar Nav -->
            <nav id="sidebar-nav" class="flex flex-col py-4 space-y-1 bg-brand-dark absolute md:static w-full top-full left-0 shadow-xl md:shadow-none transition-all duration-500 ease-in-out z-40 origin-top max-h-0 opacity-0 overflow-hidden md:max-h-full md:opacity-100 md:h-full">
                <div class="flex-1 overflow-y-auto w-full">
                    <div class="px-4 py-2 text-xs font-bold text-gray-600 uppercase tracking-wider">è³½å‰é ç†±</div>
                    <button onclick="switchMode('weekday_preview')" id="btn-weekday_preview" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-calendar-day w-6 text-center"></i> å¹³æ—¥è³½äº‹é å‘Š</button>
                    <button onclick="switchMode('game_preview')" id="btn-game_preview" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-fire w-6 text-center"></i> å–®å ´è³½ç¨‹é å‘Š</button>
                    <button onclick="switchMode('weekly_schedule')" id="btn-weekly_schedule" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-calendar-week w-6 text-center"></i> æ¯é€±è³½ç¨‹è¡¨</button>
                    <button onclick="switchMode('matchup_highlight')" id="btn-matchup_highlight" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-bullseye w-6 text-center"></i> è³½å‰å°æˆ°äº®é»</button>

                    <div class="px-4 py-2 mt-4 text-xs font-bold text-gray-600 uppercase tracking-wider">è³½äº‹é€²è¡Œ / è³½å¾Œ</div>
                    <button onclick="switchMode('final_score')" id="btn-final_score" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-flag-checkered w-6 text-center"></i> çµ‚å ´æ¯”åˆ†</button>
                    <button onclick="switchMode('game_highlight')" id="btn-game_highlight" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-film w-6 text-center"></i> æœ¬å ´è³½äº‹ç²¾è¯</button>
                    <button onclick="switchMode('press_conf')" id="btn-press_conf" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-microphone w-6 text-center"></i> è³½å¾Œè¨˜è€…æœƒ</button>
                    <button onclick="switchMode('potg')" id="btn-potg" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-bolt w-6 text-center"></i> å–®å ´æœ€ä½³çƒå“¡</button>
                    <button onclick="switchMode('local_player_highlight')" id="btn-local_player_highlight" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-star w-6 text-center"></i> æœ¬åœŸçƒå“¡å–®å ´å‚‘å‡ºè¡¨ç¾</button>
                    <button onclick="switchMode('career_milestone')" id="btn-career_milestone" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-crown w-6 text-center"></i> çƒå“¡ç”Ÿæ¶¯ç´€éŒ„</button>

                    <div class="px-4 py-2 mt-4 text-xs font-bold text-gray-600 uppercase tracking-wider">æ¯é€±ç¸½çµ</div>
                    <button onclick="switchMode('weekly_standings')" id="btn-weekly_standings" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-list-ol w-6 text-center"></i> æ¯é€±æˆ°ç¸¾æ’è¡Œ</button>
                    <button onclick="switchMode('top5')" id="btn-top5" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-video w-6 text-center"></i> æœ¬é€±äº”å¤§å¥½çƒ</button>
                    <button onclick="switchMode('potw')" id="btn-potw" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-trophy w-6 text-center"></i> å–®é€±æœ€ä½³çƒå“¡</button>
                    <button onclick="switchMode('weekly_local_eff')" id="btn-weekly_local_eff" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-chart-line w-6 text-center"></i> æ¯é€±æœ¬åœŸæ•ˆç‡å€¼æ’è¡Œ</button>

                    <div class="px-4 py-2 mt-4 text-xs font-bold text-gray-600 uppercase tracking-wider">å°ˆé¡Œ / å…¶ä»–</div>
                    <button onclick="switchMode('nb_moments')" id="btn-nb_moments" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-camera w-6 text-center"></i> Nothing But Moments</button>
                    <button onclick="switchMode('100_reasons')" id="btn-100_reasons" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-heart w-6 text-center"></i> ä¸€ç™¾ç¨®å–œæ­¡ç±ƒçƒçš„åŸå› </button>
                    <button onclick="switchMode('monthly_kicks')" id="btn-monthly_kicks" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-shoe-prints w-6 text-center"></i> æ¯æœˆç²¾é¸å¯¦æˆ°çƒé‹</button>
                    <button onclick="switchMode('season_stats')" id="btn-season_stats" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-chart-simple w-6 text-center"></i> æ•¸æ“šç´¯è¨ˆæ’è¡Œ</button>
                </div>

                <!-- Sync Status -->
                <div class="p-4 mt-auto border-t border-gray-800 md:border-0 flex-shrink-0">
                    <div id="sync-status" class="bg-gray-800 text-gray-400">
                        <i class="fa-solid fa-check mr-1"></i> ç³»çµ±å°±ç·’ (æœ¬åœ°è³‡æ–™åº«)
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col md:flex-row relative overflow-y-auto md:overflow-hidden w-full h-full">
            
            <!-- Input Area -->
            <div class="flex-1 p-4 md:p-8 bg-white md:h-full md:overflow-y-auto" id="input-container">
                <div class="max-w-2xl mx-auto pb-10 md:pb-0">
                    <h2 id="current-title" class="text-xl md:text-2xl font-bold mb-6 text-gray-800 border-l-4 border-brand-gold pl-4 flex items-center gap-3">
                        <span id="title-text">è«‹é¸æ“‡åŠŸèƒ½</span>
                        <a id="example-link" href="#" target="_blank" class="text-gray-400 hover:text-brand-gold transition hidden" title="æŸ¥çœ‹ç¯„ä¾‹è²¼æ–‡">
                            â†—ï¸
                        </a>
                    </h2>
                    
                    <div id="dynamic-form" class="space-y-5">
                        <p class="text-gray-500">è«‹å¾å·¦å´é¸å–®é¸æ“‡æ‚¨è¦ç”Ÿæˆçš„è²¼æ–‡é¡å‹ã€‚</p>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-100">
                        <div class="flex justify-between items-center mb-2">
                             <button onclick="clearCacheAndReset()" class="text-xs text-red-400 hover:text-red-600 font-medium transition flex items-center gap-1 focus:outline-none">
                                <i class="fa-solid fa-rotate-right"></i> é‡ç½®/æ¸…é™¤æš«å­˜
                             </button>
                             <span id="last-saved-time" class="text-xs text-gray-400 transition-opacity duration-500 opacity-0"></span>
                        </div>
                        <button onclick="generateCopy()" class="w-full bg-brand-dark hover:bg-brand-gold hover:text-brand-dark text-white font-bold py-4 px-6 rounded-lg transition duration-200 flex justify-center items-center gap-2 shadow-lg">
                            <span>ç”Ÿæˆæ–‡æ¡ˆ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Output Area -->
            <div class="w-full md:w-1/3 bg-gray-100 p-6 flex flex-col border-t md:border-t-0 md:border-l border-gray-200">
                <h3 class="text-lg font-bold mb-4 text-gray-700 flex items-center gap-2">
                    é è¦½çµæœ
                </h3>
                <textarea id="output-text" class="flex-1 w-full p-4 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-brand-gold bg-white leading-relaxed h-64 md:h-auto" placeholder="æ–‡æ¡ˆå°‡é¡¯ç¤ºæ–¼æ­¤..."></textarea>
                
                <button onclick="copyToClipboard()" class="mt-4 w-full bg-white border-2 border-gray-200 hover:border-brand-dark text-gray-800 font-bold py-3 px-4 rounded-lg transition duration-200 flex justify-center items-center gap-2">
                    <span id="copy-text">ä¸€éµè¤‡è£½</span>
                </button>

                <!-- Footer in Main App -->
                <div class="mt-6 text-center text-gray-400 text-xs">
                    <p>powered by Alvin LIU</p>
                    <p class="mt-1">Â© TPBL 2025 All rights reserved.</p>
                </div>
            </div>

        </main>
    </div>
    
    <!-- JavaScript Logic -->
    <script>
        // --- Enter App from Landing Page ---
        function enterApp() {
            const landing = document.getElementById('landing-page');
            const app = document.getElementById('app-container');
            landing.classList.add('fade-out');
            setTimeout(() => {
                landing.style.display = 'none';
                app.classList.remove('hidden');
                app.classList.add('fade-in');
                window.scrollTo(0, 0);
            }, 500);
        }

        // --- Mobile Sidebar Toggle ---
        function toggleSidebar() {
            const nav = document.getElementById('sidebar-nav');
            const header = document.getElementById('sidebar-header');
            const headerHeight = header.offsetHeight;
            const availableHeight = window.innerHeight - headerHeight;
            
            if (nav.classList.contains('max-h-0')) {
                nav.classList.remove('max-h-0', 'opacity-0', 'overflow-hidden');
                nav.style.maxHeight = availableHeight + 'px';
                nav.classList.add('opacity-100', 'overflow-y-auto');
            } else {
                nav.style.maxHeight = '0px'; 
                nav.classList.add('max-h-0', 'opacity-0', 'overflow-hidden');
                nav.classList.remove('opacity-100');
                nav.classList.remove('h-full');
            }
        }
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                const nav = document.getElementById('sidebar-nav');
                nav.style.maxHeight = '';
                nav.classList.remove('max-h-0', 'opacity-0', 'overflow-hidden'); 
                nav.classList.add('opacity-100');
            }
        });

        // --- Data & Config ---
        const TEAMS = {
            "æˆ°ç¥": { full: "è‡ºåŒ—å°æ–°æˆ°ç¥", emoji: "ğŸ›¡ï¸", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            "æ”»åŸç…": { full: "æ–°ç«¹å¾¡åµ¿æ”»åŸç…", emoji: "ğŸ¦", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            "ç‰¹æ”»": { full: "æ–°åŒ—ä¸­ä¿¡ç‰¹æ”»", emoji: "âš¡ï¸", arena: "æ–°èŠé«”è‚²é¤¨" },
            "åœ‹ç‹": { full: "æ–°åŒ—åœ‹ç‹", emoji: "ğŸ‘‘", arena: "æ–°èŠé«”è‚²é¤¨" },
            "å¤¢æƒ³å®¶": { full: "ç¦çˆ¾æ‘©æ²™å¤¢æƒ³å®¶", emoji: "ğŸ¦„", arena: "æ´²éš›è¿·ä½ è›‹" },
            "æµ·ç¥": { full: "é«˜é›„å…¨å®¶æµ·ç¥", emoji: "ğŸ”±", arena: "é«˜é›„å·¨è›‹" },
            "é›²è±¹": { full: "æ¡ƒåœ’å°å•¤æ°¸è±é›²è±¹", emoji: "ğŸ†", arena: "æ¡ƒåœ’å·¨è›‹" }
        };
        const TEAM_KEYS = Object.keys(TEAMS);
        
        // --- BUILT-IN FALLBACK DATA ---
        const DEFAULT_SCHEDULE = [
            { id: 1, date: "2025-10-11", time: "17:00", home: "åœ‹ç‹", away: "æµ·ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 126, date: "2026-05-03", time: "17:00", home: "åœ‹ç‹", away: "ç‰¹æ”»", arena: "æ–°èŠé«”è‚²é¤¨" }
        ];
        
        // Re-injecting full schedule for robustness
        let SEASON_SCHEDULE_DB = [
            { id: 1, date: "2025-10-11", time: "17:00", home: "åœ‹ç‹", away: "æµ·ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 2, date: "2025-10-12", time: "17:00", home: "åœ‹ç‹", away: "å¤¢æƒ³å®¶", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 3, date: "2025-10-18", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æµ·ç¥", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 4, date: "2025-10-18", time: "17:00", home: "åœ‹ç‹", away: "ç‰¹æ”»", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 5, date: "2025-10-19", time: "14:30", home: "å¤¢æƒ³å®¶", away: "é›²è±¹", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 6, date: "2025-10-19", time: "17:00", home: "åœ‹ç‹", away: "æˆ°ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 7, date: "2025-10-25", time: "14:30", home: "æµ·ç¥", away: "åœ‹ç‹", arena: "é«˜é›„å·¨è›‹" },
            { id: 8, date: "2025-10-25", time: "17:00", home: "ç‰¹æ”»", away: "æˆ°ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 9, date: "2025-10-26", time: "14:30", home: "æµ·ç¥", away: "æ”»åŸç…", arena: "é«˜é›„å·¨è›‹" },
            { id: 10, date: "2025-10-26", time: "17:00", home: "ç‰¹æ”»", away: "é›²è±¹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 11, date: "2025-10-29", time: "19:00", home: "æµ·ç¥", away: "å¤¢æƒ³å®¶", arena: "é«˜é›„å·¨è›‹" },
            { id: 12, date: "2025-11-01", time: "14:30", home: "æµ·ç¥", away: "æˆ°ç¥", arena: "é«˜é›„å·¨è›‹" },
            { id: 13, date: "2025-11-01", time: "17:00", home: "ç‰¹æ”»", away: "å¤¢æƒ³å®¶", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 14, date: "2025-11-02", time: "14:30", home: "æµ·ç¥", away: "é›²è±¹", arena: "é«˜é›„å·¨è›‹" },
            { id: 15, date: "2025-11-02", time: "17:00", home: "ç‰¹æ”»", away: "æ”»åŸç…", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 16, date: "2025-11-05", time: "19:00", home: "å¤¢æƒ³å®¶", away: "æ”»åŸç…", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 17, date: "2025-11-07", time: "19:00", home: "å¤¢æƒ³å®¶", away: "ç‰¹æ”»", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 18, date: "2025-11-08", time: "14:30", home: "åœ‹ç‹", away: "æ”»åŸç…", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 19, date: "2025-11-08", time: "17:00", home: "é›²è±¹", away: "æˆ°ç¥", arena: "æ¡ƒåœ’å·¨è›‹" },
            { id: 20, date: "2025-11-09", time: "14:30", home: "åœ‹ç‹", away: "æµ·ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 21, date: "2025-11-09", time: "17:00", home: "é›²è±¹", away: "ç‰¹æ”»", arena: "æ¡ƒåœ’å·¨è›‹" },
            { id: 22, date: "2025-11-12", time: "19:00", home: "åœ‹ç‹", away: "å¤¢æƒ³å®¶", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 23, date: "2025-11-15", time: "14:30", home: "æ”»åŸç…", away: "ç‰¹æ”»", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 24, date: "2025-11-15", time: "17:00", home: "æˆ°ç¥", away: "åœ‹ç‹", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 25, date: "2025-11-16", time: "14:30", home: "æ”»åŸç…", away: "æµ·ç¥", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 26, date: "2025-11-16", time: "17:00", home: "æˆ°ç¥", away: "é›²è±¹", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 27, date: "2025-11-19", time: "19:00", home: "é›²è±¹", away: "æµ·ç¥", arena: "æ¡ƒåœ’å·¨è›‹" },
            { id: 28, date: "2025-11-22", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æ”»åŸç…", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 29, date: "2025-11-22", time: "17:00", home: "é›²è±¹", away: "åœ‹ç‹", arena: "æ¡ƒåœ’å·¨è›‹" },
            { id: 30, date: "2025-11-23", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æˆ°ç¥", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 31, date: "2025-11-23", time: "17:00", home: "é›²è±¹", away: "ç‰¹æ”»", arena: "æ¡ƒåœ’å·¨è›‹" },
            { id: 32, date: "2025-12-03", time: "19:00", home: "æˆ°ç¥", away: "æ”»åŸç…", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 33, date: "2025-12-06", time: "14:30", home: "é›²è±¹", away: "æ”»åŸç…", arena: "æ¡ƒåœ’å·¨è›‹" },
            { id: 34, date: "2025-12-06", time: "17:00", home: "æˆ°ç¥", away: "ç‰¹æ”»", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 35, date: "2025-12-07", time: "14:30", home: "é›²è±¹", away: "å¤¢æƒ³å®¶", arena: "æ¡ƒåœ’å·¨è›‹" },
            { id: 36, date: "2025-12-07", time: "17:00", home: "æˆ°ç¥", away: "æµ·ç¥", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 37, date: "2025-12-13", time: "14:30", home: "æµ·ç¥", away: "æ”»åŸç…", arena: "é«˜é›„å·¨è›‹" },
            { id: 38, date: "2025-12-13", time: "17:00", home: "ç‰¹æ”»", away: "é›²è±¹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 39, date: "2025-12-14", time: "14:30", home: "æµ·ç¥", away: "å¤¢æƒ³å®¶", arena: "é«˜é›„å·¨è›‹" },
            { id: 40, date: "2025-12-14", time: "17:00", home: "ç‰¹æ”»", away: "åœ‹ç‹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 41, date: "2025-12-20", time: "14:30", home: "åœ‹ç‹", away: "é›²è±¹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 42, date: "2025-12-20", time: "17:00", home: "æ”»åŸç…", away: "å¤¢æƒ³å®¶", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 43, date: "2025-12-21", time: "14:30", home: "åœ‹ç‹", away: "ç‰¹æ”»", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 44, date: "2025-12-21", time: "17:00", home: "æ”»åŸç…", away: "æˆ°ç¥", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 45, date: "2025-12-24", time: "19:00", home: "æ”»åŸç…", away: "é›²è±¹", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 46, date: "2025-12-27", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æˆ°ç¥", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 47, date: "2025-12-27", time: "17:00", home: "åœ‹ç‹", away: "æ”»åŸç…", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 48, date: "2025-12-28", time: "14:30", home: "å¤¢æƒ³å®¶", away: "ç‰¹æ”»", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 49, date: "2025-12-28", time: "17:00", home: "åœ‹ç‹", away: "æµ·ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 50, date: "2025-12-31", time: "19:00", home: "ç‰¹æ”»", away: "åœ‹ç‹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 51, date: "2026-01-03", time: "14:30", home: "æµ·ç¥", away: "é›²è±¹", arena: "é«˜é›„å·¨è›‹" },
            { id: 52, date: "2026-01-03", time: "17:00", home: "ç‰¹æ”»", away: "æ”»åŸç…", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 53, date: "2026-01-04", time: "14:30", home: "æµ·ç¥", away: "åœ‹ç‹", arena: "é«˜é›„å·¨è›‹" },
            { id: 54, date: "2026-01-04", time: "17:00", home: "ç‰¹æ”»", away: "å¤¢æƒ³å®¶", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 55, date: "2026-01-07", time: "19:00", home: "æµ·ç¥", away: "æˆ°ç¥", arena: "é«˜é›„å·¨è›‹" },
            { id: 56, date: "2026-01-09", time: "19:00", home: "é›²è±¹", away: "åœ‹ç‹", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 57, date: "2026-01-10", time: "14:30", home: "æµ·ç¥", away: "ç‰¹æ”»", arena: "é«˜é›„å·¨è›‹" },
            { id: 58, date: "2026-01-10", time: "17:00", home: "æˆ°ç¥", away: "å¤¢æƒ³å®¶", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 59, date: "2026-01-11", time: "14:30", home: "æµ·ç¥", away: "æ”»åŸç…", arena: "é«˜é›„å·¨è›‹" },
            { id: 60, date: "2026-01-11", time: "17:00", home: "æˆ°ç¥", away: "é›²è±¹", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 61, date: "2026-01-17", time: "14:30", home: "å¤¢æƒ³å®¶", away: "åœ‹ç‹", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 62, date: "2026-01-17", time: "17:00", home: "æˆ°ç¥", away: "ç‰¹æ”»", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 63, date: "2026-01-18", time: "14:30", home: "å¤¢æƒ³å®¶", away: "é›²è±¹", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 64, date: "2026-01-18", time: "17:00", home: "æˆ°ç¥", away: "æ”»åŸç…", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 65, date: "2026-01-24", time: "14:30", home: "ç‰¹æ”»", away: "æµ·ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 66, date: "2026-01-24", time: "17:00", home: "æ”»åŸç…", away: "å¤¢æƒ³å®¶", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 67, date: "2026-01-25", time: "14:30", home: "ç‰¹æ”»", away: "æˆ°ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 68, date: "2026-01-25", time: "17:00", home: "æ”»åŸç…", away: "åœ‹ç‹", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 69, date: "2026-01-31", time: "17:00", home: "é›²è±¹", away: "æ”»åŸç…", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 70, date: "2026-01-31", time: "17:00", home: "å¤¢æƒ³å®¶", away: "åœ‹ç‹", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 71, date: "2026-02-01", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æµ·ç¥", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 72, date: "2026-02-01", time: "17:00", home: "é›²è±¹", away: "æˆ°ç¥", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 73, date: "2026-02-07", time: "14:30", home: "æµ·ç¥", away: "é›²è±¹", arena: "é«˜é›„å·¨è›‹" },
            { id: 74, date: "2026-02-07", time: "17:00", home: "æˆ°ç¥", away: "åœ‹ç‹", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 75, date: "2026-02-08", time: "14:30", home: "æµ·ç¥", away: "ç‰¹æ”»", arena: "é«˜é›„å·¨è›‹" },
            { id: 76, date: "2026-02-08", time: "17:00", home: "æˆ°ç¥", away: "å¤¢æƒ³å®¶", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 77, date: "2026-02-11", time: "19:00", home: "æˆ°ç¥", away: "æµ·ç¥", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 78, date: "2026-02-14", time: "14:30", home: "åœ‹ç‹", away: "æˆ°ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 79, date: "2026-02-14", time: "17:00", home: "é›²è±¹", away: "å¤¢æƒ³å®¶", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 80, date: "2026-02-15", time: "14:30", home: "åœ‹ç‹", away: "æ”»åŸç…", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 81, date: "2026-02-15", time: "17:00", home: "é›²è±¹", away: "ç‰¹æ”»", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 82, date: "2026-03-04", time: "19:00", home: "åœ‹ç‹", away: "é›²è±¹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 83, date: "2026-03-06", time: "19:00", home: "åœ‹ç‹", away: "æˆ°ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 84, date: "2026-03-07", time: "14:30", home: "æµ·ç¥", away: "å¤¢æƒ³å®¶", arena: "é«˜é›„å·¨è›‹" },
            { id: 85, date: "2026-03-07", time: "17:00", home: "é›²è±¹", away: "æ”»åŸç…", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 86, date: "2026-03-08", time: "14:30", home: "æµ·ç¥", away: "ç‰¹æ”»", arena: "é«˜é›„å·¨è›‹" },
            { id: 87, date: "2026-03-08", time: "17:00", home: "é›²è±¹", away: "åœ‹ç‹", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 88, date: "2026-03-11", time: "19:00", home: "æ”»åŸç…", away: "æˆ°ç¥", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 89, date: "2026-03-14", time: "14:30", home: "å¤¢æƒ³å®¶", away: "ç‰¹æ”»", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 90, date: "2026-03-14", time: "17:00", home: "æ”»åŸç…", away: "æµ·ç¥", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 91, date: "2026-03-15", time: "14:30", home: "å¤¢æƒ³å®¶", away: "é›²è±¹", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 92, date: "2026-03-15", time: "17:00", home: "æ”»åŸç…", away: "åœ‹ç‹", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 93, date: "2026-03-21", time: "14:30", home: "ç‰¹æ”»", away: "æµ·ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 94, date: "2026-03-21", time: "17:00", home: "æˆ°ç¥", away: "é›²è±¹", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 95, date: "2026-03-22", time: "14:30", home: "ç‰¹æ”»", away: "æ”»åŸç…", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 96, date: "2026-03-22", time: "17:00", home: "æˆ°ç¥", away: "å¤¢æƒ³å®¶", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 97, date: "2026-03-25", time: "19:00", home: "å¤¢æƒ³å®¶", away: "æµ·ç¥", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 98, date: "2026-03-27", time: "19:00", home: "å¤¢æƒ³å®¶", away: "åœ‹ç‹", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 99, date: "2026-03-28", time: "14:30", home: "æ”»åŸç…", away: "ç‰¹æ”»", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 100, date: "2026-03-28", time: "17:00", home: "æˆ°ç¥", away: "æµ·ç¥", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 101, date: "2026-03-29", time: "14:30", home: "æ”»åŸç…", away: "é›²è±¹", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 102, date: "2026-03-29", time: "17:00", home: "æˆ°ç¥", away: "åœ‹ç‹", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 103, date: "2026-04-01", time: "19:00", home: "ç‰¹æ”»", away: "æˆ°ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 104, date: "2026-04-04", time: "14:30", home: "ç‰¹æ”»", away: "å¤¢æƒ³å®¶", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 105, date: "2026-04-04", time: "17:00", home: "é›²è±¹", away: "æµ·ç¥", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 106, date: "2026-04-05", time: "14:30", home: "ç‰¹æ”»", away: "åœ‹ç‹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 107, date: "2026-04-05", time: "17:00", home: "é›²è±¹", away: "æˆ°ç¥", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 108, date: "2026-04-08", time: "19:00", home: "æ”»åŸç…", away: "ç‰¹æ”»", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 109, date: "2026-04-11", time: "14:30", home: "æµ·ç¥", away: "åœ‹ç‹", arena: "é«˜é›„å·¨è›‹" },
            { id: 110, date: "2026-04-11", time: "17:00", home: "æ”»åŸç…", away: "é›²è±¹", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 111, date: "2026-04-12", time: "14:30", home: "æµ·ç¥", away: "æˆ°ç¥", arena: "é«˜é›„å·¨è›‹" },
            { id: 112, date: "2026-04-12", time: "17:00", home: "æ”»åŸç…", away: "å¤¢æƒ³å®¶", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 113, date: "2026-04-18", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æˆ°ç¥", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 114, date: "2026-04-18", time: "17:00", home: "ç‰¹æ”»", away: "é›²è±¹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 115, date: "2026-04-19", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æ”»åŸç…", arena: "è‡ºä¸­æ´²éš›è¿·ä½ è›‹" },
            { id: 116, date: "2026-04-19", time: "17:00", home: "ç‰¹æ”»", away: "æµ·ç¥", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 117, date: "2026-04-24", time: "19:00", home: "åœ‹ç‹", away: "å¤¢æƒ³å®¶", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 118, date: "2026-04-25", time: "14:30", home: "é›²è±¹", away: "æµ·ç¥", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 119, date: "2026-04-25", time: "17:00", home: "æˆ°ç¥", away: "æ”»åŸç…", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 120, date: "2026-04-26", time: "14:30", home: "é›²è±¹", away: "å¤¢æƒ³å®¶", arena: "å¥è¡Œç§‘å¤§é«”è‚²é¤¨" },
            { id: 121, date: "2026-04-26", time: "17:00", home: "æˆ°ç¥", away: "ç‰¹æ”»", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            { id: 122, date: "2026-04-29", time: "19:00", home: "æ”»åŸç…", away: "åœ‹ç‹", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 123, date: "2026-05-02", time: "14:30", home: "æ”»åŸç…", away: "æˆ°ç¥", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 124, date: "2026-05-02", time: "17:00", home: "åœ‹ç‹", away: "é›²è±¹", arena: "æ–°èŠé«”è‚²é¤¨" },
            { id: 125, date: "2026-05-03", time: "14:30", home: "æ”»åŸç…", away: "æµ·ç¥", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            { id: 126, date: "2026-05-03", time: "17:00", home: "åœ‹ç‹", away: "ç‰¹æ”»", arena: "æ–°èŠé«”è‚²é¤¨" }
        ];

        // Roster Data - Fallback (Full DB for Local First)
        let ROSTERS = {
            "æ”»åŸç…": [
                {name: "æ¢ç€š", num: "25"}, {name: "æå®¶ç‘", num: "12"}, {name: "æœ±é›²è±ª", num: "8"}, {name: "ç”°æµ©", num: "9"},
                {name: "ææ¼¢æ˜‡", num: "0"}, {name: "è•­é †è­°", num: "11"}, {name: "è”¡å®¸ç¶±", num: "17"}, {name: "ç›§å† è»’", num: "42"},
                {name: "å…‹é›·æ ¼", num: "3"}, {name: "å¸•å¡ç…", num: "18"}, {name: "æå•“ç‘‹", num: "75"}, {name: "é«˜åœ‹è±ª", num: "4"},
                {name: "æå‚‘", num: "22"}, {name: "åŠ‰ä¸å‹³", num: "10"}, {name: "æ›¾æŸå–»", num: "7"}, {name: "å¾·é­¯", num: "2"}
            ],
            "å¤¢æƒ³å®¶": [
                {name: "å²æ‰¿å¹³", num: "27"}, {name: "å³å®¶é§¿", num: "9"}, {name: "ç°¡å‰å„’", num: "20"}, {name: "é™³æŒ¯å‚‘", num: "0"},
                {name: "æå¾·å¨", num: "26"}, {name: "å‘¨æŸè‡£", num: "88"}, {name: "æ¹¯æ™®é‡‘æ–¯", num: "33"}, {name: "ç›§å† è‰¯", num: "28"},
                {name: "å¼µå®—æ†²", num: "3"}, {name: "é«˜æŸé§", num: "34"}, {name: "æ—ä¿Šå‰", num: "11"}, {name: "é¦¬å»ºè±ª", num: "2"},
                {name: "æ©å°¼æ–¯", num: "23"}, {name: "å¿»æ²ƒå…‹", num: "24"}, {name: "è”£æ·¯å®‰", num: "41"}, {name: "éœçˆ¾æ›¼", num: "35"}
            ],
            "é›²è±¹": [
                {name: "æ±ªå“²å®‡", num: "8"}, {name: "é»ƒé®", num: "27"}, {name: "åŠ‰å…ƒå‡±", num: "82"}, {name: "ä¸å† çš“", num: "10"},
                {name: "è‘£æ°¸å…¨", num: "31"}, {name: "å¾å®ç‘‹", num: "6"}, {name: "è¿ªäºæ´›", num: "33"}, {name: "æ›¹è–°è¥„", num: "57"},
                {name: "ç‹çš“å‰", num: "21"}, {name: "éº¥å¡æ´›", num: "7"}, {name: "èŠåšå…ƒ", num: "11"}, {name: "å…‹ç¾…é¦¬", num: "24"},
                {name: "æ—ä¿¡å¯¬", num: "12"}, {name: "ç±³å‹’", num: "13"}, {name: "é«˜éŒ¦ç‘‹", num: "5"}
            ],
            "æµ·ç¥": [
                {name: "å»–å‰çš“", num: "30"}, {name: "é­è¨å“²", num: "0"}, {name: "å‘‚å¨éœ†", num: "21"}, {name: "ä½™ç´”å®‰", num: "28"},
                {name: "å¸ƒé‡ŒèŒ²å…‹", num: "32"}, {name: "å‹¤æ˜æ…¶", num: "85"}, {name: "å´”ç¶­æ–¯", num: "22"}, {name: "è©¹å§†æ–¯", num: "2"},
                {name: "å³æ›‰è¬¹", num: "57"}, {name: "é™³æ‡·å®‰", num: "66"}, {name: "æ­ææ–¯", num: "6"}, {name: "äºç…¥äº", num: "7"},
                {name: "æ–½æ™‰å ¯", num: "11"}, {name: "èƒ¡ç“è²¿", num: "10"}, {name: "å‡±å¸", num: "92"}, {name: "è˜‡æ–‡å„’", num: "24"}
            ],
            "ç‰¹æ”»": [
                {name: "æ—å®‰é¾", num: "3"}, {name: "æ›¾ä¿¡æ­¦", num: "14"}, {name: "ä½™ç¶­è±ª", num: "5"}, {name: "æç¿éº’", num: "1"},
                {name: "ææ²›æ¾„", num: "77"}, {name: "æ›¾æ–‡é¼", num: "76"}, {name: "é»ƒæ³“ç€š", num: "22"}, {name: "éœ¸å¤«", num: "28"},
                {name: "æ—ä»»é´»", num: "12"}, {name: "æ—éŸ‹ç¿°", num: "16"}, {name: "ç°¡å»·å…†", num: "24"}, {name: "é­å˜‰è±ª", num: "7"},
                {name: "é¦¬å¯", num: "19"}, {name: "å…§é¦¬", num: "11"}, {name: "é˜¿å·´è¥¿", num: "0"}, {name: "é£›å…‹", num: "18"},
                {name: "è¬äºè»’", num: "10"}
            ],
            "åœ‹ç‹": [
                {name: "è˜‡åŸ¹å‡±", num: "2"}, {name: "å–¬ç´æ£®", num: "26"}, {name: "é¾ç†ç¿”", num: "8"}, {name: "ç‹æŸæ™º", num: "11"},
                {name: "å‘‚æ”¿å„’", num: "13"}, {name: "æ´ªå¿—å–„", num: "24"}, {name: "å¥§å¸", num: "25"}, {name: "æ—é‡‘æ¦œ", num: "19"},
                {name: "ç†Šç¥¥æ³°", num: "20"}, {name: "è˜‡å£«è»’", num: "17"}, {name: "æ²ƒè¨±æœ¬", num: "42"}, {name: "ç°¡ç¥å“²", num: "10"},
                {name: "å°šè¿ª", num: "16"}, {name: "æ¡‘å°¼", num: "31"}, {name: "æ—æ›¸ç·¯", num: "1"}, {name: "æ—å½¥å»·", num: "12"},
                {name: "å‚‘ç™»", num: "5"}, {name: "ææ„·è«º", num: "9"}
            ],
            "æˆ°ç¥": [
                {name: "åŠ‰å½¥å»·", num: "7"}, {name: "å­«æ€å ¯", num: "20"}, {name: "è˜‡å¥•æ™‰", num: "41"}, {name: "æ±Ÿå‡", num: "6"},
                {name: "é­èŠƒç¦¾", num: "5"}, {name: "é™³å† å…¨", num: "62"}, {name: "é™³æ–‡å®", num: "8"}, {name: "ä¸è–å„’", num: "3"},
                {name: "é»ƒè°ç¿°", num: "11"}, {name: "å¨åŠ›æ–¯", num: "21"}, {name: "å¼µå…†è¾°", num: "9"}, {name: "è¬éŠ˜é§¿", num: "15"},
                {name: "åŸºå¾·", num: "10"}, {name: "é½Šæ›¼åŠ ", num: "32"}, {name: "éŒ¢è‚¯å°¼", num: "23"}, {name: "é›·è’™æ©", num: "33"},
                {name: "æ´›å¤«é “", num: "1"}
            ]
        };

        // Use CORS Proxy for better reliability
        const CORS_PROXY = "https://api.allorigins.win/raw?url=";
        const GOOGLE_ROSTER_CSV_URL = "https://docs.google.com/spreadsheets/d/1wcKacc8kQqyiqm9sUdStN4W7fB7FzXcCLL6UpySBE9g/export?format=csv";
        const GOOGLE_SCHEDULE_CSV_URL = "https://docs.google.com/spreadsheets/d/1pHeJ98M6WcAlzLnZF3EUQVjZxZYZAGKFlXHcbhynfGc/export?format=csv";

        const GAME_TIMES = ["14:30", "17:00", "19:00"];
        const MONTHS = ["JAN.", "FEB.", "MAR.", "APR.", "MAY", "JUN.", "JUL.", "AUG.", "SEP.", "OCT.", "NOV.", "DEC."];
        const FIXED_VOTE_LINK = "https://tpbl.basketball/awards/vote";
        
        const STAT_TYPES = [
            { label: "å¾—åˆ†", val: "pts" },
            { label: "ç±ƒæ¿", val: "reb" },
            { label: "åŠ©æ”»", val: "ast" },
            { label: "æŠ„æˆª", val: "stl" },
            { label: "é˜»æ”»", val: "blk" },
            { label: "æ•ˆç‡å€¼", val: "eff" },
            { label: "ä¸‰åˆ†å‘½ä¸­", val: "3pm" },
            { label: "æŠ•ç±ƒå‘½ä¸­", val: "fgm" },
            { label: "ç½°çƒå‘½ä¸­", val: "ftm" },
            { label: "è‡ªè¨‚", val: "custom" }
        ];

        const EXAMPLE_LINKS = {
            'weekday_preview': 'https://www.instagram.com/p/DRwnLJKE8xe/',
            'game_preview': 'https://www.instagram.com/p/DRyT5DxkwTu/',
            'weekly_schedule': 'https://www.instagram.com/p/DRwerjvk4_a/',
            'matchup_highlight': 'https://www.instagram.com/p/DRzE52rE295/',
            'final_score': 'https://www.instagram.com/p/DRzaZvYk56J/',
            'game_highlight': 'https://www.instagram.com/p/DRzWV4qk57E/',
            'press_conf': 'https://www.instagram.com/p/DRUOjZNE5sd/',
            'potg': 'https://www.instagram.com/p/DRzc17tkwbe/',
            'local_player_highlight': 'https://www.instagram.com/p/DRUHtOqk5td/',
            'career_milestone': 'https://www.instagram.com/p/DQ1NLvekzh9/',
            'weekly_standings': 'https://www.instagram.com/p/DRbmrrbkzPV/',
            'top5': 'https://www.instagram.com/p/DRgW-5Zk7FE/',
            'potw': 'https://www.instagram.com/p/DReOCyEk6JJ/',
            'weekly_local_eff': 'https://www.instagram.com/p/DRwY7KAk3yy/',
            'monthly_kicks': 'https://www.instagram.com/p/DRoMizOk3t5/',
            'season_stats': 'https://www.instagram.com/p/DRjEhUdEz81/',
            '100_reasons': 'https://www.instagram.com/p/DR1tPClkziM/',
            'nb_moments': 'https://www.instagram.com/p/DR_9bRik0bq'
        };

        const COMMON_TAGS = "#TPBL #NothingButLove #ç±ƒçƒæ€èƒ½ä¸æ„›";
        const BROADCAST_INFO = "ğŸ‘‰ğŸ»è½‰æ’­å¹³å° ğŸ“º ç·¯ä¾†é›»è¦–ç¶²ï½œåšæ–¯é‹å‹•äºŒå°ï½œTPBLå®˜æ–¹YOUTUBE";

        let currentMode = '';
        const STORAGE_PREFIX = 'tpbl_v3_';

        // --- Utils ---
        const toMathBoldSerif = (text) => {
            const map = {
                '0': 'ğŸ', '1': 'ğŸ', '2': 'ğŸ', '3': 'ğŸ‘', '4': 'ğŸ’', '5': 'ğŸ“', '6': 'ğŸ”', '7': 'ğŸ•', '8': 'ğŸ–', '9': 'ğŸ—',
                'A': 'ğ€', 'B': 'ğ', 'C': 'ğ‚', 'D': 'ğƒ', 'E': 'ğ„', 'F': 'ğ…', 'G': 'ğ†', 'H': 'ğ‡', 'I': 'ğˆ', 'J': 'ğ‰',
                'K': 'ğŠ', 'L': 'ğ‹', 'M': 'ğŒ', 'N': 'ğ', 'O': 'ğ', 'P': 'ğ', 'Q': 'ğ', 'R': 'ğ‘', 'S': 'ğ’', 'T': 'ğ“',
                'U': 'ğ”', 'V': 'ğ•', 'W': 'ğ–', 'X': 'ğ—', 'Y': 'ğ˜', 'Z': 'ğ™',
                'a': 'ğš', 'b': 'ğ›', 'c': 'ğœ', 'd': 'ğ', 'e': 'ğ', 'f': 'ğŸ', 'g': 'ğ ', 'h': 'ğ¡', 'i': 'ğ¢', 'j': 'ğ£',
                'k': 'ğ¤', 'l': 'ğ¥', 'm': 'ğ¦', 'n': 'ğ§', 'o': 'ğ¨', 'p': 'ğ©', 'q': 'ğª', 'r': 'ğ«', 's': 'ğ¬', 't': 'ğ­',
                'u': 'ğ®', 'v': 'ğ¯', 'w': 'ğ°', 'x': 'ğ±', 'y': 'ğ²', 'z': 'ğ³'
            };
            return String(text).split('').map(char => map[char] || char).join('');
        };

        const toMathBoldSans = (text) => {
            const map = {
                '0': 'ğŸ¬', '1': 'ğŸ­', '2': 'ğŸ®', '3': 'ğŸ¯', '4': 'ğŸ°', '5': 'ğŸ±', '6': 'ğŸ²', '7': 'ğŸ³', '8': 'ğŸ´', '9': 'ğŸµ',
                'A': 'ğ—”', 'B': 'ğ—•', 'C': 'ğ—–', 'D': 'ğ——', 'E': 'ğ—˜', 'F': 'ğ—™', 'G': 'ğ—š', 'H': 'ğ—›', 'I': 'ğ—œ', 'J': 'ğ—',
                'K': 'ğ—', 'L': 'ğ—Ÿ', 'M': 'ğ— ', 'N': 'ğ—¡', 'O': 'ğ—¢', 'P': 'ğ—£', 'Q': 'ğ—¤', 'R': 'ğ—¥', 'S': 'ğ—¦', 'T': 'ğ—§',
                'U': 'ğ—¨', 'V': 'ğ—©', 'W': 'ğ—ª', 'X': 'ğ—«', 'Y': 'ğ—¬', 'Z': 'ğ—­',
                'a': 'ğ—®', 'b': 'ğ—¯', 'c': 'ğ—°', 'd': 'ğ—±', 'e': 'ğ—²', 'f': 'ğ—³', 'g': 'ğ—´', 'h': 'ğ—µ', 'i': 'ğ—¶', 'j': 'ğ—·',
                'k': 'ğ—¸', 'l': 'ğ—¹', 'm': 'ğ—º', 'n': 'ğ—»', 'o': 'ğ—¼', 'p': 'ğ—½', 'q': 'ğ—¾', 'r': 'ğ—¿', 's': 'ğ˜€', 't': 'ğ˜',
                'u': 'ğ˜‚', 'v': 'ğ˜ƒ', 'w': 'ğ˜„', 'x': 'ğ˜…', 'y': 'ğ˜†', 'z': 'ğ˜‡'
            };
            return String(text).split('').map(char => map[char] || char).join('');
        };
        
        const parseDateLocal = (dateStr) => {
            if (!dateStr) return new Date();
            const parts = dateStr.replace(/\//g, '-').split('-'); // Handle both / and -
            return new Date(parts[0], parts[1] - 1, parts[2]);
        };

        const getDayName = (dateStr) => {
            const date = parseDateLocal(dateStr);
            const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            return days[date.getDay()]; 
        };
        
        const getDayChi = (dateStr) => {
            const date = parseDateLocal(dateStr);
            const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            return days[date.getDay()];
        };

        const formatMonthDay = (dateStr) => {
            const date = parseDateLocal(dateStr);
            const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            return `${months[date.getMonth()]}.${String(date.getDate()).padStart(2, '0')}`;
        };

        const formatMMDD = (dateStr) => {
             const date = parseDateLocal(dateStr);
             return `${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')}`;
        };
        
        const formatDateFull = (dateStr) => {
             const date = parseDateLocal(dateStr);
             return `${date.getFullYear()}/${String(date.getMonth()+1).padStart(2,'0')}/${String(date.getDate()).padStart(2,'0')}`;
        }
        
        // --- Helper: Normalization for Team Names ---
        function normalizeTeamName(name) {
            if(!name) return "";
            name = name.trim();
            if (TEAMS[name]) return name;
            for (const [key, data] of Object.entries(TEAMS)) {
                if (data.full === name) return key;
            }
            for (const [key, data] of Object.entries(TEAMS)) {
                if (name.includes(key)) return key;
            }
            return name; 
        }

        // --- Helper: Schedule Logic ---
        function getNearestNextGame(fromDateStr) {
            const fromDate = parseDateLocal(fromDateStr);
            for (const game of SEASON_SCHEDULE_DB) {
                const gameDate = parseDateLocal(game.date);
                if (gameDate >= fromDate) {
                    return game; 
                }
            }
            return SEASON_SCHEDULE_DB[SEASON_SCHEDULE_DB.length-1];
        }
        
        function getNearestPastGame(fromDateStr) {
            const fromDate = parseDateLocal(fromDateStr);
            // Search backwards
            for (let i = SEASON_SCHEDULE_DB.length - 1; i >= 0; i--) {
                const game = SEASON_SCHEDULE_DB[i];
                const gameDate = parseDateLocal(game.date);
                if (gameDate <= fromDate) {
                    return game;
                }
            }
            return SEASON_SCHEDULE_DB[0];
        }
        
        function getGameByDateAndTime(dateStr, timeStr) {
            let match = SEASON_SCHEDULE_DB.find(g => g.date === dateStr && g.time === timeStr);
            if (match) return match;
            match = SEASON_SCHEDULE_DB.find(g => g.date === dateStr);
            return match;
        }
        
        function getGameById(id) {
            return SEASON_SCHEDULE_DB.find(g => g.id == id);
        }

        function getNextGameAfterId(gameId) {
            return SEASON_SCHEDULE_DB.find(g => g.id > gameId);
        }
        
        function getNextGameForTeam(teamName, currentId) {
            return SEASON_SCHEDULE_DB.find(g => g.id > currentId && (g.home === teamName || g.away === teamName));
        }
        
        function getNextGameForTeamByDate(teamName, fromDateStr) {
             const fromDate = parseDateLocal(fromDateStr);
             return SEASON_SCHEDULE_DB.find(g => {
                 const gDate = parseDateLocal(g.date);
                 return gDate > fromDate && (g.home === teamName || g.away === teamName);
             });
        }

        function getWeekdayGame(fromDateStr) {
            const fromDate = parseDateLocal(fromDateStr);
            for (const game of SEASON_SCHEDULE_DB) {
                 const gDate = parseDateLocal(game.date);
                 const fDate = new Date(fromDate.getFullYear(), fromDate.getMonth(), fromDate.getDate());

                 if (gDate >= fDate) {
                     const day = gDate.getDay();
                     if (day !== 0 && day !== 6) return game;
                 }
            }
            return null;
        }
        
        function getDatesForWeek(weekNum) {
            const week8Start = new Date("2025-12-01");
            const diffWeeks = weekNum - 8;
            const targetStart = new Date(week8Start);
            targetStart.setDate(week8Start.getDate() + (diffWeeks * 7));
            
            const targetEnd = new Date(targetStart);
            targetEnd.setDate(targetStart.getDate() + 6);
            
            return {
                start: targetStart.toISOString().split('T')[0],
                end: targetEnd.toISOString().split('T')[0]
            };
        }
        
        function getGamesInDateRange(startStr, endStr) {
            return SEASON_SCHEDULE_DB.filter(g => g.date >= startStr && g.date <= endStr);
        }

        // --- Fetch Data (Roster & Schedule) ---
        function fetchAllData() {
            const statusDiv = document.getElementById('sync-status');
            statusDiv.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin mr-1"></i> æª¢æŸ¥æ›´æ–°ä¸­...';
            
            // Note: switchMode is called SEPARATELY on init now, so we don't wait.

            // Fetch in background
            Promise.all([fetchRosterData(), fetchScheduleData()])
                .then(() => {
                    statusDiv.innerHTML = '<i class="fa-solid fa-check text-green-500 mr-1"></i> è³‡æ–™åº«å·²åŒæ­¥';
                    // Re-trigger selects to update if data changed
                    const teamSelects = document.querySelectorAll('.team-select');
                    teamSelects.forEach(s => { if(s.value) s.dispatchEvent(new Event('change')); });
                })
                .catch((error) => {
                    console.error("Sync Error", error);
                    statusDiv.innerHTML = '<i class="fa-solid fa-triangle-exclamation text-yellow-500 mr-1"></i> ä½¿ç”¨é›¢ç·šè³‡æ–™åº«';
                });
        }

        async function fetchRosterData() {
            try {
                const response = await fetch(CORS_PROXY + encodeURIComponent(GOOGLE_ROSTER_CSV_URL + '&t=' + Date.now()));
                if (!response.ok) throw new Error('Network response was not ok');
                let csvText = await response.text();
                if (csvText.charCodeAt(0) === 0xFEFF) csvText = csvText.slice(1);
                
                const rows = csvText.split(/\r?\n/);
                const newRosters = {};
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i].split(',');
                    if (row.length < 3) continue;
                    const team = normalizeTeamName(row[0].trim());
                    const name = row[1].trim();
                    const num = row[2].trim();
                    if (team && name && num) {
                        if (!newRosters[team]) newRosters[team] = [];
                        newRosters[team].push({ name, num });
                    }
                }
                if(Object.keys(newRosters).length > 0) ROSTERS = newRosters;
            } catch (e) { console.warn("Roster fetch failed", e); }
        }

        async function fetchScheduleData() {
            try {
                const response = await fetch(CORS_PROXY + encodeURIComponent(GOOGLE_SCHEDULE_CSV_URL + '&t=' + Date.now()));
                if (!response.ok) throw new Error('Network response was not ok');
                let csvText = await response.text();
                if (csvText.charCodeAt(0) === 0xFEFF) csvText = csvText.slice(1);

                const rows = csvText.split(/\r?\n/);
                const newSchedule = [];
                let startIndex = 0;
                if (!/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(rows[0].split(',')[0])) startIndex = 1; 

                for (let i = startIndex; i < rows.length; i++) {
                    const row = rows[i].split(',');
                    if (row.length < 4) continue;
                    let dateStr = row[0].trim().replace(/\//g, '-'); 
                    const parts = dateStr.split('-');
                    if(parts.length === 3) {
                         if (parts[0].length === 2 && parts[2].length === 4) dateStr = `${parts[2]}-${parts[0].padStart(2,'0')}-${parts[1].padStart(2,'0')}`;
                         else dateStr = `${parts[0]}-${parts[1].padStart(2,'0')}-${parts[2].padStart(2,'0')}`;
                    }
                    newSchedule.push({
                        id: i - startIndex + 1,
                        date: dateStr,
                        time: row[1].trim(),
                        home: normalizeTeamName(row[2].trim()),
                        away: normalizeTeamName(row[3].trim()),
                        arena: row[4] ? row[4].trim() : ""
                    });
                }
                if(newSchedule.length > 10) SEASON_SCHEDULE_DB = newSchedule;
            } catch (e) { console.warn("Schedule fetch failed", e); }
        }

        // --- UI Builders ---
        const createInput = (id, label, type="text", placeholder="", value="") => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <input type="${type}" id="${id}" class="w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand-gold focus:border-brand-gold" placeholder="${placeholder}" value="${value}">
            </div>
        `;

        const createSelect = (id, label, options) => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <select id="${id}" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold">
                    ${options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                </select>
            </div>
        `;
        
        const createTeamSelect = (id, label) => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <select id="${id}" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold team-select">
                    <option value="" disabled selected>é¸æ“‡çƒéšŠ</option>
                    ${TEAM_KEYS.map(k => `<option value="${k}">${k}</option>`).join('')}
                </select>
            </div>
        `;

        const createPlayerSelect = (id, label, teamSelectId, numInputId="") => `
             <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <select id="${id}" data-team-select="${teamSelectId}" ${numInputId ? `data-num-input="${numInputId}"` : ''} class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold player-select disabled-input" disabled>
                    <option value="">å…ˆé¸æ“‡çƒéšŠ</option>
                </select>
            </div>
        `;

        const createTimeSelect = (id, label, defaultValue="19:00") => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <select id="${id}" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold">
                    ${GAME_TIMES.map(t => `<option value="${t}" ${t === defaultValue ? 'selected' : ''}>${t}</option>`).join('')}
                </select>
            </div>
        `;

        const createTextarea = (id, label, placeholder="", rows=4, value="") => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <textarea id="${id}" rows="${rows}" class="w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand-gold focus:border-brand-gold" placeholder="${placeholder}">${value}</textarea>
            </div>
        `;
        
        const createNextGameBlock = (title) => `
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4">
                <p class="text-xs font-bold text-gray-500 mb-2 uppercase">${title}</p>
                <div class="grid grid-cols-2 gap-4">
                    ${createInput('next_date', 'æ—¥æœŸ', 'date')}
                    ${createInput('next_game_num', 'å ´æ¬¡ (Game)', 'number')}
                    ${createTimeSelect('next_time', 'æ™‚é–“', '19:00')}
                    <div></div>
                    ${createTeamSelect('next_away', 'å®¢éšŠ (Away)')}
                    ${createTeamSelect('next_home', 'ä¸»éšŠ (Home)')}
                </div>
            </div>
        `;

        // --- Save / Load Logic ---
        function saveToLocal() {
            if (!currentMode) return;
            const container = document.getElementById('dynamic-form');
            if (!container) return;

            const inputs = container.querySelectorAll('input, select, textarea');
            const data = {};
            
            inputs.forEach(input => {
                if (input.id) {
                    if (input.type === 'checkbox') {
                        data[input.id] = input.checked;
                    } else {
                        data[input.id] = input.value;
                    }
                }
            });

            const scheduleList = document.getElementById('schedule_list_container');
            if (scheduleList) data._count_schedule = scheduleList.children.length;

            const standingsList = document.getElementById('standings_schedule_list_container');
            if (standingsList) data._count_standings = standingsList.children.length;

            const statsList = document.getElementById('stats_list_container');
            if (statsList) data._count_stats = statsList.children.length;

            localStorage.setItem(STORAGE_PREFIX + currentMode, JSON.stringify(data));
            localStorage.setItem('tpbl_last_mode', currentMode);

            const ind = document.getElementById('last-saved-time');
            if(ind) {
                const now = new Date();
                const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                ind.innerHTML = `å·²è‡ªå‹•å„²å­˜ <i class="fa-solid fa-check ml-1"></i> ${timeStr}`;
                ind.style.opacity = '1';
            }
        }

        function loadFromLocal() {
            if (!currentMode) return;
            const raw = localStorage.getItem(STORAGE_PREFIX + currentMode);
            
            // If no data, try autofill immediately
            if (!raw) {
                setTimeout(() => initAutoFillLogic(currentMode), 300);
                return; 
            }

            try {
                const data = JSON.parse(raw);
                
                if (data._count_schedule !== undefined) {
                    const list = document.getElementById('schedule_list_container');
                    if (list) { list.innerHTML = ''; for (let i = 0; i < data._count_schedule; i++) addScheduleItem(); }
                }
                if (data._count_standings !== undefined) {
                    const list = document.getElementById('standings_schedule_list_container');
                    if (list) { list.innerHTML = ''; for (let i = 0; i < data._count_standings; i++) addStandingsGameItem(); }
                }
                if (data._count_stats !== undefined) {
                    const list = document.getElementById('stats_list_container');
                    if (list) { list.innerHTML = ''; for (let i = 0; i < data._count_stats; i++) addStatItem(); }
                }

                Object.keys(data).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        if (el.type === 'checkbox') {
                            el.checked = data[id];
                        } else if (el.classList.contains('team-select')) {
                            el.value = data[id];
                            el.dispatchEvent(new Event('change'));
                        }
                    }
                });

                Object.keys(data).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        if (!el.classList.contains('team-select') && el.type !== 'checkbox') {
                            el.value = data[id];
                            if (id.startsWith('stat_type_')) {
                                const idx = id.split('_')[2];
                                toggleCustomStat(idx);
                            }
                        }
                    }
                });
            } catch (e) {
                console.warn("Error parsing local storage", e);
                localStorage.removeItem(STORAGE_PREFIX + currentMode);
            }
        }
        
        function clearCacheAndReset() {
            if(!currentMode) return;
            localStorage.removeItem(STORAGE_PREFIX + currentMode);
            
            const ind = document.getElementById('last-saved-time');
            if(ind) {
                ind.innerHTML = 'å·²é‡ç½®ç‚ºé è¨­ç‹€æ…‹';
                ind.style.opacity = '1';
                setTimeout(() => { ind.style.opacity = '0'; }, 2000);
            }

            renderForm(currentMode);
            attachFormListeners();
            bindSmartEvents(currentMode);
            initAutoFillLogic(currentMode);
        }
        
        // --- SMART AUTO-FILL LOGIC ---
        function initAutoFillLogic(mode) {
             if(SEASON_SCHEDULE_DB.length === 0) return; 
             const today = new Date().toISOString().split('T')[0];
             
             if (mode === 'game_preview') {
                 const game = getNearestNextGame(today);
                 if (game) fillGameInfo(game, 'match');
             } else if (mode === 'weekday_preview') {
                 const game = getWeekdayGame(today);
                 if (game) fillGameInfo(game, 'match');
             } else if (mode === 'potg') {
                 const game = getNearestPastGame(today);
                 if(game) {
                     updateVal('potg_game_num', game.id);
                     updateSelect('potg_away', game.away);
                     updateSelect('potg_home', game.home);
                     const nextGame = getNextGameAfterId(game.id);
                     if(nextGame) fillNextGameBlock(nextGame);
                 }
             } else if (['final_score', 'matchup_highlight'].includes(mode)) {
                 const game = getNearestNextGame(today); 
                 if (game) {
                     if(mode === 'matchup_highlight') {
                         fillGameInfo(game, 'next'); 
                     } else if (mode === 'final_score') {
                         updateVal('game_num', game.id); 
                         const nextGame = getNextGameAfterId(game.id);
                         if(nextGame) fillNextGameBlock(nextGame);
                     }
                 }
             }
        }
        
        function fillGameInfo(game, prefix) {
            updateVal(`${prefix}_date`, game.date);
            updateVal(`${prefix}_time`, game.time);
            updateVal(`${prefix}_game_num`, game.id);
            if(document.getElementById('game_num')) updateVal('game_num', game.id);
            updateSelect(`${prefix}_away`, game.away); 
            updateSelect(`${prefix}_home`, game.home); 
        }
        
        function fillNextGameBlock(game) {
            updateVal('next_date', game.date);
            updateVal('next_time', game.time);
            updateVal('next_game_num', game.id);
            updateSelect('next_away', game.away);
            updateSelect('next_home', game.home);
        }
        
        function updateVal(id, val) {
            const el = document.getElementById(id);
            if(el) el.value = val;
        }
        
        function updateSelect(id, val) {
            const el = document.getElementById(id);
            if(el) {
                el.value = val;
                el.dispatchEvent(new Event('change'));
            }
        }
        
        function handleDateChange(e, prefix) {
            const date = e.target.value;
            const game = getGameByDateAndTime(date, "14:30"); 
            if(game) {
                fillGameInfo(game, prefix);
                const nextGame = getNextGameAfterId(game.id);
                if(nextGame && document.getElementById('next_date') && prefix !== 'next') fillNextGameBlock(nextGame);
            }
        }
        
        function handleTimeChange(e, prefix) {
             const dateEl = document.getElementById(`${prefix}_date`);
             if(!dateEl) return;
             const game = getGameByDateAndTime(dateEl.value, e.target.value);
             if(game) {
                 fillGameInfo(game, prefix);
                 const nextGame = getNextGameAfterId(game.id);
                 if(nextGame && document.getElementById('next_date') && prefix !== 'next') fillNextGameBlock(nextGame);
             }
        }
        
        function handleGameNumChange(e, prefix) {
            const id = e.target.value;
            const game = getGameById(id);
            if(game) {
                if (prefix === 'potg') {
                    updateSelect('potg_away', game.away);
                    updateSelect('potg_home', game.home);
                    const nextGame = getNextGameAfterId(game.id);
                    if(nextGame) fillNextGameBlock(nextGame);
                } else {
                    fillGameInfo(game, prefix);
                    const nextGame = getNextGameAfterId(game.id);
                    if(nextGame && document.getElementById('next_date') && prefix !== 'next') fillNextGameBlock(nextGame);
                    if(currentMode === 'final_score' && nextGame) {
                        fillNextGameBlock(nextGame);
                    }
                }
            }
        }
        
        function handleWeekChange(e, isStandings) {
            const weekNum = parseInt(e.target.value) || 8;
            const targetWeek = isStandings ? weekNum + 1 : weekNum; 
            const range = getDatesForWeek(targetWeek);
            const games = getGamesInDateRange(range.start, range.end);
            const containerId = isStandings ? 'standings_schedule_list_container' : 'schedule_list_container';
            const container = document.getElementById(containerId);
            if(!container) return;
            container.innerHTML = ''; 
            games.forEach(g => {
                if(isStandings) addStandingsGameItemWithData(g);
                else addScheduleItemWithData(g);
            });
        }
        
        function handlePlayerTeamChangeForNextGame(e) {
            const team = e.target.value;
            if(!team) return;
            const today = new Date().toISOString().split('T')[0];
            const nextGame = getNextGameForTeamByDate(team, today);
            if(nextGame) fillNextGameBlock(nextGame);
        }

        function transferToPotg() {
            const gameNum = document.getElementById('game_num').value;
            switchMode('potg');
            setTimeout(() => {
                const potgInput = document.getElementById('potg_game_num');
                if(potgInput && gameNum) {
                    potgInput.value = gameNum;
                    potgInput.dispatchEvent(new Event('input'));
                }
            }, 100);
        }

        // --- Switch Mode Logic ---
        const VALID_MODES = [
            'weekday_preview', 'game_preview', 'weekly_schedule', 'matchup_highlight',
            'final_score', 'game_highlight', 'press_conf', 'potg', 'local_player_highlight',
            'career_milestone', 'weekly_standings', 'top5', 'potw', 'weekly_local_eff',
            'monthly_kicks', 'season_stats', '100_reasons', 'nb_moments'
        ];

        function switchMode(mode) {
            try {
                // Safety check: if mode is invalid or undefined, default to game_preview
                if (!mode || !VALID_MODES.includes(mode)) {
                    mode = 'game_preview';
                }

                currentMode = mode;
                localStorage.setItem('tpbl_last_mode', mode);

                // Update Sidebar UI safely
                document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
                const activeBtn = document.getElementById(`btn-${mode}`);
                if (activeBtn) activeBtn.classList.add('active');
                
                // Mobile Menu handling
                if (window.innerWidth < 768) {
                    const nav = document.getElementById('sidebar-nav');
                    nav.style.maxHeight = '0px';
                    nav.classList.add('max-h-0', 'opacity-0', 'overflow-hidden');
                    nav.classList.remove('opacity-100');
                    nav.classList.remove('h-full');
                }

                const titles = {
                    'weekday_preview': 'å¹³æ—¥è³½äº‹é å‘Š',
                    'game_preview': 'å–®å ´è³½ç¨‹é å‘Š',
                    'weekly_schedule': 'æ¯é€±è³½ç¨‹è¡¨',
                    'matchup_highlight': 'è³½å‰å°æˆ°äº®é»',
                    'final_score': 'çµ‚å ´æ¯”åˆ†',
                    'game_highlight': 'æœ¬å ´è³½äº‹ç²¾è¯',
                    'press_conf': 'è³½å¾Œè¨˜è€…æœƒç²¾è¯',
                    'potg': 'å–®å ´æœ€ä½³çƒå“¡',
                    'local_player_highlight': 'æœ¬åœŸçƒå“¡å–®å ´å‚‘å‡ºè¡¨ç¾',
                    'career_milestone': 'çƒå“¡ç”Ÿæ¶¯ç´€éŒ„',
                    'weekly_standings': 'æ¯é€±æˆ°ç¸¾æ’è¡Œ',
                    'top5': 'æœ¬é€±äº”å¤§å¥½çƒ',
                    'potw': 'å–®é€±æœ€ä½³çƒå“¡',
                    'weekly_local_eff': 'æ¯é€±æœ¬åœŸæ•ˆç‡å€¼æ’è¡Œ',
                    'monthly_kicks': 'æ¯æœˆç²¾é¸å¯¦æˆ°çƒé‹',
                    'season_stats': 'æ•¸æ“šç´¯è¨ˆæ’è¡Œ',
                    '100_reasons': 'ä¸€ç™¾ç¨®å–œæ­¡ç±ƒçƒçš„åŸå› ',
                    'nb_moments': 'Nothing But Moments'
                };
                
                const titleEl = document.getElementById('title-text');
                if(titleEl) titleEl.innerText = titles[mode] || 'ç”Ÿæˆæ–‡æ¡ˆ';
                
                const linkBtn = document.getElementById('example-link');
                const url = EXAMPLE_LINKS[mode];
                if (url) {
                    linkBtn.href = url;
                    linkBtn.classList.remove('hidden');
                } else {
                    linkBtn.classList.add('hidden');
                }

                // IMPORTANT: Render the form FIRST
                renderForm(mode);
                
                // Then attach logic
                attachFormListeners(); 
                bindSmartEvents(mode); 
                loadFromLocal(); 
                
                // Finally generate copy (with safety)
                generateCopy();
            } catch(e) {
                console.error("Switch Mode Error", e);
                // Fallback to avoid dead UI
                renderForm('game_preview');
            }
        }

        function renderForm(mode) {
            try {
                const container = document.getElementById('dynamic-form');
                if (!container) return; // Critical safety check
                
                let html = '';
                const today = new Date().toISOString().split('T')[0];

                if (mode === 'game_preview') {
                    html += `
                        <div class="flex items-end gap-2 mb-4">
                            <div class="flex-1">
                                 <label class="block text-sm font-medium text-gray-700 mb-1">å ´æ¬¡ (GAME)</label>
                                 <input type="number" id="game_num" class="w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand-gold focus:border-brand-gold" placeholder="33" value="33">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            ${createInput('match_date', 'æ¯”è³½æ—¥æœŸ', 'date', '', today)}
                            ${createTimeSelect('match_time', 'æ¯”è³½æ™‚é–“', '19:00')}
                            ${createTeamSelect('match_away', 'å®¢éšŠ (Away)')}
                            ${createTeamSelect('match_home', 'ä¸»éšŠ (Home)')}
                        </div>
                        ${createTextarea('highlight_text', 'è§€è³½äº®é»', 'è¼¸å…¥æœ¬å ´çœ‹é»æ–‡æ¡ˆ...', 6)}
                        ${createInput('yt_link', 'YouTube è½‰æ’­é€£çµ', 'text')}
                    `;
                } else if (mode === 'weekday_preview') {
                    html += `
                          <div class="grid grid-cols-2 gap-4">
                            ${createInput('match_date', 'æ¯”è³½æ—¥æœŸ', 'date', '', today)}
                            ${createTimeSelect('match_time', 'æ¯”è³½æ™‚é–“', '19:00')}
                            ${createTeamSelect('match_away', 'å®¢éšŠ (Away)')}
                            ${createTeamSelect('match_home', 'ä¸»éšŠ (Home)')}
                        </div>
                        ${createInput('promo_title', 'é å‘Šæ¨™é¡Œ (å¦‚ï¼šWEDNESDAY NIGHT...)', 'text', 'WEDNESDAY NIGHT, GAME ONNNN')}
                        ${createTextarea('promo_text', 'é å‘Šæ–‡æ¡ˆ', 'æœ¬å­£é¦–æ¬¡äº¤æ‰‹çš„...', 4)}
                        ${createTextarea('promo_link', 'è´ŠåŠ©å•†ç‰ˆä½ (å¯æ›è¡Œ)', 'ğŸ“SPORTS NATIONSåº—é»è³‡è¨Š...', 3)}
                    `;
                } else if (mode === 'matchup_highlight') {
                    html += `
                         ${createNextGameBlock("ä»Šæ—¥æ¯”è³½è³‡è¨Š (Match Info)")}
                        <div class="p-3 border rounded-md bg-gray-50 mb-3 mt-4">
                            <p class="text-sm font-bold text-gray-700 mb-2">å°æˆ°çµ„åˆ</p>
                            <div class="grid grid-cols-12 gap-2 items-center">
                                <div class="col-span-4">
                                    ${createTeamSelect('mu_home_team', 'ä¸»éšŠ')}
                                </div>
                                <div class="col-span-8">
                                    ${createPlayerSelect('mu_home_player', 'ä¸»éšŠçƒå“¡', 'mu_home_team')}
                                </div>
                                
                                <div class="col-span-12 text-center text-gray-400 text-xs font-bold my-1">VS</div>
                                
                                <div class="col-span-4">
                                    ${createTeamSelect('mu_away_team', 'å®¢éšŠ')}
                                </div>
                                <div class="col-span-8">
                                    ${createPlayerSelect('mu_away_player', 'å®¢éšŠçƒå“¡', 'mu_away_team')}
                                </div>
                            </div>
                        </div>
                        ${createTextarea('matchup_content', 'å°æˆ°åˆ†æ/äº®é»æ–‡æ¡ˆ', '', 6)}
                       
                    `;
                } else if (mode === 'final_score') {
                    html += `
                        ${createInput('game_num', 'å ´æ¬¡ (GAME)', 'number', '33')}
                        ${createInput('match_title', 'æ¨™é¡Œ (ä¾‹å¦‚ï¼šå…¨éšŠã€Œè±¹ã€é€²13è¨˜å¤–ç·š...)', 'text')}
                        ${createTextarea('match_recap', 'æ¯”è³½å›é¡§æ–‡æ¡ˆ', '', 6)}
                        ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)")}
                        <button onclick="transferToPotg()" class="mt-6 w-full bg-gray-100 hover:bg-brand-gold hover:text-brand-dark text-gray-600 font-bold py-3 px-4 rounded-lg transition duration-200 flex justify-center items-center gap-2 border border-gray-200">
                            <span>å‰å¾€ç·¨è¼¯æ­¤å ´çš„å–®å ´æœ€ä½³çƒå“¡</span> <i class="fa-solid fa-arrow-right"></i>
                        </button>
                    `;
                } else if (mode === 'game_highlight') {
                    html += `
                        ${createInput('hl_title', 'ç²¾è¯æ¨™é¡Œ (ä¸éœ€è¼¸å…¥é–‹é ­ç¬¦è™Ÿ)', 'text', 'æˆ°ç¥é™ªä½ æå‰éè–èª•ï¼Merry ChristMARS ğŸ„')}
                    `;
                } else if (mode === 'press_conf') {
                    html += `
                         <div class="mb-4">
                             ${createTeamSelect('pc_team_select', 'å—è¨ªçƒéšŠ (é¸æ“‡ä»¥å¸¶å…¥ä¸‹å ´è³½äº‹)')}
                         </div>
                        ${createInput('pc_title', 'æ¨™é¡Œ (è‹±æ–‡/ä¸­æ–‡)', 'text', 'ğŸ—£ï¸ FACING THE STORM...')}
                        ${createTextarea('pc_quote', 'èªéŒ„ (ä¸éœ€è¦æ‰“å¼•è™Ÿ)', '', 3)}
                        ${createTextarea('pc_content', 'å…§å®¹', '', 6)}
                        ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)")}
                    `;
                } else if (mode === 'potg') {
                    html += `
                        <div class="mb-4">
                             <label class="block text-sm font-medium text-gray-700 mb-1">å ´æ¬¡ (GAME)</label>
                             <input type="number" id="potg_game_num" class="w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand-gold focus:border-brand-gold" placeholder="33">
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            ${createTeamSelect('potg_away', 'å®¢éšŠ (Away)')}
                            ${createTeamSelect('potg_home', 'ä¸»éšŠ (Home)')}
                        </div>
                        ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)")}
                        ${createInput('promo_text', 'åº•éƒ¨æ´»å‹•æ–‡æ¡ˆ', 'text', 'ğŸ€„æ‹šç«¶æŠ€ï¼Œè¶…å¸¶å‹...')}
                    `;
                } else if (mode === 'local_player_highlight') {
                     html += `
                        <div class="mb-4 p-3 bg-gray-50 border rounded-md">
                             <p class="text-sm font-bold text-gray-700 mb-2">é¸æ“‡çƒå“¡ (è‡ªå‹•å¸¶å…¥èƒŒè™Ÿ)</p>
                             <div class="grid grid-cols-12 gap-2">
                                 <div class="col-span-4">${createTeamSelect('lp_team', 'çƒéšŠ')}</div>
                                 <div class="col-span-5">${createPlayerSelect('lp_name', 'çƒå“¡', 'lp_team', 'lp_num')}</div>
                                 <div class="col-span-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">èƒŒè™Ÿ</label>
                                    <input type="text" id="lp_num" readonly class="w-full p-2.5 border border-gray-300 rounded-md text-center bg-gray-100">
                                 </div>
                             </div>
                             ${createInput('lp_title', 'æ¨™é¡Œæ–‡æ¡ˆ (è‡ªå‹•åŠ ä¸Š Emoji èˆ‡ å§“å)', 'text', 'å…¨é¢æ§è¡›è¦–é‡...')}
                        </div>
                        ${createTextarea('lp_content', 'çƒå“¡è¡¨ç¾æè¿°', '', 4)}
                        ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)")}
                    `;
                } else if (mode === 'career_milestone') {
                    html += `
                        ${createInput('ms_title', 'ç´€éŒ„æ¨™é¡Œ (ä¾‹å¦‚ï¼šé˜²ç·šä¸Šçš„ç›œçƒé«˜æ‰‹ï¼Œç™¾æŠ„é”æˆï¼ğŸ‘Œ)', 'text')}
                        
                        <div class="p-3 bg-gray-50 border rounded-md mb-4">
                            <p class="text-sm font-bold text-gray-700 mb-2">é”æˆçƒå“¡</p>
                            <div class="grid grid-cols-12 gap-2">
                                <div class="col-span-4">${createTeamSelect('ms_team', 'çƒéšŠ')}</div>
                                <div class="col-span-5">${createPlayerSelect('ms_name', 'çƒå“¡', 'ms_team', 'ms_num')}</div>
                                <div class="col-span-3">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">èƒŒè™Ÿ</label>
                                    <input type="text" id="ms_num" readonly class="w-full p-2.5 border border-gray-300 rounded-md text-center bg-gray-100">
                                </div>
                            </div>
                            <div class="mt-2">
                                ${createInput('ms_eng_name', 'è‹±æ–‡å (é¸å¡«)', 'text', 'Lasannah Kromah')}
                            </div>
                        </div>

                        ${createInput('ms_achievement', 'é”æˆæˆå°± (ä¾‹å¦‚ï¼šæ­£å¼æˆç‚º TPBL é¦–ä½é”æˆ100æ¬¡æŠ„æˆªçš„ç”·äººğŸ”¥)', 'text')}
                        ${createTextarea('ms_content', 'å…§å®¹æè¿°', '', 5)}
                    `;
                } else if (mode === 'weekly_schedule') {
                    html += `
                        ${createInput('week_num', 'ç¬¬å¹¾é€± (Week)', 'number', '8')}
                        ${createTextarea('week_intro', 'æœ¬é€±è³½ç¨‹å¼•è¨€', '', 4)}
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <p class="text-sm font-bold mb-2">æœ¬é€±è³½ç¨‹åˆ—è¡¨ (è‡ªå‹•å¸¶å…¥)</p>
                            <div id="schedule_list_container" class="space-y-3"></div>
                            <button onclick="addScheduleItem()" class="mt-2 text-sm font-bold text-brand-gold hover:text-yellow-600">+ æ–°å¢å ´æ¬¡</button>
                        </div>
                    `;
                } else if (mode === 'weekly_standings') {
                    html += `
                        ${createInput('week_num', 'ç¬¬å¹¾é€± (Week)', 'number', '7')}
                        ${createTextarea('standings_content', 'æˆ°ç¸¾åˆ†ææ–‡æ¡ˆ', '', 8)}
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4">
                            <p class="text-sm font-bold mb-2">æœ¬é€±è³½ç¨‹åˆ—è¡¨ (è‡ªå‹•å¸¶å…¥ä¸‹é€±)</p>
                            <div id="standings_schedule_list_container" class="space-y-3"></div>
                            <button onclick="addStandingsGameItem()" class="mt-2 text-sm font-bold text-brand-gold hover:text-yellow-600">+ æ–°å¢é å‘Šå ´æ¬¡</button>
                        </div>
                    `;
                } else if (mode === 'top5') {
                     html += `
                        ${createInput('week_num', 'ç¬¬å¹¾é€± (Week)', 'number', '7')}
                        ${createTextarea('top5_intro', 'å¼•è¨€æ–‡æ¡ˆ', '', 3)}
                        <div class="space-y-3 mt-4">
                            <p class="text-sm font-bold text-gray-500">äº”å¤§å¥½çƒæ’è¡Œ</p>
                            ${[1,2,3,4,5].map(i => `
                                <div class="p-3 border rounded-md bg-gray-50">
                                    <span class="font-bold text-gray-700 block mb-1">ç¬¬ ${i} å</span>
                                    <div class="grid grid-cols-3 gap-2">
                                        ${createTeamSelect(`top${i}_team`, '')}
                                        ${createPlayerSelect(`top${i}_name`, '', `top${i}_team`, `top${i}_num`)}
                                        <input id="top${i}_num" type="text" readonly placeholder="èƒŒè™Ÿ" class="w-full p-2.5 border border-gray-300 rounded-md text-sm text-center bg-gray-100">
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${createInput('vote_link', 'æŠ•ç¥¨é€£çµ', 'text')}
                    `;
                } else if (mode === 'potw') {
                    html += `
                        <div class="grid grid-cols-2 gap-4">
                            ${createTeamSelect('player_team', 'æ‰€å±¬éšŠä¼')}
                            <div>
                                 <label class="block text-sm font-medium text-gray-700 mb-1">çƒå“¡</label>
                                 <select id="player_name_select" data-team-select="player_team" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold player-select disabled-input" disabled>
                                    <option>å…ˆé¸æ“‡çƒéšŠ...</option>
                                 </select>
                                 <input type="hidden" id="player_num_dummy">
                                 <p class="text-xs text-gray-400 mt-1">*è«‹æ‰‹å‹•è£œä¸Šè‹±æ–‡å</p>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-2">
                            <p class="text-sm font-bold mb-2">æœ¬é€±æ•¸æ“š (STATS)</p>
                            <div id="stats_list_container" class="space-y-2"></div>
                            <button onclick="addStatItem()" class="mt-2 text-sm font-bold text-brand-gold hover:text-yellow-600">+ æ–°å¢æ•¸æ“š</button>
                        </div>
                        
                        ${createTextarea('player_desc', 'çƒå“¡è¡¨ç¾æè¿°', '', 6)}
                        ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)")}
                    `;
                } else if (mode === 'weekly_local_eff') {
                    html += `
                        ${createInput('week_num', 'ç¬¬å¹¾é€± (Week)', 'number', '7')}
                        ${createTextarea('eff_intro', 'å¼•è¨€æ–‡æ¡ˆ', '', 3)}
                        <div class="space-y-3 mt-4">
                             <p class="text-sm font-bold text-gray-500">æœ¬åœŸæ•ˆç‡å€¼æ’è¡Œ</p>
                             ${[1,2,3,4,5].map(i => `
                                <div class="p-3 border rounded-md bg-gray-50">
                                    <div class="grid grid-cols-12 gap-2 mb-2 items-center">
                                        <div class="col-span-1 flex items-center justify-center font-bold text-gray-500">#${i}</div>
                                        <div class="col-span-4">
                                            ${createTeamSelect(`eff${i}_team`, '')}
                                        </div>
                                        <div class="col-span-2">
                                            <input id="eff${i}_num" type="text" readonly placeholder="#" class="w-full p-2.5 border border-gray-300 rounded-md text-center bg-gray-100">
                                        </div>
                                        <div class="col-span-3">
                                            ${createPlayerSelect(`eff${i}_name`, '', `eff${i}_team`, `eff${i}_num`)}
                                        </div>
                                        <div class="col-span-2"><input id="eff${i}_val" type="text" placeholder="EFF" class="w-full p-2.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-brand-gold focus:border-brand-gold"></div>
                                    </div>
                                    <textarea id="eff${i}_desc" rows="2" class="w-full p-2.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-brand-gold focus:border-brand-gold" placeholder="çƒå“¡è¡¨ç¾æè¿°..."></textarea>
                                </div>
                             `).join('')}
                        </div>
                    `;
                } else if (mode === 'monthly_kicks') {
                    const mVal = getValue('kicks_month');
                    const mIndex = MONTHS.indexOf(mVal);
                    const mNum = mIndex + 1; // 0-based index to 1-12
                    
                    output = `ğŸ‘Ÿ${toMathBoldSerif('KICKS OF THE MONTH')}ï½œ${toMathBoldSerif(mVal)}\n\n`;
                    output += `${getValue('kicks_intro')}\n\n`;
                    // Updated Format: "1 æœˆ..."
                    output += `${mNum} æœˆç²¾é¸å¯¦æˆ°çƒé‹ä¸€æ¬¡çœ‹ ğŸ‘€ğŸ‘Ÿ\n\n`;
                    output += `Presented by @momentum.tw\n\n`;
                    output += `${COMMON_TAGS} #momentum`;

                } else if (mode === 'season_stats') {
                    html += `
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">æ¨™é¡Œå¾Œç¶´</label>
                            <select id="stats_title_suffix" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold">
                                <option value="TEAM">TEAM</option>
                                <option value="PLAYER">PLAYER</option>
                            </select>
                        </div>
                        ${createTextarea('stats_content', 'æ•¸æ“šåˆ†ææ–‡æ¡ˆ', '', 8)}
                        
                        <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4">
                            <p class="text-xs font-bold text-gray-500 mb-2 uppercase">çµ±è¨ˆå€é–“</p>
                            <div class="mb-3">
                                 ${createInput('stats_cutoff_date', 'çµ±è¨ˆæˆªæ­¢æ—¥', 'date', '', today)}
                            </div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">åŒ…å«è³½å­£</label>
                            <div class="flex gap-4 items-center">
                                <label class="flex items-center gap-2"><input type="checkbox" id="season_2425" checked class="w-4 h-4 text-brand-gold focus:ring-brand-gold border-gray-300 rounded"> 24-25è³½å­£</label>
                                <label class="flex items-center gap-2"><input type="checkbox" id="season_2526" class="w-4 h-4 text-brand-gold focus:ring-brand-gold border-gray-300 rounded"> 25-26è³½å­£</label>
                            </div>
                        </div>
                        
                        <div class="mt-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
                            <p class="text-xs font-bold text-gray-500 mb-2 uppercase">æŠ•ç¥¨è³‡è¨Š</p>
                            ${createInput('stats_vote_month', 'æŠ•ç¥¨æœˆä»½/å€é–“ (ä¾‹å¦‚ï¼š10-11)', 'text', '10-11')}
                        </div>
                    `;
                } else if (mode === '100_reasons') {
                    html += `
                        ${createInput('reasons_vol', 'Vol. ç·¨è™Ÿ', 'text', '014')}
                        
                        <div class="p-3 bg-gray-50 border rounded-md mb-4 mt-4">
                            <p class="text-sm font-bold text-gray-700 mb-2">å—è¨ªçƒå“¡</p>
                            <div class="grid grid-cols-2 gap-4">
                                ${createTeamSelect('reasons_team', 'çƒéšŠ')}
                                ${createPlayerSelect('reasons_name', 'çƒå“¡', 'reasons_team', 'reasons_num')}
                                <input type="hidden" id="reasons_num">
                            </div>
                        </div>

                        ${createTextarea('reasons_quote', 'é‡‘å¥ (A: ... çš„å…§å®¹)', 'ç±ƒçƒå¸¶çµ¦æˆ‘è¨±å¤šæŒ‘æˆ°...', 4)}
                        ${createTextarea('reasons_content', 'å°ˆé¡Œå…§æ–‡', 'åœ‹ä¸­ä¸‰å¹´å¾æœªç™»éŒ„ä¸Šå ´...', 8)}
                        ${createInput('reasons_link', 'å®˜ç¶²é€£çµ', 'text', 'https://tpbl.basketball/news/...')}
                    `;
                } else if (mode === 'nb_moments') {
                    html += `
                        ${createInput('nb_title', 'æ¨™é¡Œ (ï½œå¾Œé¢çš„æ–‡å­—)', 'text', '12æœˆçš„å¤©æ°£é›–ç„¶å†·é¢¼é¢¼...')}
                        ${createTextarea('nb_content', 'å…§æ–‡', 'ä¸­è¯éšŠè³½äº‹çµæŸå¾Œ...', 8)}
                    `;
                }

                container.innerHTML = html;
            } catch (e) {
                console.error("Render Form Error", e);
            }
        }

        // --- Event Binding ---
        function attachFormListeners() {
            try {
                document.querySelectorAll('.team-select').forEach(select => {
                    select.addEventListener('change', function() {
                        const teamName = this.value;
                        const playerSelects = document.querySelectorAll(`.player-select[data-team-select="${this.id}"]`);
                        playerSelects.forEach(pSelect => {
                            pSelect.innerHTML = '<option value="">è«‹é¸æ“‡çƒå“¡</option>';
                            pSelect.value = "";
                            const numInputId = pSelect.dataset.numInput;
                            if(numInputId) { const ni = document.getElementById(numInputId); if(ni) ni.value = ""; }

                            if (teamName && ROSTERS[teamName]) {
                                pSelect.disabled = false;
                                pSelect.classList.remove('disabled-input');
                                ROSTERS[teamName].forEach(player => {
                                    const option = document.createElement('option');
                                    option.value = player.name;
                                    option.text = player.name; 
                                    option.dataset.num = player.num;
                                    pSelect.appendChild(option);
                                });
                            } else {
                                pSelect.disabled = true;
                                pSelect.classList.add('disabled-input');
                            }
                        });
                    });
                });

                document.querySelectorAll('.player-select').forEach(select => {
                    select.addEventListener('change', function() {
                        const numInputId = this.dataset.numInput;
                        if (numInputId) {
                            const numInput = document.getElementById(numInputId);
                            if (numInput) {
                                const selectedOption = this.options[this.selectedIndex];
                                numInput.value = selectedOption.dataset.num || "";
                            }
                        }
                    });
                });
            } catch (e) { console.error("Event Binding Error", e); }
        }
        
        function bindSmartEvents(mode) {
             const debouncedSave = debounce(saveToLocal, 1000);
             const form = document.getElementById('dynamic-form');
             if(form) {
                 form.addEventListener('input', () => { debouncedSave(); generateCopy(); });
                 form.addEventListener('change', () => { saveToLocal(); generateCopy(); });
             }

             if (mode === 'game_preview' || mode === 'weekday_preview') {
                 const d = document.getElementById('match_date');
                 const t = document.getElementById('match_time');
                 if(d) d.addEventListener('change', (e) => handleDateChange(e, 'match'));
                 if(t) t.addEventListener('change', (e) => handleTimeChange(e, 'match'));
                 if(mode === 'game_preview') {
                     const gn = document.getElementById('game_num');
                     if(gn) gn.addEventListener('input', (e) => handleGameNumChange(e, 'match'));
                 }
             }
             
             if (mode === 'matchup_highlight') {
                 const d = document.getElementById('next_date');
                 const t = document.getElementById('next_time');
                 const g = document.getElementById('next_game_num');
                 if(d) d.addEventListener('change', (e) => handleDateChange(e, 'next')); 
                 if(t) t.addEventListener('change', (e) => handleTimeChange(e, 'next'));
                 if(g) g.addEventListener('input', (e) => handleGameNumChange(e, 'next'));
                 
                 const na = document.getElementById('next_away');
                 const nh = document.getElementById('next_home');
                 if(na) na.addEventListener('change', () => updateSelect('mu_away_team', na.value));
                 if(nh) nh.addEventListener('change', () => updateSelect('mu_home_team', nh.value));
             }
             
             if(mode === 'final_score' || mode === 'potg') {
                 const nd = document.getElementById('next_date');
                 const nt = document.getElementById('next_time');
                 if(nd) nd.addEventListener('change', (e) => handleDateChange(e, 'next'));
                 if(nt) nt.addEventListener('change', (e) => handleTimeChange(e, 'next'));
                 
                 if(mode === 'final_score') {
                     const gn = document.getElementById('game_num');
                     if(gn) gn.addEventListener('input', (e) => handleGameNumChange(e, 'next')); 
                 }
                 if(mode === 'potg') {
                     const gn = document.getElementById('potg_game_num');
                     if(gn) gn.addEventListener('input', (e) => handleGameNumChange(e, 'potg'));
                 }
             }
             
             if(mode === 'weekly_schedule') {
                 const w = document.getElementById('week_num');
                 if(w) w.addEventListener('input', (e) => handleWeekChange(e, false));
             }
             if(mode === 'weekly_standings') {
                 const w = document.getElementById('week_num');
                 if(w) w.addEventListener('input', (e) => handleWeekChange(e, true));
             }
             
             if(mode === 'local_player_highlight') {
                 const t = document.getElementById('lp_team');
                 if(t) t.addEventListener('change', handlePlayerTeamChangeForNextGame);
             }
             if(mode === 'press_conf') {
                 const t = document.getElementById('pc_team_select');
                 if(t) t.addEventListener('change', handlePlayerTeamChangeForNextGame);
             }
             if(mode === 'potw') {
                 const t = document.getElementById('player_team');
                 if(t) t.addEventListener('change', handlePlayerTeamChangeForNextGame);
             }
        }

        // ... (helpers unchanged) ...
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        function addScheduleItemWithData(game) {
            const container = document.getElementById('schedule_list_container');
            const idx = container.children.length;
            const div = document.createElement('div');
            div.className = "p-3 bg-white border rounded-lg shadow-sm mb-3";
            const timeOptions = GAME_TIMES.map(t => `<option value="${t}" ${t===game.time?'selected':''}>${t}</option>`).join('');
            
            const arena = game.arena || TEAMS[game.home]?.arena || "";

            div.innerHTML = `
                <div class="flex gap-2 mb-2">
                    <input type="date" id="sch_date_${idx}" value="${game.date}" class="flex-1 p-2 border rounded text-sm focus:ring-brand-gold focus:border-brand-gold bg-white text-left">
                    <select id="sch_time_${idx}" class="w-24 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold">${timeOptions}</select>
                </div>
                <div class="flex gap-2 items-center">
                    <select id="sch_away_${idx}" class="flex-1 min-w-0 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold team-select"><option selected>${game.away}</option>${TEAM_KEYS.filter(k=>k!=game.away).map(k=>`<option value="${k}">${k}</option>`).join('')}</select>
                    <span class="text-gray-400 text-xs font-bold">VS</span>
                    <select id="sch_home_${idx}" class="flex-1 min-w-0 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold team-select"><option selected>${game.home}</option>${TEAM_KEYS.filter(k=>k!=game.home).map(k=>`<option value="${k}">${k}</option>`).join('')}</select>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-red-500 hover:bg-red-50 p-1 rounded text-xl">&times;</button>
                </div>
            `;
            container.appendChild(div);
        }
        
        function addStandingsGameItemWithData(game) {
             const container = document.getElementById('standings_schedule_list_container');
            const idx = container.children.length;
            const div = document.createElement('div');
            div.className = "p-3 bg-white border rounded-lg shadow-sm mb-3";
            const timeOptions = GAME_TIMES.map(t => `<option value="${t}" ${t===game.time?'selected':''}>${t}</option>`).join('');

            div.innerHTML = `
                <div class="flex gap-2 mb-2">
                    <input type="date" id="std_sch_date_${idx}" value="${game.date}" class="flex-1 p-2 border rounded text-sm focus:ring-brand-gold focus:border-brand-gold bg-white text-left">
                    <select id="std_sch_time_${idx}" class="w-24 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold">${timeOptions}</select>
                </div>
                <div class="flex gap-2 items-center">
                    <select id="std_sch_away_${idx}" class="flex-1 min-w-0 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold team-select"><option selected>${game.away}</option>${TEAM_KEYS.filter(k=>k!=game.away).map(k=>`<option value="${k}">${k}</option>`).join('')}</select>
                    <span class="text-center shrink-0 text-xs font-bold">VS</span>
                    <select id="std_sch_home_${idx}" class="flex-1 min-w-0 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold team-select"><option selected>${game.home}</option>${TEAM_KEYS.filter(k=>k!=game.home).map(k=>`<option value="${k}">${k}</option>`).join('')}</select>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-red-500 hover:bg-red-50 p-1 rounded text-xl">&times;</button>
                </div>
            `;
            container.appendChild(div);
        }
        
        // --- Standard Add Item (Manual) ---
        function addScheduleItem() { addScheduleItemWithData({date: new Date().toISOString().split('T')[0], time: '14:30', away: '', home: ''}); }
        function addStandingsGameItem() { addStandingsGameItemWithData({date: new Date().toISOString().split('T')[0], time: '14:30', away: '', home: ''}); }
        function addStatItem() {
            const container = document.getElementById('stats_list_container');
            const idx = container.children.length;
            const div = document.createElement('div');
            div.className = "flex gap-2 items-center";
            const typeOptions = STAT_TYPES.map(t => `<option value="${t.val}">${t.label}</option>`).join('');
            
            div.innerHTML = `
                <input type="text" id="stat_val_${idx}" placeholder="æ•¸å€¼ (28)" class="w-20 p-2 border rounded text-sm focus:ring-brand-gold focus:border-brand-gold">
                <select id="stat_type_${idx}" onchange="toggleCustomStat(${idx})" class="w-32 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold">
                    ${typeOptions}
                </select>
                <input type="text" id="stat_cust_${idx}" placeholder="è‡ªè¨‚å–®ä½" class="flex-1 p-2 border rounded text-sm hidden focus:ring-brand-gold focus:border-brand-gold">
                <button onclick="this.parentElement.remove()" class="text-red-500 font-bold px-2">&times;</button>
            `;
            container.appendChild(div);
        }

        function toggleCustomStat(idx) {
            const select = document.getElementById(`stat_type_${idx}`);
            const customInput = document.getElementById(`stat_cust_${idx}`);
            if (select && customInput) {
                if (select.value === 'custom') customInput.classList.remove('hidden');
                else customInput.classList.add('hidden');
            }
        }

        // --- Utils ---
        function copyToClipboard() {
            const copyText = document.getElementById("output-text");
            copyText.select();
            document.execCommand("copy");
            
            const btn = document.getElementById("copy-text");
            const original = btn.innerText;
            btn.innerText = "å·²è¤‡è£½ï¼";
            setTimeout(() => btn.innerText = original, 2000);
        }

        // --- Generation Logic ---
        function generateCopy() {
            try {
                let output = "";
                const getValue = (id) => document.getElementById(id)?.value || "";
                
                // Safe Team Getter (Crucial Fix)
                const getTeam = (key) => TEAMS[key] || { full: key || "çƒéšŠ", emoji: "", arena: "" };

                // New Helper for Bold Formatting of Next Game (Matches User Request)
                const getNextGameFormatted = () => {
                    const date = getValue('next_date');
                    if(!date) return "";
                    const dObj = parseDateLocal(date);
                    const mStr = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"][dObj.getMonth()];
                    const dNum = dObj.getDate(); 
                    const time = getValue('next_time');
                    const home = getTeam(getValue('next_home'));
                    const away = getTeam(getValue('next_away'));
                    const num = getValue('next_game_num');

                    // ğƒğ„ğ‚. ğŸ”ï½œ ğ†ğšğ¦ğğŸ‘ğŸ‘ï½œğŸğŸ’:ğŸ‘ğŸ (Example)
                    const datePart = `${toMathBoldSerif(mStr)}. ${toMathBoldSerif(dNum)}`;
                    const gamePart = `${toMathBoldSerif('Game')}${toMathBoldSerif(num)}`;
                    const timePart = toMathBoldSerif(time);

                    return `${datePart}ï½œ ${gamePart}ï½œ${timePart} ${away.full}ï¼ˆå®¢ï¼‰ vs.${home.full}ï¼ˆä¸»ï¼‰`;
                };
                
                const getLocalPlayerNextGame = () => {
                    const date = getValue('next_date');
                    if(!date) return "";
                    const mmdd = formatMMDD(date);
                    const day = getDayChi(date);
                    const time = getValue('next_time');
                    const home = getTeam(getValue('next_home'));
                    const away = getTeam(getValue('next_away'));
                    const arena = home.arena;
                    const player = getValue('lp_name'); 
                    return `ğŸ“Œ ä¸‹å ´${player}ï¼š\nâ–Œ${mmdd}ï¼ˆ${day}ï¼‰ï½œ${time}ï½œ${away.full}ï¼ˆå®¢ï¼‰ vs. ${home.full}ï¼ˆä¸»ï¼‰ï½œ${arena}`;
                };


                if (currentMode === 'game_preview') {
                    const date = getValue('match_date');
                    const time = getValue('match_time');
                    const homeKey = getValue('match_home');
                    const awayKey = getValue('match_away');
                    const num = getValue('game_num');
                    const home = getTeam(homeKey);
                    const away = getTeam(awayKey);
                    
                    let arena = home.arena || "";
                    const gameInDb = SEASON_SCHEDULE_DB.find(g => g.id == num);
                    if(gameInDb && gameInDb.arena) arena = gameInDb.arena;
                    
                    const headerDate = `${toMathBoldSerif(formatMonthDay(date))}ï¼ˆ${toMathBoldSerif(getDayName(date))}ï¼‰`; 
                    
                    output = `#${toMathBoldSerif('GAMEDAY')} & #${toMathBoldSerif('ROSTER')}ï½œ${headerDate}\n\n`;
                    // Updated Format: Game (space) Num, Time bolded
                    output += `ä¾‹è¡Œè³½ ${toMathBoldSerif('GAME')} ${toMathBoldSerif(getValue('game_num'))} âœ¦ ${toMathBoldSerif(time)} ${away.emoji}${awayKey} vs ${homeKey}${home.emoji}âœ¦\n\n`;
                    output += `${getValue('highlight_text')}\n\nâ€”\n\n`;
                    output += `ğŸ‘‰ğŸ»è³½äº‹åœ°é»ğŸ“${arena}\n${BROADCAST_INFO}\n`;
                    output += `ğŸ‘‰ğŸ»YTè½‰æ’­é€£çµï½œ${getValue('yt_link')}\n\n`;
                    output += `${COMMON_TAGS} #TPBLä¾‹è¡Œè³½ #moltentaiwan`;

                } else if (currentMode === 'weekday_preview') {
                    const date = getValue('match_date');
                    const home = getTeam(getValue('match_home'));
                    const away = getTeam(getValue('match_away'));
                    const dayName = getDayName(date); 
                    const mmdd = formatMMDD(date); 
                    const dayChi = getDayChi(date); 
                    const title = getValue('promo_title');
                    
                    let arena = home.arena || "";
                    const gameInDb = getGameByDateAndTime(date, getValue('match_time'));
                    if(gameInDb && gameInDb.arena) arena = gameInDb.arena;
                    
                    output = `ğŸ€ ${toMathBoldSerif(title)}\n\n`;
                    output += `${getValue('promo_text')}\n\n-\n\n`;
                    output += `ğŸ“Œ å°é€±æœ«å°±çœ‹ç±ƒçƒï¼š\n`;
                    output += `â–Œ${mmdd}ï¼ˆ${dayChi}ï¼‰ï½œ${getValue('match_time')}ï½œ${away.full}ï¼ˆå®¢ï¼‰ vs. ${home.full}ï¼ˆä¸»ï¼‰ï½œ${arena}\n\n-\n\n`;
                    if(getValue('promo_link')) output += `${getValue('promo_link')}\n\n`;
                    output += `${COMMON_TAGS}`;

                } else if (currentMode === 'matchup_highlight') {
                     const home = getTeam(getValue('mu_home_team'));
                     const away = getTeam(getValue('mu_away_team'));
                     const homePlayer = getValue('mu_home_player');
                     const awayPlayer = getValue('mu_away_player');
                     
                     output = `âš”ï¸ ${toMathBoldSerif('MATCH UP')}ï½œ${awayPlayer} ${away.emoji} vs. ${homePlayer} ${home.emoji}\n\n`;
                     output += `${getValue('matchup_content')}\n\n-\n\n`;
                     
                     const date = getValue('next_date');
                     if(date) {
                         const mmdd = formatMMDD(date);
                         const day = getDayChi(date);
                         const time = getValue('next_time');
                         const h = getTeam(getValue('next_home'));
                         const a = getTeam(getValue('next_away'));
                         const num = getValue('next_game_num');
                         
                         let arena = h.arena || "";
                         const gameInDb = SEASON_SCHEDULE_DB.find(g => g.id == num);
                         if(gameInDb && gameInDb.arena) arena = gameInDb.arena;

                         output += `ğŸ“Œ ä»Šå¤©æ™šä¸Šçœ‹é ‚å°–å°æ±ºï¼š\n`;
                         output += `â–Œ${mmdd}ï¼ˆ${day}ï¼‰ï½œ${time}ï½œ${a.full}ï¼ˆå®¢ï¼‰ vs. ${h.full}ï¼ˆä¸»ï¼‰ï½œ${arena}\n\n`;
                     }
                     output += `${COMMON_TAGS}`;

                } else if (currentMode === 'final_score') {
                    output = `ğŸ”™ ${toMathBoldSerif('GAME')} ${toMathBoldSerif(getValue('game_num'))} ${toMathBoldSerif('FINAL')}ï½œ${getValue('match_title')}\n\n`;
                    output += `${getValue('match_recap')}\n\n`;
                    
                    const date = getValue('next_date');
                    if(date) {
                        output += getNextGameFormatted();
                    }
                    output += `\n\n${COMMON_TAGS} #TPBLä¾‹è¡Œè³½`;

                } else if (currentMode === 'game_highlight') {
                    output = `â¤ï¸â€ğŸ”¥ğŸ‘‰ğŸ»ï½œ${getValue('hl_title')}\n\n`;
                    output += `ğŸ“º ç·¯ä¾†é›»è¦–ç¶²ï½œåšæ–¯é‹å‹•äºŒå°ï½œTPBLå®˜æ–¹ YOUTUBE\n\n`;
                    output += `${COMMON_TAGS} #TPBLä¾‹è¡Œè³½`;

                } else if (currentMode === 'press_conf') {
                    output = `ğŸ—£ï¸${toMathBoldSerif(getValue('pc_title'))}\n\n`;
                    output += `ğŸ’¬ã€Œ${getValue('pc_quote')}ã€\n\n`;
                    output += `${getValue('pc_content')}\n\n`;
                    // Note: User didn't specify next game format change for Press Conf, but usually it matches final score. 
                    // Keeping standard format for now unless requested.
                    const date = getValue('next_date');
                    if(date) {
                        const mmdd = formatMMDD(date);
                        const day = getDayChi(date);
                        const time = getValue('next_time');
                        const home = getTeam(getValue('next_home'));
                        const away = getTeam(getValue('next_away'));
                        const num = getValue('next_game_num');
                        let arena = home.arena || "";
                        const gameInDb = SEASON_SCHEDULE_DB.find(g => g.id == num);
                        if(gameInDb && gameInDb.arena) arena = gameInDb.arena;
                        output += `ğŸ“Œ ä¸‹å ´æ¯”è³½ï¼Œä¸€èµ·è¿é¢¨è€Œä¸Šã€‚\nâ–Œ${mmdd}ï¼ˆ${day}ï¼‰ï½œ${time}ï½œ${away.full}ï¼ˆå®¢ï¼‰ vs. ${home.full}ï¼ˆä¸»ï¼‰ï½œ${arena}`;
                    }
                    output += `\n\n${COMMON_TAGS}`;

                } else if (currentMode === 'potg') {
                    const home = getTeam(getValue('potg_home'));
                    const away = getTeam(getValue('potg_away'));
                    output = `â¤ï¸${toMathBoldSerif('NOTHING BUT HIM')}\n\n`;
                    output += `${away.emoji}/${home.emoji} #${toMathBoldSerif('å–®å ´æœ€ä½³çƒå“¡')}\n\n`;
                    
                    const date = getValue('next_date');
                    if(date) {
                        output += getNextGameFormatted();
                    }
                    output += `\n\n-\n\n${getValue('promo_text')}\n\n${COMMON_TAGS} #TPBLä¾‹è¡Œè³½`;

                } else if (currentMode === 'local_player_highlight') {
                    const team = getTeam(getValue('lp_team'));
                    const name = getValue('lp_name');
                    const titleSuffix = getValue('lp_title');
                    
                    output = `${team.emoji}${name}${titleSuffix}\n\n`;
                    output += `${getValue('lp_content')}\n\n-\n\n`;
                    output += getLocalPlayerNextGame();
                    output += `\n\n${COMMON_TAGS}`;

                } else if (currentMode === 'career_milestone') {
                    output = `${getValue('ms_title')}\n\n`;
                    
                    const msNum = getValue('ms_num');
                    const msName = getValue('ms_name');
                    const msEng = getValue('ms_eng_name');
                    let playerInfo = '';
                    if(msName) {
                        playerInfo = `#${msNum} ${msName}`;
                        if(msEng) playerInfo += ` ${msEng}`;
                    }
                    
                    output += `${playerInfo}\n`;
                    output += `${getValue('ms_achievement')}\n`;
                    output += `${getValue('ms_content')}\n\n`;
                    output += `${COMMON_TAGS}`;

                } else if (currentMode === 'weekly_schedule') {
                    output = `â°ï½œ${toMathBoldSerif('WEEK')} ${toMathBoldSerif(getValue('week_num'))} ${toMathBoldSerif('SCHEDULE')} #æ¯é€±è³½ç¨‹\n\n`;
                    output += `${getValue('week_intro')}\n\n-\n\nğŸ“Œ æœ¬é€±è³½äº‹é å‘Šï¼š\n`;
                    
                    const listContainer = document.getElementById('schedule_list_container');
                    Array.from(listContainer.children).forEach(div => {
                        const inputs = div.querySelectorAll('input, select');
                        const d = inputs[0].value;
                        const t = inputs[1].value;
                        const a = getTeam(inputs[2].value);
                        const h = getTeam(inputs[3].value);
                        if(d) {
                             const mmdd = formatMMDD(d);
                             const day = getDayChi(d);
                             
                             let arena = h.arena;
                             const gameInDb = getGameByDateAndTime(d, t);
                             if(gameInDb && gameInDb.arena) arena = gameInDb.arena;

                             output += `â–Œ${mmdd}ï¼ˆ${day}ï¼‰ï½œ${t}ï½œ${a.full}ï¼ˆå®¢ï¼‰ vs. ${h.full}ï¼ˆä¸»ï¼‰ï½œ${arena}\n`;
                        }
                    });
                    output += `\n${COMMON_TAGS}`;

                } else if (currentMode === 'weekly_standings') {
                    output = `ğŸ“Šï½œ${toMathBoldSerif('WEEK')} ${toMathBoldSerif(getValue('week_num'))} #çƒéšŠæˆ°ç¸¾æ’è¡Œ\n\n`;
                    output += `${getValue('standings_content')}\n\n`;
                    
                    const listContainer = document.getElementById('standings_schedule_list_container');
                    const hasChildren = listContainer && listContainer.children.length > 0;
                    
                    if (hasChildren) {
                        output += `ğŸ“Œ æœ¬é€±è³½äº‹é å‘Šï¼š\n`;
                        Array.from(listContainer.children).forEach(div => {
                            const inputs = div.querySelectorAll('input, select');
                            const d = inputs[0].value;
                            const t = inputs[1].value;
                            const a = inputs[2].value;
                            const h = inputs[3].value;
                            if(d) {
                                 const mmdd = formatMMDD(d);
                                 const day = getDayChi(d);
                                 const aTeam = getTeam(a);
                                 const hTeam = getTeam(h);
                                 
                                 let arena = hTeam.arena;
                                 const gameInDb = getGameByDateAndTime(d, t);
                                 if(gameInDb && gameInDb.arena) arena = gameInDb.arena;

                                 output += `â–Œ${mmdd}ï¼ˆ${day}ï¼‰ï½œ${t}ï½œ${aTeam.full}ï¼ˆå®¢ï¼‰ vs. ${hTeam.full}ï¼ˆä¸»ï¼‰ï½œ${arena}\n`;
                            }
                        });
                         output += `\n${COMMON_TAGS}`;
                    } else {
                        output += `\n${COMMON_TAGS}`;
                    }

                } else if (currentMode === 'top5') {
                    output = `ğŸ’£ï½œ${toMathBoldSerif('TOP')}ğŸ“ âœ¦ ${toMathBoldSerif('Week')} ${toMathBoldSerif(getValue('week_num'))} ğŸ“¢\n\n`;
                    output += `${getValue('top5_intro')}\n\n`;
                    
                    for (let i = 5; i >= 1; i--) {
                        const teamKey = document.getElementById(`top${i}_team`)?.value;
                        const num = document.getElementById(`top${i}_num`)?.value;
                        const name = document.getElementById(`top${i}_name`)?.value;
                        
                        if (name) { 
                            const team = getTeam(teamKey);
                            const circledNum = ['â‘ ', 'â‘¡', 'â‘¢', 'â‘£', 'â‘¤'][i-1];
                            output += `${circledNum}${team.emoji}${team.full} | #${num} ${name}\n`;
                        }
                    }

                    output += `\n${getValue('vote_link')}\n\n${COMMON_TAGS}`;

                } else if (currentMode === 'potw') {
                    const team = getTeam(getValue('player_team'));
                    const name = getValue('player_name_select');
                    
                    output = `ğŸ¥‡ ${toMathBoldSerif('PLAYER OF THE WEEK')}ï½œ#å–®é€±è¡¨ç¾æœ€ä½³çƒå“¡\n\n`;
                    output += `ğŸ«¶ğŸ» ${toMathBoldSerif('NOTHING BUT')} ${team.emoji} ${getValue('player_name')}\n\n`;
                    
                    const statContainer = document.getElementById('stats_list_container');
                    let statsArr = [];
                    Array.from(statContainer.children).forEach(div => {
                        const val = div.querySelector('input[type="text"]').value;
                        const select = div.querySelector('select');
                        let unit = select.value;
                        
                        if (unit === 'custom') {
                            unit = div.querySelectorAll('input[type="text"]')[1].value;
                        }
                        
                        if (val) {
                            statsArr.push(`${val} ${unit}`);
                        }
                    });
                    
                    output += `${toMathBoldSerif('STATS')}ï½œ${statsArr.join(' / ')}\n\n`;
                    output += `${getValue('player_desc')}\n\n-\n\n`;
                    
                    const date = getValue('next_date');
                    if(date) {
                        // Standardize next game format for potw too? User asked for potg specifically.
                        // But kept old format for consistency with user request unless specified.
                        // Reverting to old format here for safety, or using new if desired.
                        // User request: "çµ‚å ´æ¯”åˆ†ã€å–®å ´æœ€ä½³çƒå“¡ (potg)". Not "potw" (Player of the Week).
                        const mmdd = formatMMDD(date);
                        const day = getDayChi(date);
                        const home = getTeam(getValue('next_home'));
                        const away = getTeam(getValue('next_away'));
                        const time = getValue('next_time');
                        const nameOnly = getValue('player_name_select').split(' ')[0] || "";
                        const num = getValue('next_game_num');
                        let arena = home.arena || "";
                        const gameInDb = SEASON_SCHEDULE_DB.find(g => g.id == num);
                        if(gameInDb && gameInDb.arena) arena = gameInDb.arena;

                        output += `ğŸ“Œ ä¼‘æ¯ä¸€ä¸‹å›ä¾†çœ‹${nameOnly}ç™¼å¨ğŸ‘€\n`;
                        output += `â–Œ${mmdd}ï¼ˆ${day}ï¼‰ï½œ${time}ï½œ${away.full}ï¼ˆå®¢ï¼‰ vs. ${home.full}ï¼ˆä¸»ï¼‰ï½œ${arena}`;
                    }
                    output += `\n\n${COMMON_TAGS}`;
                    
                } else if (currentMode === 'weekly_local_eff') {
                    output = `ğŸ”¥ ${toMathBoldSerif('POWERFUL LOCALS')}ï½œ${toMathBoldSerif('WEEK')} ${toMathBoldSerif(getValue('week_num'))} ${toMathBoldSerif('EFF RANKING')} æœ¬åœŸæ•ˆç‡å€¼æ’è¡Œâœ¨\n\n`;
                    output += `${getValue('eff_intro')}\n\n`;
                    
                    for (let i = 1; i <= 5; i++) { 
                        const name = getValue(`eff${i}_name`);
                        if(name) {
                            const teamKey = getValue(`eff${i}_team`);
                            const team = getTeam(teamKey);
                            const num = getValue(`eff${i}_num`);
                            const val = getValue(`eff${i}_val`);
                            const desc = getValue(`eff${i}_desc`);
                            
                            output += `${team.emoji} #${num} ${name} | EFF ${val}\n`;
                            if(desc) output += `${desc}\n\n`;
                            else output += `\n`;
                        }
                    }
                    
                    output += `${COMMON_TAGS}`;

                } else if (currentMode === 'monthly_kicks') {
                    const mVal = getValue('kicks_month');
                    const mIndex = MONTHS.indexOf(mVal);
                    const mNum = mIndex + 1; // 0-based index to 1-12
                    
                    output = `ğŸ‘Ÿ${toMathBoldSerif('KICKS OF THE MONTH')}ï½œ${toMathBoldSerif(mVal)}\n\n`;
                    output += `${getValue('kicks_intro')}\n\n`;
                    // Updated Format: "1 æœˆ..."
                    output += `${mNum} æœˆç²¾é¸å¯¦æˆ°çƒé‹ä¸€æ¬¡çœ‹ ğŸ‘€ğŸ‘Ÿ\n\n`;
                    output += `Presented by @momentum.tw\n\n`;
                    output += `${COMMON_TAGS} #momentum`;

                } else if (currentMode === 'season_stats') {
                    output = `ğŸ“Š${toMathBoldSerif('TPBL ALL-TIME REGULAR SEASON STATS')}ï½œ${toMathBoldSerif(getValue('stats_title_suffix'))}\n\n`;
                    output += `${getValue('stats_content')}\n\n`;
                    
                    const cutoff = getValue('stats_cutoff_date');
                    const s2425 = document.getElementById('season_2425').checked;
                    const s2526 = document.getElementById('season_2526').checked;
                    let seasons = [];
                    if(s2425) seasons.push('24-25');
                    if(s2526) seasons.push('25-26');
                    
                    if(cutoff) {
                       output += `*æ•¸æ“šçµ±è¨ˆè‡³${formatDateFull(cutoff)}ï¼ŒåŒ…å«${seasons.join('ã€')}è³½å­£\n\n-\n\n`;
                    }
                    
                    const month = getValue('stats_vote_month');
                    output += `ğŸ“Œ ${month}æœˆMVPæŠ•ç¥¨é€²è¡Œä¸­ :\n`;
                    output += `ğŸ”—æŠ•ç¥¨é€£çµï½œ${FIXED_VOTE_LINK}\n\n`;
                    
                    output += `${COMMON_TAGS}`;
                } else if (currentMode === '100_reasons') {
                    const vol = getValue('reasons_vol');
                    const teamKey = getValue('reasons_team');
                    const team = getTeam(teamKey);
                    const name = getValue('reasons_name');
                    const quote = getValue('reasons_quote');
                    const content = getValue('reasons_content');
                    const link = getValue('reasons_link');

                    output = `ã€ğŸ’­ ä¸€ç™¾ç¨®å–œæ­¡ç±ƒçƒçš„åŸå›  Vol.${vol}ã€‘\n\n`;
                    output += `${toMathBoldSerif('Q')}ï¼šä½ å–œæ­¡ç±ƒçƒå—ï¼Ÿ\n`;
                    
                    if (teamKey && name) {
                        output += `${toMathBoldSerif('A')}ï¼š${quote} â€” ${team.emoji} ${team.full} ${name}\n\n`;
                    } else {
                        output += `${toMathBoldSerif('A')}ï¼š${quote}\n\n`;
                    }
                    
                    output += `${content}\n\n`;
                    output += `ğŸ“ å®Œæ•´æ•…äº‹è«‹è‡³ TPBL å®˜æ–¹ç¶²ç«™\n${link}\n\n`;
                    output += `#ç±ƒçƒæ€èƒ½ä¸æ„› #NothingButLove #BasketballStory #HoopDreams`;
                } else if (currentMode === 'nb_moments') {
                    const title = getValue('nb_title');
                    const content = getValue('nb_content');
                    output = `ğŸ‘€ğŸ“¸ ${toMathBoldSerif('Nothing But Moments')}ï½œ${title}\n\n`;
                    output += `${content}\n\n`;
                    output += `é–å®šæ¯é€±è³½äº‹ï¼Œç¹¼çºŒå¸¶çµ¦ä½ æœ€ç†±è¡€ã€æœ€å‹•äººçš„ç¬é–“ ğŸ™ŒğŸ½\n\n`;
                    output += `#TPBL #NOTHINGBUTLOVE #NOTHINGBUTMOMENTS #ç±ƒçƒæ€èƒ½ä¸æ„›`;
                }

                document.getElementById('output-text').value = output;
            } catch (e) {
                console.error("Generate Copy Error", e);
            }
        }

        // Initialize with Smart Save
        setInterval(saveToLocal, 5000);
        window.addEventListener('beforeunload', () => saveToLocal()); 

        // Initialize with Safety
        try {
            const lastMode = localStorage.getItem('tpbl_last_mode') || 'game_preview';
            switchMode(lastMode);
        } catch(e) {
            console.error("Init Error", e);
            switchMode('game_preview');
        }

        // Sync in background
        fetchAllData();
    </script>
</body>
</html>
