<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Title -->
    <title>TPBL | ç¤¾ç¾¤æ–‡æ¡ˆç”Ÿæˆå·¥å…·</title>
    <meta name="description" content="TPBL è·ç±ƒè¯ç›Ÿç¤¾ç¾¤æ–‡æ¡ˆè‡ªå‹•ç”Ÿæˆèˆ‡ç®¡ç†å·¥å…·">
    
    <!-- Favicon -->
    <link rel="icon" href="https://tpbl.basketball/favicon.png">
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/alvinliu2001/tpbl-tool/refs/heads/main/apple-touch-icon.png">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Sidebar Styles */
        .sidebar-item.active { background-color: #D8BF98; color: #19191A; font-weight: 700; }
        .sidebar-item:hover { color: #ffffff !important; }

        /* Scrollbar Hiding */
        ::-webkit-scrollbar { display: none; }
        * { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Custom Colors */
        .text-brand-gold { color: #D8BF98; }
        .bg-brand-dark { background-color: #19191A; }
        .bg-brand-gold { background-color: #D8BF98; }
        .border-brand-gold { border-color: #D8BF98; }
        .focus-ring-gold:focus { --tw-ring-color: #D8BF98; }

        /* Disabled Input Style */
        .disabled-input { background-color: #f3f4f6; cursor: not-allowed; color: #9ca3af; }
        input[readonly] { background-color: #f3f4f6; color: #4b5563; }

        /* Custom Select */
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem !important;
        }

        /* Date Input Fixes */
        input[type="date"] {
            -webkit-appearance: none;
            appearance: none;
            background-color: white;
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            font-family: 'Noto Sans TC', sans-serif;
            display: block;
            text-align: left;
        }
        /* Mobile-only min-height for touch targets */
        @media (max-width: 768px) {
            input[type="date"] {
                min-height: 2.75rem;
            }
        }
        /* Fix for iOS date alignment */
        input[type="date"]::-webkit-date-and-time-value { text-align: left; }

        /* Animations */
        .fade-out {
            opacity: 0;
            transition: opacity 0.5s ease-out;
            pointer-events: none;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#19191A',
                            gold: '#D8BF98',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-800 h-screen overflow-hidden">

    <!-- LANDING PAGE -->
    <div id="landing-page" class="fixed inset-0 z-50 bg-brand-dark flex flex-col md:flex-row overflow-hidden">
        <!-- Left Side: Content -->
        <div class="w-full md:w-1/2 h-full flex flex-col justify-center px-8 md:px-24 relative z-10 bg-brand-dark overflow-y-auto">
            <div class="flex-1 flex flex-col justify-center min-h-[400px]">
                <!-- Logo -->
                <div class="mb-6 flex justify-start">
                    <img src="https://raw.githubusercontent.com/alvinliu2001/tpbl-tool/refs/heads/main/tpbl-logo-white.png" alt="TPBL Logo" class="h-10 md:h-12 w-auto">
                </div>
                <!-- Title -->
                <h1 class="text-3xl md:text-4xl font-semibold text-white mb-3 tracking-wide text-left">ç¤¾ç¾¤æ–‡æ¡ˆç”Ÿæˆå·¥å…·</h1>
                <p class="text-gray-400 text-lg md:text-xl mb-10 font-extralight text-left">ä¸€å€‹ç°¡å–®å¯¦ç”¨çš„å·¥å…·ï¼Œå¹«åŠ©åœ˜éšŠé«˜æ•ˆç”¢å‡ºæ–‡æ¡ˆã€‚</p>
                <!-- Button -->
                <div class="flex justify-start">
                    <button onclick="enterApp()" class="bg-brand-gold text-brand-dark text-lg font-bold py-3 px-12 rounded-full hover:bg-white hover:scale-105 transition-all duration-300 shadow-lg flex items-center gap-2">
                        é–‹å§‹ä½¿ç”¨ <span>â†’</span>
                    </button>
                </div>
            </div>
            <!-- Footer -->
            <div class="py-6 w-full flex flex-col items-center justify-center text-gray-600 text-xs md:text-sm flex-shrink-0">
                <p>powered by Alvin LIU</p>
                <p class="mt-1">Â© TPBL 2025 All rights reserved.</p>
            </div>
        </div>
        <!-- Right Side: Image -->
        <div class="hidden md:block w-1/2 h-full relative">
             <img src="https://assets.tpbl.basketball/production/banners/kl3My9saHVdhrTmoezJC3Am9KyBrMzgES3lVQYm2.jpg?20250930145249" alt="TPBL Season Visual" class="w-full h-full object-cover opacity-90">
            <div class="absolute inset-0 bg-black/10"></div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-container" class="hidden w-full h-full flex flex-col md:flex-row overflow-hidden fixed inset-0 z-0">
        <!-- Sidebar -->
        <aside class="w-full md:w-64 bg-brand-dark text-gray-400 flex flex-col flex-shrink-0 md:h-full z-50 relative shadow-lg md:shadow-none">
            <div class="p-4 md:p-6 border-b border-gray-800 flex justify-between items-center bg-brand-dark z-50 relative">
                <div class="flex items-center gap-3">
                    <div id="logo-container" onclick="location.reload()" class="cursor-pointer" title="è¿”å›é¦–é ">
                        <img src="https://raw.githubusercontent.com/alvinliu2001/tpbl-tool/refs/heads/main/tpbl-logo-white.png" alt="TPBL Logo" class="h-6 md:h-7 w-auto">
                    </div>
                </div>
                <!-- Mobile Menu Button -->
                <button onclick="toggleSidebar()" class="md:hidden bg-white text-black rounded-full w-8 h-8 flex items-center justify-center focus:outline-none hover:bg-gray-100 transition shadow-sm z-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 9h16M4 15h16" />
                    </svg>
                </button>
            </div>
            <!-- Sidebar Nav -->
            <nav id="sidebar-nav" class="flex flex-col flex-1 py-4 space-y-1 bg-brand-dark absolute md:static w-full top-full left-0 shadow-xl md:shadow-none transition-all duration-500 ease-in-out z-40 origin-top max-h-0 opacity-0 overflow-hidden md:max-h-full md:opacity-100 md:overflow-y-auto">
                <div class="px-4 py-2 text-xs font-bold text-gray-600 uppercase tracking-wider">è³½å‰é ç†±</div>
                <button onclick="switchMode('weekday_preview')" id="btn-weekday_preview" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-calendar-day w-6 text-center"></i> å¹³æ—¥è³½äº‹é å‘Š</button>
                <button onclick="switchMode('game_preview')" id="btn-game_preview" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-fire w-6 text-center"></i> å–®å ´è³½ç¨‹é å‘Š</button>
                <button onclick="switchMode('weekly_schedule')" id="btn-weekly_schedule" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-calendar-week w-6 text-center"></i> æ¯é€±è³½ç¨‹è¡¨</button>
                <button onclick="switchMode('matchup_highlight')" id="btn-matchup_highlight" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-bullseye w-6 text-center"></i> è³½å‰å°æˆ°äº®é»</button>

                <div class="px-4 py-2 mt-4 text-xs font-bold text-gray-600 uppercase tracking-wider">è³½äº‹é€²è¡Œ / è³½å¾Œ</div>
                <button onclick="switchMode('final_score')" id="btn-final_score" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-flag-checkered w-6 text-center"></i> çµ‚å ´æ¯”åˆ†</button>
                <button onclick="switchMode('game_highlight')" id="btn-game_highlight" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-film w-6 text-center"></i> æœ¬å ´è³½äº‹ç²¾è¯</button>
                <button onclick="switchMode('press_conf')" id="btn-press_conf" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-microphone w-6 text-center"></i> è³½å¾Œè¨˜è€…æœƒ</button>
                <button onclick="switchMode('potg')" id="btn-potg" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-bolt w-6 text-center"></i> å–®å ´æœ€ä½³çƒå“¡</button>
                <button onclick="switchMode('local_player_highlight')" id="btn-local_player_highlight" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-star w-6 text-center"></i> æœ¬åœŸçƒå“¡å–®å ´å‚‘å‡ºè¡¨ç¾</button>
                <button onclick="switchMode('career_milestone')" id="btn-career_milestone" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-crown w-6 text-center"></i> çƒå“¡ç”Ÿæ¶¯ç´€éŒ„</button>

                <div class="px-4 py-2 mt-4 text-xs font-bold text-gray-600 uppercase tracking-wider">æ¯é€±ç¸½çµ</div>
                <button onclick="switchMode('weekly_standings')" id="btn-weekly_standings" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-list-ol w-6 text-center"></i> æ¯é€±æˆ°ç¸¾æ’è¡Œ</button>
                <button onclick="switchMode('top5')" id="btn-top5" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-video w-6 text-center"></i> æœ¬é€±äº”å¤§å¥½çƒ</button>
                <button onclick="switchMode('potw')" id="btn-potw" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-trophy w-6 text-center"></i> å–®é€±æœ€ä½³çƒå“¡</button>
                <button onclick="switchMode('weekly_local_eff')" id="btn-weekly_local_eff" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-chart-line w-6 text-center"></i> æ¯é€±æœ¬åœŸæ•ˆç‡å€¼æ’è¡Œ</button>

                <div class="px-4 py-2 mt-4 text-xs font-bold text-gray-600 uppercase tracking-wider">å°ˆé¡Œ / å…¶ä»–</div>
                <button onclick="switchMode('monthly_kicks')" id="btn-monthly_kicks" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-shoe-prints w-6 text-center"></i> æ¯æœˆç²¾é¸å¯¦æˆ°çƒé‹</button>
                <button onclick="switchMode('season_stats')" id="btn-season_stats" class="sidebar-item w-full text-left px-6 py-3 hover:bg-gray-800 transition flex items-center gap-3"><i class="fa-solid fa-chart-simple w-6 text-center"></i> æ•¸æ“šç´¯è¨ˆæ’è¡Œ</button>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col md:flex-row relative overflow-y-auto md:overflow-hidden w-full h-full">
            <!-- Input Area -->
            <div class="flex-1 p-4 md:p-8 bg-white md:h-full md:overflow-y-auto" id="input-container">
                <div class="max-w-2xl mx-auto pb-10 md:pb-0">
                    <h2 id="current-title" class="text-xl md:text-2xl font-bold mb-6 text-gray-800 border-l-4 border-brand-gold pl-4 flex items-center gap-3">
                        <span id="title-text">è«‹é¸æ“‡åŠŸèƒ½</span>
                        <a id="example-link" href="#" target="_blank" class="text-gray-400 hover:text-brand-gold transition hidden" title="æŸ¥çœ‹ç¯„ä¾‹è²¼æ–‡">
                            â†—ï¸
                        </a>
                    </h2>
                    
                    <div id="dynamic-form" class="space-y-5">
                        <p class="text-gray-500">è«‹å¾å·¦å´é¸å–®é¸æ“‡æ‚¨è¦ç”Ÿæˆçš„è²¼æ–‡é¡å‹ã€‚</p>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-100">
                        <div class="flex justify-end mb-2">
                             <span id="last-saved-time" class="text-xs text-gray-400 transition-opacity duration-500 opacity-0"></span>
                        </div>
                        <button onclick="generateCopy()" class="w-full bg-brand-dark hover:bg-brand-gold hover:text-brand-dark text-white font-bold py-4 px-6 rounded-lg transition duration-200 flex justify-center items-center gap-2 shadow-lg">
                            <span>ç”Ÿæˆæ–‡æ¡ˆ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Output Area -->
            <div class="w-full md:w-1/3 bg-gray-100 p-6 flex flex-col border-t md:border-t-0 md:border-l border-gray-200">
                <h3 class="text-lg font-bold mb-4 text-gray-700 flex items-center gap-2">
                    é è¦½çµæœ
                </h3>
                <textarea id="output-text" class="flex-1 w-full p-4 border border-gray-300 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-brand-gold bg-white leading-relaxed h-64 md:h-auto" placeholder="æ–‡æ¡ˆå°‡é¡¯ç¤ºæ–¼æ­¤..."></textarea>
                
                <button onclick="copyToClipboard()" class="mt-4 w-full bg-white border-2 border-gray-200 hover:border-brand-dark text-gray-800 font-bold py-3 px-4 rounded-lg transition duration-200 flex justify-center items-center gap-2">
                    <span id="copy-text">ä¸€éµè¤‡è£½</span>
                </button>

                <!-- Footer in Main App -->
                <div class="mt-6 text-center text-gray-400 text-xs">
                    <p>powered by Alvin LIU</p>
                    <p class="mt-1">Â© TPBL 2025 All rights reserved.</p>
                </div>
            </div>
        </main>
    </div>
    
    <!-- JavaScript Logic -->
    <script>
        // --- Enter App from Landing Page ---
        function enterApp() {
            const landing = document.getElementById('landing-page');
            const app = document.getElementById('app-container');
            landing.classList.add('fade-out');
            setTimeout(() => {
                landing.style.display = 'none';
                app.classList.remove('hidden');
                app.classList.add('fade-in');
                window.scrollTo(0, 0);
            }, 500);
        }

        // --- Mobile Sidebar Toggle with Animation Logic ---
        function toggleSidebar() {
            const nav = document.getElementById('sidebar-nav');
            const availableHeight = window.innerHeight - 70;
            
            if (nav.classList.contains('max-h-0')) {
                nav.classList.remove('max-h-0', 'opacity-0', 'overflow-hidden');
                nav.style.maxHeight = availableHeight + 'px';
                nav.classList.add('opacity-100', 'overflow-y-auto');
            } else {
                nav.style.maxHeight = '0px'; 
                nav.classList.add('max-h-0', 'opacity-0', 'overflow-hidden');
                nav.classList.remove('opacity-100', 'overflow-y-auto');
            }
        }
        
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                const nav = document.getElementById('sidebar-nav');
                nav.style.maxHeight = '';
                nav.classList.add('max-h-0', 'opacity-0', 'overflow-hidden');
                nav.classList.remove('opacity-100', 'overflow-y-auto');
            }
        });

        // --- Data & Config ---
        const TEAMS = {
            "æˆ°ç¥": { full: "è‡ºåŒ—å°æ–°æˆ°ç¥", emoji: "ğŸ›¡ï¸", arena: "å’Œå¹³ç±ƒçƒé¤¨" },
            "æ”»åŸç…": { full: "æ–°ç«¹å¾¡åµ¿æ”»åŸç…", emoji: "ğŸ¦", arena: "æ–°ç«¹ç¸£ç«‹é«”è‚²é¤¨" },
            "ç‰¹æ”»": { full: "æ–°åŒ—ä¸­ä¿¡ç‰¹æ”»", emoji: "âš¡ï¸", arena: "æ–°èŠé«”è‚²é¤¨" },
            "åœ‹ç‹": { full: "æ–°åŒ—åœ‹ç‹", emoji: "ğŸ‘‘", arena: "æ–°èŠé«”è‚²é¤¨" },
            "å¤¢æƒ³å®¶": { full: "ç¦çˆ¾æ‘©æ²™å¤¢æƒ³å®¶", emoji: "ğŸ¦„", arena: "æ´²éš›è¿·ä½ è›‹" },
            "æµ·ç¥": { full: "é«˜é›„å…¨å®¶æµ·ç¥", emoji: "ğŸ”±", arena: "é«˜é›„å·¨è›‹" },
            "é›²è±¹": { full: "å°å•¤æ°¸è±é›²è±¹", emoji: "ğŸ†", arena: "æ¡ƒåœ’å·¨è›‹" }
        };
        const TEAM_KEYS = Object.keys(TEAMS);
        
        // --- SEASON SCHEDULE (2025-26 Regular Season) ---
        const SEASON_SCHEDULE = [
            { date: "2025-10-11", time: "17:00", home: "åœ‹ç‹", away: "æµ·ç¥", game_num: "1" },
            { date: "2025-10-12", time: "17:00", home: "åœ‹ç‹", away: "å¤¢æƒ³å®¶", game_num: "2" },
            { date: "2025-10-18", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æµ·ç¥", game_num: "3" },
            { date: "2025-10-18", time: "17:00", home: "åœ‹ç‹", away: "ç‰¹æ”»", game_num: "4" },
            { date: "2025-10-19", time: "14:30", home: "å¤¢æƒ³å®¶", away: "é›²è±¹", game_num: "5" },
            { date: "2025-10-19", time: "17:00", home: "åœ‹ç‹", away: "æˆ°ç¥", game_num: "6" },
            { date: "2025-10-25", time: "14:30", home: "æµ·ç¥", away: "åœ‹ç‹", game_num: "7" },
            { date: "2025-10-25", time: "17:00", home: "ç‰¹æ”»", away: "æˆ°ç¥", game_num: "8" },
            { date: "2025-10-26", time: "14:30", home: "æµ·ç¥", away: "æ”»åŸç…", game_num: "9" },
            { date: "2025-10-26", time: "17:00", home: "ç‰¹æ”»", away: "é›²è±¹", game_num: "10" },
            { date: "2025-10-29", time: "19:00", home: "æµ·ç¥", away: "å¤¢æƒ³å®¶", game_num: "11" },
            { date: "2025-11-01", time: "14:30", home: "æµ·ç¥", away: "æˆ°ç¥", game_num: "12" },
            { date: "2025-11-01", time: "17:00", home: "ç‰¹æ”»", away: "å¤¢æƒ³å®¶", game_num: "13" },
            { date: "2025-11-02", time: "14:30", home: "æµ·ç¥", away: "é›²è±¹", game_num: "14" },
            { date: "2025-11-02", time: "17:00", home: "ç‰¹æ”»", away: "æ”»åŸç…", game_num: "15" },
            { date: "2025-11-05", time: "19:00", home: "å¤¢æƒ³å®¶", away: "æ”»åŸç…", game_num: "16" },
            { date: "2025-11-07", time: "19:00", home: "å¤¢æƒ³å®¶", away: "ç‰¹æ”»", game_num: "17" },
            { date: "2025-11-08", time: "14:30", home: "åœ‹ç‹", away: "æ”»åŸç…", game_num: "18" },
            { date: "2025-11-08", time: "17:00", home: "é›²è±¹", away: "æˆ°ç¥", game_num: "19" },
            { date: "2025-11-09", time: "14:30", home: "åœ‹ç‹", away: "æµ·ç¥", game_num: "20" },
            { date: "2025-11-09", time: "17:00", home: "é›²è±¹", away: "ç‰¹æ”»", game_num: "21" },
            { date: "2025-11-12", time: "19:00", home: "åœ‹ç‹", away: "å¤¢æƒ³å®¶", game_num: "22" },
            { date: "2025-11-15", time: "14:30", home: "æ”»åŸç…", away: "ç‰¹æ”»", game_num: "23" },
            { date: "2025-11-15", time: "17:00", home: "æˆ°ç¥", away: "åœ‹ç‹", game_num: "24" },
            { date: "2025-11-16", time: "14:30", home: "æ”»åŸç…", away: "æµ·ç¥", game_num: "25" },
            { date: "2025-11-16", time: "17:00", home: "æˆ°ç¥", away: "é›²è±¹", game_num: "26" },
            { date: "2025-11-19", time: "19:00", home: "é›²è±¹", away: "æµ·ç¥", game_num: "27" },
            { date: "2025-11-22", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æ”»åŸç…", game_num: "28" },
            { date: "2025-11-22", time: "17:00", home: "é›²è±¹", away: "åœ‹ç‹", game_num: "29" },
            { date: "2025-11-23", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æˆ°ç¥", game_num: "30" },
            { date: "2025-11-23", time: "17:00", home: "é›²è±¹", away: "ç‰¹æ”»", game_num: "31" },
            { date: "2025-12-03", time: "19:00", home: "æˆ°ç¥", away: "æ”»åŸç…", game_num: "32" },
            { date: "2025-12-06", time: "14:30", home: "é›²è±¹", away: "æ”»åŸç…", game_num: "33" },
            { date: "2025-12-06", time: "17:00", home: "æˆ°ç¥", away: "ç‰¹æ”»", game_num: "34" },
            { date: "2025-12-07", time: "14:30", home: "é›²è±¹", away: "å¤¢æƒ³å®¶", game_num: "35" },
            { date: "2025-12-07", time: "17:00", home: "æˆ°ç¥", away: "æµ·ç¥", game_num: "36" },
            { date: "2025-12-13", time: "14:30", home: "æµ·ç¥", away: "æ”»åŸç…", game_num: "37" },
            { date: "2025-12-13", time: "17:00", home: "ç‰¹æ”»", away: "é›²è±¹", game_num: "38" },
            { date: "2025-12-14", time: "14:30", home: "æµ·ç¥", away: "å¤¢æƒ³å®¶", game_num: "39" },
            { date: "2025-12-14", time: "17:00", home: "ç‰¹æ”»", away: "åœ‹ç‹", game_num: "40" },
            { date: "2025-12-20", time: "14:30", home: "åœ‹ç‹", away: "é›²è±¹", game_num: "41" },
            { date: "2025-12-20", time: "17:00", home: "æ”»åŸç…", away: "å¤¢æƒ³å®¶", game_num: "42" },
            { date: "2025-12-21", time: "14:30", home: "åœ‹ç‹", away: "ç‰¹æ”»", game_num: "43" },
            { date: "2025-12-21", time: "17:00", home: "æ”»åŸç…", away: "æˆ°ç¥", game_num: "44" },
            { date: "2025-12-24", time: "19:00", home: "æ”»åŸç…", away: "é›²è±¹", game_num: "45" },
            { date: "2025-12-27", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æˆ°ç¥", game_num: "46" },
            { date: "2025-12-27", time: "17:00", home: "åœ‹ç‹", away: "æ”»åŸç…", game_num: "47" },
            { date: "2025-12-28", time: "14:30", home: "å¤¢æƒ³å®¶", away: "ç‰¹æ”»", game_num: "48" },
            { date: "2025-12-28", time: "17:00", home: "åœ‹ç‹", away: "æµ·ç¥", game_num: "49" },
            { date: "2025-12-31", time: "19:00", home: "ç‰¹æ”»", away: "åœ‹ç‹", game_num: "50" },
            { date: "2026-01-03", time: "14:30", home: "æµ·ç¥", away: "é›²è±¹", game_num: "51" },
            { date: "2026-01-03", time: "17:00", home: "ç‰¹æ”»", away: "æ”»åŸç…", game_num: "52" },
            { date: "2026-01-04", time: "14:30", home: "æµ·ç¥", away: "åœ‹ç‹", game_num: "53" },
            { date: "2026-01-04", time: "17:00", home: "ç‰¹æ”»", away: "å¤¢æƒ³å®¶", game_num: "54" },
            { date: "2026-01-07", time: "19:00", home: "æµ·ç¥", away: "æˆ°ç¥", game_num: "55" },
            { date: "2026-01-09", time: "19:00", home: "é›²è±¹", away: "åœ‹ç‹", game_num: "56" },
            { date: "2026-01-10", time: "14:30", home: "æµ·ç¥", away: "ç‰¹æ”»", game_num: "57" },
            { date: "2026-01-10", time: "17:00", home: "æˆ°ç¥", away: "å¤¢æƒ³å®¶", game_num: "58" },
            { date: "2026-01-11", time: "14:30", home: "æµ·ç¥", away: "æ”»åŸç…", game_num: "59" },
            { date: "2026-01-11", time: "17:00", home: "æˆ°ç¥", away: "é›²è±¹", game_num: "60" },
            { date: "2026-01-17", time: "14:30", home: "å¤¢æƒ³å®¶", away: "åœ‹ç‹", game_num: "61" },
            { date: "2026-01-17", time: "17:00", home: "æˆ°ç¥", away: "ç‰¹æ”»", game_num: "62" },
            { date: "2026-01-18", time: "14:30", home: "å¤¢æƒ³å®¶", away: "é›²è±¹", game_num: "63" },
            { date: "2026-01-18", time: "17:00", home: "æˆ°ç¥", away: "æ”»åŸç…", game_num: "64" },
            { date: "2026-01-24", time: "14:30", home: "ç‰¹æ”»", away: "æµ·ç¥", game_num: "65" },
            { date: "2026-01-24", time: "17:00", home: "æ”»åŸç…", away: "å¤¢æƒ³å®¶", game_num: "66" },
            { date: "2026-01-25", time: "14:30", home: "ç‰¹æ”»", away: "æˆ°ç¥", game_num: "67" },
            { date: "2026-01-25", time: "17:00", home: "æ”»åŸç…", away: "åœ‹ç‹", game_num: "68" },
            { date: "2026-01-31", time: "17:00", home: "é›²è±¹", away: "æ”»åŸç…", game_num: "69" },
            { date: "2026-01-31", time: "17:00", home: "å¤¢æƒ³å®¶", away: "åœ‹ç‹", game_num: "70" },
            { date: "2026-02-01", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æµ·ç¥", game_num: "71" },
            { date: "2026-02-01", time: "17:00", home: "é›²è±¹", away: "æˆ°ç¥", game_num: "72" },
            { date: "2026-02-07", time: "14:30", home: "æµ·ç¥", away: "é›²è±¹", game_num: "73" },
            { date: "2026-02-07", time: "17:00", home: "æˆ°ç¥", away: "åœ‹ç‹", game_num: "74" },
            { date: "2026-02-08", time: "14:30", home: "æµ·ç¥", away: "ç‰¹æ”»", game_num: "75" },
            { date: "2026-02-08", time: "17:00", home: "æˆ°ç¥", away: "å¤¢æƒ³å®¶", game_num: "76" },
            { date: "2026-02-11", time: "19:00", home: "æˆ°ç¥", away: "æµ·ç¥", game_num: "77" },
            { date: "2026-02-14", time: "14:30", home: "åœ‹ç‹", away: "æˆ°ç¥", game_num: "78" },
            { date: "2026-02-14", time: "17:00", home: "é›²è±¹", away: "å¤¢æƒ³å®¶", game_num: "79" },
            { date: "2026-02-15", time: "14:30", home: "åœ‹ç‹", away: "æ”»åŸç…", game_num: "80" },
            { date: "2026-02-15", time: "17:00", home: "é›²è±¹", away: "ç‰¹æ”»", game_num: "81" },
            { date: "2026-03-04", time: "19:00", home: "åœ‹ç‹", away: "é›²è±¹", game_num: "82" },
            { date: "2026-03-06", time: "19:00", home: "åœ‹ç‹", away: "æˆ°ç¥", game_num: "83" },
            { date: "2026-03-07", time: "14:30", home: "æµ·ç¥", away: "å¤¢æƒ³å®¶", game_num: "84" },
            { date: "2026-03-07", time: "17:00", home: "é›²è±¹", away: "æ”»åŸç…", game_num: "85" },
            { date: "2026-03-08", time: "14:30", home: "æµ·ç¥", away: "ç‰¹æ”»", game_num: "86" },
            { date: "2026-03-08", time: "17:00", home: "é›²è±¹", away: "åœ‹ç‹", game_num: "87" },
            { date: "2026-03-11", time: "19:00", home: "æ”»åŸç…", away: "æˆ°ç¥", game_num: "88" },
            { date: "2026-03-14", time: "14:30", home: "å¤¢æƒ³å®¶", away: "ç‰¹æ”»", game_num: "89" },
            { date: "2026-03-14", time: "17:00", home: "æ”»åŸç…", away: "æµ·ç¥", game_num: "90" },
            { date: "2026-03-15", time: "14:30", home: "å¤¢æƒ³å®¶", away: "é›²è±¹", game_num: "91" },
            { date: "2026-03-15", time: "17:00", home: "æ”»åŸç…", away: "åœ‹ç‹", game_num: "92" },
            { date: "2026-03-21", time: "14:30", home: "ç‰¹æ”»", away: "æµ·ç¥", game_num: "93" },
            { date: "2026-03-21", time: "17:00", home: "æˆ°ç¥", away: "é›²è±¹", game_num: "94" },
            { date: "2026-03-22", time: "14:30", home: "ç‰¹æ”»", away: "æ”»åŸç…", game_num: "95" },
            { date: "2026-03-22", time: "17:00", home: "æˆ°ç¥", away: "å¤¢æƒ³å®¶", game_num: "96" },
            { date: "2026-03-25", time: "19:00", home: "å¤¢æƒ³å®¶", away: "æµ·ç¥", game_num: "97" },
            { date: "2026-03-27", time: "19:00", home: "å¤¢æƒ³å®¶", away: "åœ‹ç‹", game_num: "98" },
            { date: "2026-03-28", time: "14:30", home: "æ”»åŸç…", away: "ç‰¹æ”»", game_num: "99" },
            { date: "2026-03-28", time: "17:00", home: "æˆ°ç¥", away: "æµ·ç¥", game_num: "100" },
            { date: "2026-03-29", time: "14:30", home: "æ”»åŸç…", away: "é›²è±¹", game_num: "101" },
            { date: "2026-03-29", time: "17:00", home: "æˆ°ç¥", away: "åœ‹ç‹", game_num: "102" },
            { date: "2026-04-01", time: "19:00", home: "ç‰¹æ”»", away: "æˆ°ç¥", game_num: "103" },
            { date: "2026-04-04", time: "14:30", home: "ç‰¹æ”»", away: "å¤¢æƒ³å®¶", game_num: "104" },
            { date: "2026-04-04", time: "17:00", home: "é›²è±¹", away: "æµ·ç¥", game_num: "105" },
            { date: "2026-04-05", time: "14:30", home: "ç‰¹æ”»", away: "åœ‹ç‹", game_num: "106" },
            { date: "2026-04-05", time: "17:00", home: "é›²è±¹", away: "æˆ°ç¥", game_num: "107" },
            { date: "2026-04-08", time: "19:00", home: "æ”»åŸç…", away: "ç‰¹æ”»", game_num: "108" },
            { date: "2026-04-11", time: "14:30", home: "æµ·ç¥", away: "åœ‹ç‹", game_num: "109" },
            { date: "2026-04-11", time: "17:00", home: "æ”»åŸç…", away: "é›²è±¹", game_num: "110" },
            { date: "2026-04-12", time: "14:30", home: "æµ·ç¥", away: "æˆ°ç¥", game_num: "111" },
            { date: "2026-04-12", time: "17:00", home: "æ”»åŸç…", away: "å¤¢æƒ³å®¶", game_num: "112" },
            { date: "2026-04-18", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æˆ°ç¥", game_num: "113" },
            { date: "2026-04-18", time: "17:00", home: "ç‰¹æ”»", away: "é›²è±¹", game_num: "114" },
            { date: "2026-04-19", time: "14:30", home: "å¤¢æƒ³å®¶", away: "æ”»åŸç…", game_num: "115" },
            { date: "2026-04-19", time: "17:00", home: "ç‰¹æ”»", away: "æµ·ç¥", game_num: "116" },
            { date: "2026-04-24", time: "19:00", home: "åœ‹ç‹", away: "å¤¢æƒ³å®¶", game_num: "117" },
            { date: "2026-04-25", time: "14:30", home: "é›²è±¹", away: "æµ·ç¥", game_num: "118" },
            { date: "2026-04-25", time: "17:00", home: "æˆ°ç¥", away: "æ”»åŸç…", game_num: "119" },
            { date: "2026-04-26", time: "14:30", home: "é›²è±¹", away: "å¤¢æƒ³å®¶", game_num: "120" },
            { date: "2026-04-26", time: "17:00", home: "æˆ°ç¥", away: "ç‰¹æ”»", game_num: "121" },
            { date: "2026-04-29", time: "19:00", home: "æ”»åŸç…", away: "åœ‹ç‹", game_num: "122" },
            { date: "2026-05-02", time: "14:30", home: "æ”»åŸç…", away: "æˆ°ç¥", game_num: "123" },
            { date: "2026-05-02", time: "17:00", home: "åœ‹ç‹", away: "é›²è±¹", game_num: "124" },
            { date: "2026-05-03", time: "14:30", home: "æ”»åŸç…", away: "æµ·ç¥", game_num: "125" },
            { date: "2026-05-03", time: "17:00", home: "åœ‹ç‹", away: "ç‰¹æ”»", game_num: "126" }
        ];

        // Roster Data
        const ROSTERS = {
            "æ”»åŸç…": [
                {num: "0", name: "ææ¼¢æ˜‡"}, {num: "2", name: "å¾·é­¯"}, {num: "3", name: "å…‹é›·æ ¼"}, {num: "4", name: "é«˜åœ‹è±ª"},
                {num: "7", name: "æ›¾æŸå–»"}, {num: "8", name: "æœ±é›²è±ª"}, {num: "9", name: "ç”°æµ©"}, {num: "10", name: "åŠ‰ä¸å‹³"},
                {num: "11", name: "è•­é †è­°"}, {num: "12", name: "æå®¶ç‘"}, {num: "17", name: "è”¡å®¸ç¶±"}, {num: "18", name: "å¸•å¡ç…"},
                {num: "22", name: "æå‚‘"}, {num: "25", name: "æ¢ç€š"}, {num: "42", name: "ç›§å† è»’"}, {num: "75", name: "æå•“ç‘‹"}
            ],
            "å¤¢æƒ³å®¶": [
                {num: "0", name: "é™³æŒ¯å‚‘"}, {num: "2", name: "é¦¬å»ºè±ª"}, {num: "3", name: "å¼µå®—æ†²"}, {num: "9", name: "å³å®¶é§¿"},
                {num: "11", name: "æ—ä¿Šå‰"}, {num: "20", name: "ç°¡å‰å„’"}, {num: "23", name: "æ©å°¼æ–¯"}, {num: "24", name: "å¿»æ²ƒå…‹"},
                {num: "26", name: "æå¾·å¨"}, {num: "27", name: "å²æ‰¿å¹³"}, {num: "28", name: "ç›§å† è‰¯"}, {num: "33", name: "æ¹¯æ™®é‡‘æ–¯"},
                {num: "34", name: "é«˜æŸé§"}, {num: "35", name: "éœçˆ¾æ›¼"}, {num: "41", name: "è”£æ·¯å®‰"}, {num: "88", name: "å‘¨æŸè‡£"}
            ],
            "é›²è±¹": [
                {num: "5", name: "é«˜éŒ¦ç‘‹"}, {num: "6", name: "å¾å®ç‘‹"}, {num: "7", name: "éº¥å¡æ´›"}, {num: "8", name: "æ±ªå“²å®‡"},
                {num: "10", name: "ä¸å† çš“"}, {num: "11", name: "èŠåšå…ƒ"}, {num: "12", name: "æ—ä¿¡å¯¬"}, {num: "13", name: "ç±³å‹’"},
                {num: "21", name: "ç‹çš“å‰"}, {num: "24", name: "å…‹ç¾…é¦¬"}, {num: "27", name: "é»ƒé®"}, {num: "31", name: "è‘£æ°¸å…¨"},
                {num: "33", name: "è¿ªäºæ´›"}, {num: "57", name: "æ›¹è–°è¥„"}, {num: "82", name: "åŠ‰å…ƒå‡±"}
            ],
            "æµ·ç¥": [
                {num: "0", name: "é­è¨å“²"}, {num: "2", name: "è©¹å§†æ–¯"}, {num: "6", name: "æ­ææ–¯"}, {num: "7", name: "äºç…¥äº"},
                {num: "10", name: "èƒ¡ç“è²¿"}, {num: "11", name: "æ–½æ™‰å ¯"}, {num: "21", name: "å‘‚å¨éœ†"}, {num: "22", name: "å´”ç¶­æ–¯"},
                {num: "24", name: "è˜‡æ–‡å„’"}, {num: "28", name: "ä½™ç´”å®‰"}, {num: "30", name: "å»–å‰çš“"}, {num: "32", name: "å¸ƒé‡ŒèŒ²å…‹"},
                {num: "57", name: "å³æ›‰è¬¹"}, {num: "66", name: "é™³æ‡·å®‰"}, {num: "85", name: "å‹¤æ˜æ…¶"}, {num: "92", name: "å‡±å¸"}
            ],
            "ç‰¹æ”»": [
                {num: "0", name: "é˜¿å·´è¥¿"}, {num: "1", name: "æç¿éº’"}, {num: "3", name: "æ—å®‰é¾"}, {num: "5", name: "ä½™ç¶­è±ª"},
                {num: "7", name: "é­å˜‰è±ª"}, {num: "10", name: "è¬äºè»’"}, {num: "11", name: "å…§é¦¬"}, {num: "12", name: "æ—ä»»é´»"},
                {num: "14", name: "æ›¾ä¿¡æ­¦"}, {num: "16", name: "æ—éŸ‹ç¿°"}, {num: "18", name: "é£›å…‹"}, {num: "19", name: "é¦¬å¯"},
                {num: "22", name: "é»ƒæ³“ç€š"}, {num: "24", name: "ç°¡å»·å…†"}, {num: "28", name: "éœ¸å¤«"}, {num: "76", name: "æ›¾æ–‡é¼"},
                {num: "77", name: "ææ²›æ¾„"}
            ],
            "åœ‹ç‹": [
                {num: "1", name: "æ—æ›¸ç·¯"}, {num: "2", name: "è˜‡åŸ¹å‡±"}, {num: "5", name: "å‚‘ç™»"}, {num: "8", name: "é¾ç†ç¿”"},
                {num: "9", name: "ææ„·è«º"}, {num: "10", name: "ç°¡ç¥å“²"}, {num: "11", name: "ç‹æŸæ™º"}, {num: "12", name: "æ—å½¥å»·"},
                {num: "13", name: "å‘‚æ”¿å„’"}, {num: "16", name: "å°šè¿ª"}, {num: "17", name: "è˜‡å£«è»’"}, {num: "19", name: "æ—é‡‘æ¦œ"},
                {num: "20", name: "ç†Šç¥¥æ³°"}, {num: "24", name: "æ´ªå¿—å–„"}, {num: "25", name: "å¥§å¸"}, {num: "26", name: "å–¬ç´æ£®"},
                {num: "31", name: "æ¡‘å°¼"}, {num: "42", name: "æ²ƒè¨±æœ¬"}
            ],
            "æˆ°ç¥": [
                {num: "1", name: "æ´›å¤«é “"}, {num: "3", name: "ä¸è–å„’"}, {num: "5", name: "é­èŠƒç¦¾"}, {num: "6", name: "æ±Ÿå‡"},
                {num: "7", name: "åŠ‰å½¥å»·"}, {num: "8", name: "é™³æ–‡å®"}, {num: "9", name: "å¼µå…†è¾°"}, {num: "10", name: "åŸºå¾·"},
                {num: "11", name: "é»ƒè°ç¿°"}, {num: "15", name: "è¬éŠ˜é§¿"}, {num: "20", name: "å­«æ€å ¯"}, {num: "21", name: "å¨åŠ›æ–¯"},
                {num: "23", name: "éŒ¢è‚¯å°¼"}, {num: "29", name: "å¼µè€•æ·¯"}, {num: "32", name: "é½Šæ›¼åŠ "}, {num: "33", name: "é›·è’™æ©"},
                {num: "41", name: "è˜‡å¥•æ™‰"}, {num: "62", name: "é™³å† å…¨"}
            ]
        };

        const GAME_TIMES = ["14:30", "17:00", "19:00"];
        const MONTHS = ["JAN.", "FEB.", "MAR.", "APR.", "MAY", "JUN.", "JUL.", "AUG.", "SEP.", "OCT.", "NOV.", "DEC."];
        const FIXED_VOTE_LINK = "https://tpbl.basketball/awards/vote";
        
        const STAT_TYPES = [
            { label: "å¾—åˆ†", val: "pts" },
            { label: "ç±ƒæ¿", val: "reb" },
            { label: "åŠ©æ”»", val: "ast" },
            { label: "æŠ„æˆª", val: "stl" },
            { label: "é˜»æ”»", val: "blk" },
            { label: "æ•ˆç‡å€¼", val: "eff" },
            { label: "ä¸‰åˆ†å‘½ä¸­", val: "3pm" },
            { label: "æŠ•ç±ƒå‘½ä¸­", val: "fgm" },
            { label: "ç½°çƒå‘½ä¸­", val: "ftm" },
            { label: "è‡ªè¨‚", val: "custom" }
        ];

        const EXAMPLE_LINKS = {
            'weekday_preview': 'https://www.instagram.com/p/DRwnLJKE8xe/',
            'game_preview': 'https://www.instagram.com/p/DRyT5DxkwTu/',
            'weekly_schedule': 'https://www.instagram.com/p/DRwerjvk4_a/',
            'matchup_highlight': 'https://www.instagram.com/p/DRzE52rE295/',
            'final_score': 'https://www.instagram.com/p/DRzaZvYk56J/',
            'game_highlight': 'https://www.instagram.com/p/DRzWV4qk57E/',
            'press_conf': 'https://www.instagram.com/p/DRUOjZNE5sd/',
            'potg': 'https://www.instagram.com/p/DRzc17tkwbe/',
            'local_player_highlight': 'https://www.instagram.com/p/DRUHtOqk5td/',
            'career_milestone': 'https://www.instagram.com/p/DQ1NLvekzh9/',
            'weekly_standings': 'https://www.instagram.com/p/DRbmrrbkzPV/',
            'top5': 'https://www.instagram.com/p/DRgW-5Zk7FE/',
            'potw': 'https://www.instagram.com/p/DReOCyEk6JJ/',
            'weekly_local_eff': 'https://www.instagram.com/p/DRwY7KAk3yy/',
            'monthly_kicks': 'https://www.instagram.com/p/DRoMizOk3t5/',
            'season_stats': 'https://www.instagram.com/p/DRjEhUdEz81/'
        };

        const COMMON_TAGS = "#TPBL #NothingButLove #ç±ƒçƒæ€èƒ½ä¸æ„›";
        const BROADCAST_INFO = "ğŸ‘‰ğŸ»è½‰æ’­å¹³å° ğŸ“º ç·¯ä¾†é›»è¦–ç¶²ï½œåšæ–¯é‹å‹•äºŒå°ï½œTPBLå®˜æ–¹YOUTUBE";

        let currentMode = '';
        const STORAGE_PREFIX = 'tpbl_draft_';

        // --- Utils ---
        const toMathBoldSerif = (text) => {
            const map = {
                '0': 'ğŸ', '1': 'ğŸ', '2': 'ğŸ', '3': 'ğŸ‘', '4': 'ğŸ’', '5': 'ğŸ“', '6': 'ğŸ”', '7': 'ğŸ•', '8': 'ğŸ–', '9': 'ğŸ—',
                'A': 'ğ€', 'B': 'ğ', 'C': 'ğ‚', 'D': 'ğƒ', 'E': 'ğ„', 'F': 'ğ…', 'G': 'ğ†', 'H': 'ğ‡', 'I': 'ğˆ', 'J': 'ğ‰',
                'K': 'ğŠ', 'L': 'ğ‹', 'M': 'ğŒ', 'N': 'ğ', 'O': 'ğ', 'P': 'ğ', 'Q': 'ğ', 'R': 'ğ‘', 'S': 'ğ’', 'T': 'ğ“',
                'U': 'ğ”', 'V': 'ğ•', 'W': 'ğ–', 'X': 'ğ—', 'Y': 'ğ˜', 'Z': 'ğ™',
                'a': 'ğš', 'b': 'ğ›', 'c': 'ğœ', 'd': 'ğ', 'e': 'ğ', 'f': 'ğŸ', 'g': 'ğ ', 'h': 'ğ¡', 'i': 'ğ¢', 'j': 'ğ£',
                'k': 'ğ¤', 'l': 'ğ¥', 'm': 'ğ¦', 'n': 'ğ§', 'o': 'ğ¨', 'p': 'ğ©', 'q': 'ğª', 'r': 'ğ«', 's': 'ğ¬', 't': 'ğ­',
                'u': 'ğ®', 'v': 'ğ¯', 'w': 'ğ°', 'x': 'ğ±', 'y': 'ğ²', 'z': 'ğ³'
            };
            return String(text).split('').map(char => map[char] || char).join('');
        };

        const parseDateLocal = (dateStr) => {
            if (!dateStr) return new Date();
            const parts = dateStr.split('-');
            return new Date(parts[0], parts[1] - 1, parts[2]);
        };

        const getDayName = (dateStr) => {
            const date = parseDateLocal(dateStr);
            const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            return days[date.getDay()]; 
        };
        
        const getDayChi = (dateStr) => {
            const date = parseDateLocal(dateStr);
            const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            return days[date.getDay()];
        };

        const formatMonthDay = (dateStr) => {
            const date = parseDateLocal(dateStr);
            const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            return `${months[date.getMonth()]}.${String(date.getDate()).padStart(2, '0')}`;
        };

        const formatMMDD = (dateStr) => {
             const date = parseDateLocal(dateStr);
             return `${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getDate()).padStart(2,'0')}`;
        };
        
        const formatDateFull = (dateStr) => {
             const date = parseDateLocal(dateStr);
             return `${date.getFullYear()}/${String(date.getMonth()+1).padStart(2,'0')}/${String(date.getDate()).padStart(2,'0')}`;
        }
        
        // --- Helper: Schedule Logic ---
        const getGamesOnDate = (dateStr) => {
            return SEASON_SCHEDULE.filter(g => g.date === dateStr);
        };

        const getGameByDateTime = (dateStr, timeStr) => {
            return SEASON_SCHEDULE.find(g => g.date === dateStr && g.time === timeStr);
        };
        
        const getGameByNum = (num) => {
            return SEASON_SCHEDULE.find(g => g.game_num === String(num));
        };

        const getNextGameInLeague = (currentGameNum) => {
            const nextNum = parseInt(currentGameNum) + 1;
            return SEASON_SCHEDULE.find(g => parseInt(g.game_num) === nextNum);
        };

        const getNextGameForTeam = (teamName, fromDate) => {
            // Find next game for specific team after today
            return SEASON_SCHEDULE.find(g => (g.home === teamName || g.away === teamName) && g.date > fromDate);
        };

        const getNearestPastGame = () => {
             const today = new Date().toISOString().split('T')[0];
             // Sort desc by date, then by time
             const pastGames = SEASON_SCHEDULE.filter(g => g.date <= today).sort((a,b) => {
                 if (a.date === b.date) return b.time.localeCompare(a.time);
                 return b.date.localeCompare(a.date);
             });
             return pastGames.length > 0 ? pastGames[0] : null;
        }
        
        const getNextWeekdayGame = () => {
             const today = new Date().toISOString().split('T')[0];
             // Find first game >= today that is NOT Sat/Sun
             return SEASON_SCHEDULE.find(g => {
                 if (g.date < today) return false;
                 const d = parseDateLocal(g.date);
                 const day = d.getDay();
                 return day !== 0 && day !== 6; // 0=Sun, 6=Sat
             });
        }

        // --- Logic: Init Game Data ---
        // Returns the game object to use as default
        const getInitialGameData = (mode) => {
            const today = new Date().toISOString().split('T')[0];
            
            if (mode === 'final_score' || mode === 'potg' || mode === 'press_conf' || mode === 'local_player_highlight') {
                // Post-game modes: Prefer Nearest PAST game
                return getNearestPastGame();
            } else if (mode === 'weekday_preview') {
                 return getNextWeekdayGame();
            } else {
                // Preview modes: Prefer nearest FUTURE game (including today)
                const futureGame = SEASON_SCHEDULE.find(g => g.date >= today);
                return futureGame || null;
            }
        };

        // --- Helper Functions (Moved up to prevent ReferenceError) ---
        function addScheduleItem(game = null) {
            const container = document.getElementById('schedule_list_container');
            const idx = container.children.length;
            const div = document.createElement('div');
            div.className = "p-3 bg-white border rounded-lg shadow-sm mb-3";
            const timeOptions = GAME_TIMES.map(t => `<option value="${t}" ${game && game.time === t ? 'selected' : ''}>${t}</option>`).join('');
            const today = new Date().toISOString().split('T')[0]; 
            const defDate = game ? game.date : today;
            const defHome = game ? game.home : '';
            const defAway = game ? game.away : '';

            div.innerHTML = `
                <div class="flex gap-2 mb-2">
                    <input type="date" id="sch_date_${idx}" value="${defDate}" class="flex-1 p-2 border rounded text-sm focus:ring-brand-gold focus:border-brand-gold bg-white text-left">
                    <select id="sch_time_${idx}" class="w-24 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold">${timeOptions}</select>
                </div>
                <div class="flex gap-2 items-center">
                    <select id="sch_away_${idx}" class="flex-1 min-w-0 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold team-select">
                        <option value="" disabled ${!defAway ? 'selected' : ''}>é¸æ“‡çƒéšŠ</option>
                        ${TEAM_KEYS.map(k => `<option value="${k}" ${k === defAway ? 'selected' : ''}>${k}</option>`).join('')}
                    </select>
                    <span class="text-gray-400 text-xs font-bold">VS</span>
                    <select id="sch_home_${idx}" class="flex-1 min-w-0 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold team-select">
                        <option value="" disabled ${!defHome ? 'selected' : ''}>é¸æ“‡çƒéšŠ</option>
                        ${TEAM_KEYS.map(k => `<option value="${k}" ${k === defHome ? 'selected' : ''}>${k}</option>`).join('')}
                    </select>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-red-500 hover:bg-red-50 p-1 rounded text-xl">&times;</button>
                </div>
            `;
            container.appendChild(div);
        }

        function addStandingsGameItem(game = null) {
            const container = document.getElementById('standings_schedule_list_container');
            const idx = container.children.length;
            const div = document.createElement('div');
            div.className = "p-3 bg-white border rounded-lg shadow-sm mb-3";
            const timeOptions = GAME_TIMES.map(t => `<option value="${t}" ${game && game.time === t ? 'selected' : ''}>${t}</option>`).join('');
            const today = new Date().toISOString().split('T')[0]; 
            const defDate = game ? game.date : today;
            const defHome = game ? game.home : '';
            const defAway = game ? game.away : '';

            div.innerHTML = `
                <div class="flex gap-2 mb-2">
                    <input type="date" id="std_sch_date_${idx}" value="${defDate}" class="flex-1 p-2 border rounded text-sm focus:ring-brand-gold focus:border-brand-gold bg-white text-left">
                    <select id="std_sch_time_${idx}" class="w-24 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold">${timeOptions}</select>
                </div>
                <div class="flex gap-2 items-center">
                    <select id="std_sch_away_${idx}" class="flex-1 min-w-0 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold team-select">
                        <option value="" disabled ${!defAway ? 'selected' : ''}>é¸æ“‡çƒéšŠ</option>
                        ${TEAM_KEYS.map(k => `<option value="${k}" ${k === defAway ? 'selected' : ''}>${k}</option>`).join('')}
                    </select>
                    <span class="text-center shrink-0 text-xs font-bold">VS</span>
                    <select id="std_sch_home_${idx}" class="flex-1 min-w-0 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold team-select">
                        <option value="" disabled ${!defHome ? 'selected' : ''}>é¸æ“‡çƒéšŠ</option>
                        ${TEAM_KEYS.map(k => `<option value="${k}" ${k === defHome ? 'selected' : ''}>${k}</option>`).join('')}
                    </select>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-red-500 hover:bg-red-50 p-1 rounded text-xl">&times;</button>
                </div>
            `;
            container.appendChild(div);
        }

        function addStatItem() {
            const container = document.getElementById('stats_list_container');
            const idx = container.children.length;
            const div = document.createElement('div');
            div.className = "flex gap-2 items-center";
            const typeOptions = STAT_TYPES.map(t => `<option value="${t.val}">${t.label}</option>`).join('');
            
            div.innerHTML = `
                <input type="text" id="stat_val_${idx}" placeholder="æ•¸å€¼ (28)" class="w-20 p-2 border rounded text-sm focus:ring-brand-gold focus:border-brand-gold">
                <select id="stat_type_${idx}" onchange="toggleCustomStat(${idx})" class="w-32 p-2 border rounded text-sm bg-white focus:ring-brand-gold focus:border-brand-gold">
                    ${typeOptions}
                </select>
                <input type="text" id="stat_cust_${idx}" placeholder="è‡ªè¨‚å–®ä½" class="flex-1 p-2 border rounded text-sm hidden focus:ring-brand-gold focus:border-brand-gold">
                <button onclick="this.parentElement.remove()" class="text-red-500 font-bold px-2">&times;</button>
            `;
            container.appendChild(div);
        }

        function toggleCustomStat(idx) {
            const select = document.getElementById(`stat_type_${idx}`);
            const customInput = document.getElementById(`stat_cust_${idx}`);
            if (select.value === 'custom') {
                customInput.classList.remove('hidden');
            } else {
                customInput.classList.add('hidden');
            }
        }
        
        // Helper: Populate Player Select (Global helper for re-use)
        function populatePlayers(teamSelectEl) {
            const teamName = teamSelectEl.value;
            // Handle different ID patterns
            let playerSelects = [];
            
            // 1. Try finding by data-team-select attribute (Standard)
            const byAttr = document.querySelectorAll(`.player-select[data-team-select="${teamSelectEl.id}"]`);
            byAttr.forEach(el => playerSelects.push(el));
            
            playerSelects.forEach(pSelect => {
                // Save current value if any
                const currentVal = pSelect.value;
                
                pSelect.innerHTML = '<option value="">è«‹é¸æ“‡çƒå“¡</option>';
                pSelect.disabled = true;
                pSelect.classList.add('disabled-input');
                
                const numInputId = pSelect.dataset.numInput;
                if(numInputId) {
                    const numInput = document.getElementById(numInputId);
                    if(numInput && !currentVal) numInput.value = ""; // Only clear if no player selected
                }

                if (teamName && ROSTERS[teamName]) {
                    pSelect.disabled = false;
                    pSelect.classList.remove('disabled-input');
                    ROSTERS[teamName].forEach(player => {
                        const option = document.createElement('option');
                        option.value = player.name;
                        option.text = player.name; 
                        option.dataset.num = player.num;
                        pSelect.appendChild(option);
                    });
                    // Restore value if it exists in new list
                    if(currentVal) pSelect.value = currentVal;
                }
            });
        }
        
        // Helper: Trigger team selects to populate players (useful after auto-fill)
        function triggerTeamSelects() {
            document.querySelectorAll('.team-select').forEach(select => {
                if(select.value) populatePlayers(select);
            });
        }

        // --- UI Builders ---
        const createInput = (id, label, type="text", placeholder="", value="") => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <input type="${type}" id="${id}" class="w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand-gold focus:border-brand-gold ${type === 'date' ? 'date-input' : ''}" placeholder="${placeholder}" value="${value}">
            </div>
        `;

        const createSelect = (id, label, options) => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <select id="${id}" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold">
                    ${options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                </select>
            </div>
        `;
        
        const createTeamSelect = (id, label, defaultValue="") => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <select id="${id}" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold team-select">
                    <option value="" disabled ${!defaultValue ? 'selected' : ''}>é¸æ“‡çƒéšŠ</option>
                    ${TEAM_KEYS.map(k => `<option value="${k}" ${k === defaultValue ? 'selected' : ''}>${k}</option>`).join('')}
                </select>
            </div>
        `;

        const createPlayerSelect = (id, label, teamSelectId, numInputId="") => `
             <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <select id="${id}" data-team-select="${teamSelectId}" ${numInputId ? `data-num-input="${numInputId}"` : ''} class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold player-select disabled-input" disabled>
                    <option value="">å…ˆé¸æ“‡çƒéšŠ</option>
                </select>
            </div>
        `;

        const createTimeSelect = (id, label, defaultValue="19:00") => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <select id="${id}" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold time-select">
                    ${GAME_TIMES.map(t => `<option value="${t}" ${t === defaultValue ? 'selected' : ''}>${t}</option>`).join('')}
                </select>
            </div>
        `;

        const createTextarea = (id, label, placeholder="", rows=4, value="") => `
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">${label}</label>
                <textarea id="${id}" rows="${rows}" class="w-full p-2.5 border border-gray-300 rounded-md focus:ring-2 focus:ring-brand-gold focus:border-brand-gold" placeholder="${placeholder}">${value}</textarea>
            </div>
        `;
        
        const createNextGameBlock = (title, gameData = null) => `
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4" id="next-game-block">
                <p class="text-xs font-bold text-gray-500 mb-2 uppercase">${title}</p>
                <div class="grid grid-cols-2 gap-4">
                    ${createInput('next_date', 'æ—¥æœŸ', 'date', '', gameData ? gameData.date : '')}
                    ${createInput('next_game_num', 'å ´æ¬¡ (Game)', 'number', '', gameData ? gameData.game_num : '')}
                    ${createTimeSelect('next_time', 'æ™‚é–“', gameData ? gameData.time : '19:00')}
                    <div></div>
                    ${createTeamSelect('next_away', 'å®¢éšŠ (Away)', gameData ? gameData.away : '')}
                    ${createTeamSelect('next_home', 'ä¸»éšŠ (Home)', gameData ? gameData.home : '')}
                </div>
            </div>
        `;

        // --- Save / Load Logic ---
        function saveToLocal() {
            if (!currentMode) return;
            const container = document.getElementById('dynamic-form');
            if (!container) return;

            const inputs = container.querySelectorAll('input, select, textarea');
            const data = {};
            
            inputs.forEach(input => {
                if (input.id) {
                    if (input.type === 'checkbox') {
                        data[input.id] = input.checked;
                    } else {
                        data[input.id] = input.value;
                    }
                }
            });

            // Save dynamic list counts
            const scheduleList = document.getElementById('schedule_list_container');
            if (scheduleList) data._count_schedule = scheduleList.children.length;

            const standingsList = document.getElementById('standings_schedule_list_container');
            if (standingsList) data._count_standings = standingsList.children.length;

            const statsList = document.getElementById('stats_list_container');
            if (statsList) data._count_stats = statsList.children.length;

            localStorage.setItem(STORAGE_PREFIX + currentMode, JSON.stringify(data));
            
            // Show Last Saved Time
            const ind = document.getElementById('last-saved-time');
            if(ind) {
                const now = new Date();
                const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                ind.innerHTML = `å·²è‡ªå‹•å„²å­˜ <i class="fa-solid fa-check ml-1"></i> ${timeStr}`;
                ind.style.opacity = '1';
            }
        }

        function loadFromLocal() {
            if (!currentMode) return;
            const raw = localStorage.getItem(STORAGE_PREFIX + currentMode);
            
            // Handle Defaults if no save data found
            if (!raw) {
                if (currentMode === 'weekly_schedule') {
                    // Default empty now, auto-filled by logic
                } else if (currentMode === 'weekly_standings') {
                    // Default logic handled in switchMode
                } else if (currentMode === 'potw') {
                    addStatItem(); addStatItem(); addStatItem();
                }
                return; 
            }

            const data = JSON.parse(raw);

            // Reconstruct Dynamic Lists
            if (data._count_schedule !== undefined) {
                const list = document.getElementById('schedule_list_container');
                if (list) {
                    list.innerHTML = ''; // Clear defaults
                    for (let i = 0; i < data._count_schedule; i++) addScheduleItem();
                }
            }
            if (data._count_standings !== undefined) {
                const list = document.getElementById('standings_schedule_list_container');
                if (list) {
                    list.innerHTML = '';
                    for (let i = 0; i < data._count_standings; i++) addStandingsGameItem();
                }
            }
            if (data._count_stats !== undefined) {
                const list = document.getElementById('stats_list_container');
                if (list) {
                    list.innerHTML = '';
                    for (let i = 0; i < data._count_stats; i++) addStatItem();
                }
            }

            // Restore Values (Pass 1: Team Selects & Checkboxes)
            Object.keys(data).forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (el.type === 'checkbox') {
                        el.checked = data[id];
                    } else if (el.classList.contains('team-select')) {
                        el.value = data[id];
                        populatePlayers(el); // Manually trigger population
                    }
                }
            });

            // Restore Values (Pass 2: Everything else)
            Object.keys(data).forEach(id => {
                const el = document.getElementById(id);
                if (el && !el.classList.contains('team-select') && el.type !== 'checkbox') {
                    el.value = data[id];
                    if (id.startsWith('stat_type_')) {
                        const idx = id.split('_')[2];
                        toggleCustomStat(idx);
                    }
                }
            });
        }

        // --- Switch Mode Logic ---
        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`btn-${mode}`).classList.add('active');
            
            if (window.innerWidth < 768) {
                const nav = document.getElementById('sidebar-nav');
                nav.style.maxHeight = '0px';
                nav.classList.add('max-h-0', 'opacity-0', 'overflow-hidden');
                nav.classList.remove('opacity-100', 'overflow-y-auto');
            }

            const titles = {
                'weekday_preview': 'å¹³æ—¥è³½äº‹é å‘Š',
                'game_preview': 'å–®å ´è³½ç¨‹é å‘Š',
                'weekly_schedule': 'æ¯é€±è³½ç¨‹è¡¨',
                'matchup_highlight': 'è³½å‰å°æˆ°äº®é»',
                'final_score': 'çµ‚å ´æ¯”åˆ†',
                'game_highlight': 'æœ¬å ´è³½äº‹ç²¾è¯',
                'press_conf': 'è³½å¾Œè¨˜è€…æœƒç²¾è¯',
                'potg': 'å–®å ´æœ€ä½³çƒå“¡',
                'local_player_highlight': 'æœ¬åœŸçƒå“¡å–®å ´å‚‘å‡ºè¡¨ç¾',
                'career_milestone': 'çƒå“¡ç”Ÿæ¶¯ç´€éŒ„',
                'weekly_standings': 'æ¯é€±æˆ°ç¸¾æ’è¡Œ',
                'top5': 'æœ¬é€±äº”å¤§å¥½çƒ',
                'potw': 'å–®é€±æœ€ä½³çƒå“¡',
                'weekly_local_eff': 'æ¯é€±æœ¬åœŸæ•ˆç‡å€¼æ’è¡Œ',
                'monthly_kicks': 'æ¯æœˆç²¾é¸å¯¦æˆ°çƒé‹',
                'season_stats': 'æ•¸æ“šç´¯è¨ˆæ’è¡Œ'
            };
            
            // Update Title Text
            document.getElementById('title-text').innerText = titles[mode];
            
            // Update Link
            const linkBtn = document.getElementById('example-link');
            const url = EXAMPLE_LINKS[mode];
            if (url) {
                linkBtn.href = url;
                linkBtn.classList.remove('hidden');
            } else {
                linkBtn.classList.add('hidden');
            }

            renderForm(mode);
            bindDynamicEvents();
            
            // Logic: Load local data first, if empty then apply auto-fill defaults
            if (!localStorage.getItem(STORAGE_PREFIX + currentMode)) {
                 // No saved draft -> Apply defaults
                 if (currentMode === 'weekly_schedule') {
                     const weekNumInput = document.getElementById('week_num');
                     if(weekNumInput) {
                         weekNumInput.value = 8; // Default week
                         weekNumInput.dispatchEvent(new Event('change')); 
                     }
                 } else if (currentMode === 'weekly_standings') {
                     const weekNumInput = document.getElementById('week_num');
                     if(weekNumInput) {
                         weekNumInput.value = 8; // Default week
                         weekNumInput.dispatchEvent(new Event('change')); 
                     }
                 } else if (currentMode === 'potw') {
                    addStatItem(); addStatItem(); addStatItem();
                 }
                 
                 // For any mode with pre-filled teams (from auto-fill), populate players
                 triggerTeamSelects();
            } else {
                 loadFromLocal();
            }
        }

        function renderForm(mode) {
            const container = document.getElementById('dynamic-form');
            let html = '';
            
            // Auto-fill logic
            const today = new Date().toISOString().split('T')[0];
            const gameData = getInitialGameData(mode);
            let nextGameData = null;
            if (gameData) {
                nextGameData = getNextGameInLeague(gameData.game_num);
            }

            if (mode === 'game_preview') {
                html += `
                    <div class="grid grid-cols-2 gap-4">
                        ${createInput('game_num', 'å ´æ¬¡ (GAME)', 'number', '32', gameData ? gameData.game_num : '32')}
                        ${createInput('match_date', 'æ¯”è³½æ—¥æœŸ', 'date', '', gameData ? gameData.date : '')}
                        ${createTimeSelect('match_time', 'æ¯”è³½æ™‚é–“', gameData ? gameData.time : '19:00')}
                        <div></div>
                        ${createTeamSelect('away_team', 'å®¢éšŠ (Away)', gameData ? gameData.away : '')}
                        ${createTeamSelect('home_team', 'ä¸»éšŠ (Home)', gameData ? gameData.home : '')}
                    </div>
                    ${createTextarea('highlight_text', 'è§€è³½äº®é»', 'è¼¸å…¥æœ¬å ´çœ‹é»æ–‡æ¡ˆ...', 6)}
                    ${createInput('yt_link', 'YouTube è½‰æ’­é€£çµ', 'text')}
                `;
            } else if (mode === 'weekday_preview') {
                html += `
                     <div class="grid grid-cols-2 gap-4">
                        ${createInput('match_date', 'æ¯”è³½æ—¥æœŸ', 'date', '', gameData ? gameData.date : '')}
                        ${createTimeSelect('match_time', 'æ¯”è³½æ™‚é–“', gameData ? gameData.time : '19:00')}
                        ${createTeamSelect('away_team', 'å®¢éšŠ (Away)', gameData ? gameData.away : '')}
                        ${createTeamSelect('home_team', 'ä¸»éšŠ (Home)', gameData ? gameData.home : '')}
                    </div>
                    ${createInput('promo_title', 'é å‘Šæ¨™é¡Œ (å¦‚ï¼šWEDNESDAY NIGHT...)', 'text', 'WEDNESDAY NIGHT, LETâ€™S GOOOO')}
                    ${createTextarea('promo_text', 'é å‘Šæ–‡æ¡ˆ', 'æœ¬å­£é¦–æ¬¡äº¤æ‰‹çš„...', 4)}
                    ${createTextarea('promo_link', 'è´ŠåŠ©å•†ç‰ˆä½ (å¯æ›è¡Œ)', 'ğŸ“SPORTS NATIONSåº—é»è³‡è¨Š...', 3)}
                `;
            } else if (mode === 'matchup_highlight') {
                html += `
                    ${createNextGameBlock("ä»Šæ—¥æ¯”è³½è³‡è¨Š (Today's Game)", gameData)}
                    <div class="p-3 border rounded-md bg-gray-50 mb-3 mt-4">
                        <p class="text-sm font-bold text-gray-700 mb-2">å°æˆ°çµ„åˆ</p>
                        <div class="grid grid-cols-12 gap-2 items-center">
                            <div class="col-span-4">
                                ${createTeamSelect('mu_home_team', 'ä¸»éšŠ', gameData ? gameData.home : '')}
                            </div>
                            <div class="col-span-8">
                                ${createPlayerSelect('mu_home_player', 'ä¸»éšŠçƒå“¡', 'mu_home_team')}
                            </div>
                            
                            <div class="col-span-12 text-center text-gray-400 text-xs font-bold my-1">VS</div>
                            
                            <div class="col-span-4">
                                ${createTeamSelect('mu_away_team', 'å®¢éšŠ', gameData ? gameData.away : '')}
                            </div>
                            <div class="col-span-8">
                                ${createPlayerSelect('mu_away_player', 'å®¢éšŠçƒå“¡', 'mu_away_team')}
                            </div>
                        </div>
                    </div>
                    ${createTextarea('matchup_content', 'å°æˆ°åˆ†æ/äº®é»æ–‡æ¡ˆ', '', 6)}
                `;
            } else if (mode === 'final_score') {
                html += `
                    ${createInput('game_num', 'å ´æ¬¡ (GAME)', 'number', '31', gameData ? gameData.game_num : '')}
                    <div class="hidden">
                        ${createInput('match_date', '', 'hidden', '', gameData ? gameData.date : '')} 
                    </div>
                    ${createInput('match_title', 'æ¨™é¡Œ (ä¾‹å¦‚ï¼šå…¨éšŠã€Œè±¹ã€é€²13è¨˜å¤–ç·š...)', 'text')}
                    ${createTextarea('match_recap', 'æ¯”è³½å›é¡§æ–‡æ¡ˆ', '', 6)}
                    ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)", nextGameData)}
                `;
            } else if (mode === 'game_highlight') {
                html += `
                    ${createInput('hl_title', 'ç²¾è¯æ¨™é¡Œ (ä¸éœ€è¼¸å…¥é–‹é ­ç¬¦è™Ÿ)', 'text', 'æˆ°ç¥é™ªä½ æå‰éè–èª•ï¼Merry ChristMARS ğŸ„')}
                `;
            } else if (mode === 'press_conf') {
                html += `
                    <div class="mb-4">
                        ${createTeamSelect('pc_team', 'å—è¨ªçƒéšŠ (è‡ªå‹•æŠ“å–è©²éšŠä¸‹ä¸€å ´æ¯”è³½)')}
                    </div>
                    ${createInput('pc_title', 'æ¨™é¡Œ (è‹±æ–‡/ä¸­æ–‡)', 'text', 'ğŸ—£ï¸ FACING THE STORM...')}
                    ${createTextarea('pc_quote', 'èªéŒ„ (ä¸éœ€è¦æ‰“å¼•è™Ÿ)', '', 3)}
                    ${createTextarea('pc_content', 'å…§å®¹', '', 6)}
                    ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)", nextGameData)}
                `;
            } else if (mode === 'potg') {
                html += `
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        ${createInput('game_num', '', 'hidden', '', gameData ? gameData.game_num : '')}
                        ${createTeamSelect('potg_away', 'å®¢éšŠ (Away)', gameData ? gameData.away : '')}
                        ${createTeamSelect('potg_home', 'ä¸»éšŠ (Home)', gameData ? gameData.home : '')}
                    </div>
                    ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)", nextGameData)}
                    ${createInput('promo_text', 'åº•éƒ¨æ´»å‹•æ–‡æ¡ˆ', 'text', 'ğŸ€„æ‹šç«¶æŠ€ï¼Œè¶…å¸¶å‹...')}
                `;
            } else if (mode === 'local_player_highlight') {
                 html += `
                    <div class="mb-4 p-3 bg-gray-50 border rounded-md">
                         <p class="text-sm font-bold text-gray-700 mb-2">é¸æ“‡çƒå“¡ (è‡ªå‹•å¸¶å…¥èƒŒè™Ÿ)</p>
                         <div class="grid grid-cols-12 gap-2">
                             <div class="col-span-4">${createTeamSelect('lp_team', 'çƒéšŠ', gameData ? gameData.home : '')}</div>
                             <div class="col-span-5">${createPlayerSelect('lp_name', 'çƒå“¡', 'lp_team', 'lp_num')}</div>
                             <div class="col-span-3">
                                <label class="block text-sm font-medium text-gray-700 mb-1">èƒŒè™Ÿ</label>
                                <input type="text" id="lp_num" readonly class="w-full p-2.5 border border-gray-300 rounded-md text-center bg-gray-100">
                             </div>
                         </div>
                         ${createInput('lp_title', 'æ¨™é¡Œæ–‡æ¡ˆ (è‡ªå‹•åŠ ä¸Š Emoji èˆ‡ å§“å)', 'text', 'å…¨é¢æ§è¡›è¦–é‡...')}
                    </div>
                    ${createTextarea('lp_content', 'çƒå“¡è¡¨ç¾æè¿°', '', 4)}
                    ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)", nextGameData)}
                `;
            } else if (mode === 'career_milestone') {
                html += `
                    ${createInput('ms_title', 'ç´€éŒ„æ¨™é¡Œ (ä¾‹å¦‚ï¼šé˜²ç·šä¸Šçš„ç›œçƒé«˜æ‰‹ï¼Œç™¾æŠ„é”æˆï¼ğŸ‘Œ)', 'text')}
                    
                    <div class="p-3 bg-gray-50 border rounded-md mb-4">
                        <p class="text-sm font-bold text-gray-700 mb-2">é”æˆçƒå“¡</p>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-4">${createTeamSelect('ms_team', 'çƒéšŠ')}</div>
                            <div class="col-span-5">${createPlayerSelect('ms_name', 'çƒå“¡', 'ms_team', 'ms_num')}</div>
                            <div class="col-span-3">
                                <label class="block text-sm font-medium text-gray-700 mb-1">èƒŒè™Ÿ</label>
                                <input type="text" id="ms_num" readonly class="w-full p-2.5 border border-gray-300 rounded-md text-center bg-gray-100">
                            </div>
                        </div>
                        <div class="mt-2">
                            ${createInput('ms_eng_name', 'è‹±æ–‡å (é¸å¡«)', 'text', 'Lasannah Kromah')}
                        </div>
                    </div>

                    ${createInput('ms_achievement', 'é”æˆæˆå°± (ä¾‹å¦‚ï¼šæ­£å¼æˆç‚º TPBL é¦–ä½é”æˆ100æ¬¡æŠ„æˆªçš„ç”·äººğŸ”¥)', 'text')}
                    ${createTextarea('ms_content', 'å…§å®¹æè¿°', '', 5)}
                `;
            } else if (mode === 'weekly_schedule') {
                html += `
                    ${createInput('week_num', 'ç¬¬å¹¾é€± (Week)', 'number', '8')}
                    ${createTextarea('week_intro', 'æœ¬é€±è³½ç¨‹å¼•è¨€', '', 4)}
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <p class="text-sm font-bold mb-2">æœ¬é€±è³½ç¨‹åˆ—è¡¨</p>
                        <div id="schedule_list_container" class="space-y-3"></div>
                        <button onclick="addScheduleItem()" class="mt-2 text-sm font-bold text-brand-gold hover:text-yellow-600">+ æ–°å¢å ´æ¬¡</button>
                    </div>
                `;
            } else if (mode === 'weekly_standings') {
                html += `
                    ${createInput('week_num', 'ç¬¬å¹¾é€± (Week)', 'number', '7')}
                    ${createTextarea('standings_content', 'æˆ°ç¸¾åˆ†ææ–‡æ¡ˆ', '', 8)}
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4">
                        <p class="text-sm font-bold mb-2">æœ¬é€±è³½ç¨‹åˆ—è¡¨ (è‡ªå‹•å¸¶å…¥ä¸‹é€±)</p>
                        <div id="standings_schedule_list_container" class="space-y-3"></div>
                        <button onclick="addStandingsGameItem()" class="mt-2 text-sm font-bold text-brand-gold hover:text-yellow-600">+ æ–°å¢é å‘Šå ´æ¬¡</button>
                    </div>
                `;
            } else if (mode === 'top5') {
                 html += `
                    ${createInput('week_num', 'ç¬¬å¹¾é€± (Week)', 'number', '7')}
                    ${createTextarea('top5_intro', 'å¼•è¨€æ–‡æ¡ˆ', '', 3)}
                    <div class="space-y-3 mt-4">
                        <p class="text-sm font-bold text-gray-500">äº”å¤§å¥½çƒæ’è¡Œ</p>
                        ${[1,2,3,4,5].map(i => `
                            <div class="p-3 border rounded-md bg-gray-50">
                                <span class="font-bold text-gray-700 block mb-1">ç¬¬ ${i} å</span>
                                <div class="grid grid-cols-3 gap-2">
                                    ${createTeamSelect(`top${i}_team`, '')}
                                    ${createPlayerSelect(`top${i}_name`, '', `top${i}_team`, `top${i}_num`)}
                                    <input id="top${i}_num" type="text" readonly placeholder="èƒŒè™Ÿ" class="w-full p-2.5 border border-gray-300 rounded-md text-sm text-center bg-gray-100">
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    ${createInput('vote_link', 'æŠ•ç¥¨é€£çµ', 'text')}
                `;
            } else if (mode === 'potw') {
                html += `
                    <div class="grid grid-cols-2 gap-4">
                        ${createTeamSelect('player_team', 'æ‰€å±¬éšŠä¼')}
                        <div>
                             <label class="block text-sm font-medium text-gray-700 mb-1">çƒå“¡</label>
                             <select id="player_name_select" data-team-select="player_team" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold focus:border-brand-gold player-select disabled-input" disabled>
                                <option>å…ˆé¸æ“‡çƒéšŠ</option>
                             </select>
                             <input type="hidden" id="player_num_dummy">
                             <p class="text-xs text-gray-400 mt-1">*è«‹æ‰‹å‹•è£œä¸Šè‹±æ–‡å</p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-2">
                        <p class="text-sm font-bold mb-2">æœ¬é€±æ•¸æ“š (STATS)</p>
                        <div id="stats_list_container" class="space-y-2"></div>
                        <button onclick="addStatItem()" class="mt-2 text-sm font-bold text-brand-gold hover:text-yellow-600">+ æ–°å¢æ•¸æ“š</button>
                    </div>
                    
                    ${createTextarea('player_desc', 'çƒå“¡è¡¨ç¾æè¿°', '', 6)}
                    ${createNextGameBlock("ä¸‹å ´è³½äº‹è³‡è¨Š (Next Game)", nextGameData)}
                `;
            } else if (mode === 'weekly_local_eff') {
                html += `
                    ${createInput('week_num', 'ç¬¬å¹¾é€± (Week)', 'number', '7')}
                    ${createTextarea('eff_intro', 'å¼•è¨€æ–‡æ¡ˆ', '', 3)}
                    <div class="space-y-3 mt-4">
                         <p class="text-sm font-bold text-gray-500">æœ¬åœŸæ•ˆç‡å€¼æ’è¡Œ</p>
                         ${[1,2,3,4,5].map(i => `
                            <div class="p-3 border rounded-md bg-gray-50">
                                <div class="grid grid-cols-12 gap-2 mb-2 items-center">
                                    <div class="col-span-1 flex items-center justify-center font-bold text-gray-500">#${i}</div>
                                    <div class="col-span-4">
                                        ${createTeamSelect(`eff${i}_team`, '')}
                                    </div>
                                    <div class="col-span-2">
                                        <input id="eff${i}_num" type="text" readonly placeholder="#" class="w-full p-2.5 border border-gray-300 rounded-md text-sm text-center bg-gray-100">
                                    </div>
                                    <div class="col-span-3">
                                        ${createPlayerSelect(`eff${i}_name`, '', `eff${i}_team`, `eff${i}_num`)}
                                    </div>
                                    <div class="col-span-2"><input id="eff${i}_val" type="text" placeholder="EFF" class="w-full p-2.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-brand-gold focus:border-brand-gold"></div>
                                </div>
                                <textarea id="eff${i}_desc" rows="2" class="w-full p-2.5 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-brand-gold focus:border-brand-gold" placeholder="çƒå“¡è¡¨ç¾æè¿°..."></textarea>
                            </div>
                         `).join('')}
                    </div>
                `;
            } else if (mode === 'monthly_kicks') {
                html += `
                    ${createSelect('kicks_month', 'æœˆä»½', MONTHS)}
                    ${createTextarea('kicks_intro', 'å¼•è¨€æ–‡æ¡ˆ', '', 4)}
                `;
            } else if (mode === 'season_stats') {
                html += `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">æ¨™é¡Œå¾Œç¶´</label>
                        <select id="stats_title_suffix" class="w-full p-2.5 border border-gray-300 rounded-md bg-white focus:ring-2 focus:ring-brand-gold">
                            <option value="TEAM">TEAM</option>
                            <option value="PLAYER">PLAYER</option>
                        </select>
                    </div>
                    ${createTextarea('stats_content', 'æ•¸æ“šåˆ†ææ–‡æ¡ˆ', '', 8)}
                    
                    <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 mt-4">
                        <p class="text-xs font-bold text-gray-500 mb-2 uppercase">çµ±è¨ˆå€é–“</p>
                        <div class="mb-3">
                             ${createInput('stats_cutoff_date', 'çµ±è¨ˆæˆªæ­¢æ—¥', 'date', '', today)}
                        </div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">åŒ…å«è³½å­£</label>
                        <div class="flex gap-4 items-center">
                            <label class="flex items-center gap-2"><input type="checkbox" id="season_2425" checked class="w-4 h-4 text-brand-gold focus:ring-brand-gold border-gray-300 rounded"> 24-25è³½å­£</label>
                            <label class="flex items-center gap-2"><input type="checkbox" id="season_2526" class="w-4 h-4 text-brand-gold focus:ring-brand-gold border-gray-300 rounded"> 25-26è³½å­£</label>
                        </div>
                    </div>
                    
                    <div class="mt-4 bg-gray-50 p-4 rounded-lg border border-gray-200">
                        <p class="text-xs font-bold text-gray-500 mb-2 uppercase">æŠ•ç¥¨è³‡è¨Š</p>
                        ${createInput('stats_vote_month', 'æŠ•ç¥¨æœˆä»½/å€é–“ (ä¾‹å¦‚ï¼š10-11)', 'text', '10-11')}
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // --- Robust Event Binding (with Auto-fill Logic) ---
        function bindDynamicEvents() {
            const container = document.getElementById('dynamic-form');
            if(!container) return;

            // Team Select Logic
            const teamSelects = container.querySelectorAll('.team-select');
            teamSelects.forEach(select => {
                select.addEventListener('change', function() {
                    populatePlayers(this);
                });
            });

            // Player Select Logic
            const playerSelects = container.querySelectorAll('.player-select');
            playerSelects.forEach(select => {
                select.addEventListener('change', function() {
                    const numInputId = this.dataset.numInput;
                    if (numInputId) {
                        const numInput = document.getElementById(numInputId);
                        if (numInput) {
                            const selectedOption = this.options[this.selectedIndex];
                            numInput.value = selectedOption.dataset.num || "";
                        }
                    }

                    // NEW: Local Player Highlight - update next game
                    if (currentMode === 'local_player_highlight' && this.id === 'lp_name') {
                        const teamSelect = document.getElementById('lp_team');
                        if (teamSelect) {
                            const today = new Date().toISOString().split('T')[0];
                            const nextGame = getNextGameForTeam(teamSelect.value, today);
                            if (nextGame) {
                                fillGameFields('next_date', nextGame);
                            }
                        }
                    }
                });
            });
            
            // --- Date Input Auto-fill ---
            const dateInputs = container.querySelectorAll('.date-input');
            dateInputs.forEach(input => {
                input.addEventListener('change', function() {
                    const newDate = this.value;
                    const games = getGamesOnDate(newDate);
                    
                    if (games.length > 0) {
                        const firstGame = games[0];
                        fillGameFields(this.id, firstGame);
                    }
                });
            });

            // --- Time Select Auto-fill ---
            const timeSelects = container.querySelectorAll('.time-select');
            timeSelects.forEach(select => {
                select.addEventListener('change', function() {
                    const prefix = this.id.replace('time', ''); 
                    const dateInput = document.getElementById(prefix + 'date');
                    if (dateInput) {
                        const date = dateInput.value;
                        const time = this.value;
                        const game = getGameByDateTime(date, time);
                        if (game) {
                            fillGameFields(dateInput.id, game, false); 
                        }
                    }
                });
            });
            
            // --- Game Number Input Logic ---
            const numInputs = container.querySelectorAll('input[type="number"][id$="game_num"]');
            numInputs.forEach(input => {
                input.addEventListener('change', function() {
                    const gameNum = this.value;
                    const game = getGameByNum(gameNum);
                    
                    if (game) {
                        const prefix = this.id.replace('game_num', '');
                        // If this is "Next Game" block or just game_num, the prefix handles it
                        fillGameFields(prefix + 'date', game); 
                    }
                    
                    // Main game number changed -> Update Next Game Block automatically (Game N+1)
                    if ((currentMode === 'final_score' || currentMode === 'potg') && this.id === 'game_num') {
                        const nextGame = getNextGameInLeague(gameNum);
                        if (nextGame) {
                            fillGameFields('next_date', nextGame);
                        }
                    }
                });
            });
            
            // --- Press Conf Team Change Logic ---
            if (currentMode === 'press_conf') {
                const teamSelect = document.getElementById('pc_team');
                if (teamSelect) {
                    teamSelect.addEventListener('change', function() {
                        const today = new Date().toISOString().split('T')[0];
                        const nextGame = getNextGameForTeam(this.value, today);
                        if (nextGame) {
                            fillGameFields('next_date', nextGame);
                        }
                    });
                }
            }

            // --- Weekly Schedule & Standings Logic ---
            if (currentMode === 'weekly_schedule' || currentMode === 'weekly_standings') {
                const weekInput = document.getElementById('week_num');
                if (weekInput) {
                    weekInput.addEventListener('change', function() {
                        const weekNum = parseInt(this.value);
                        if(!isNaN(weekNum)) {
                            let offset = 0;
                            let listId = 'schedule_list_container';
                            let addFn = addScheduleItem;
                            
                            if (currentMode === 'weekly_standings') {
                                offset = 1; // Show Next Week
                                listId = 'standings_schedule_list_container';
                                addFn = addStandingsGameItem;
                            }

                            const list = document.getElementById(listId);
                            if (list) {
                                list.innerHTML = ''; // Clear
                                // Anchor Week 8 = 2025-12-01 (Mon)
                                const anchorTime = new Date('2025-12-01').getTime();
                                const targetWeekNum = weekNum + offset;
                                const targetTime = anchorTime + (targetWeekNum - 8) * 7 * 24 * 60 * 60 * 1000;
                                const start = new Date(targetTime);
                                const end = new Date(targetTime + 6 * 24 * 60 * 60 * 1000);
                                
                                const startStr = start.toISOString().split('T')[0];
                                const endStr = end.toISOString().split('T')[0];
                                
                                const games = SEASON_SCHEDULE.filter(g => g.date >= startStr && g.date <= endStr);
                                
                                if (games.length > 0) {
                                    games.forEach(g => addFn(g));
                                } else {
                                    addFn();
                                }
                            }
                        }
                    });
                }
            }
        }
        
        // Helper to fill fields
        function fillGameFields(triggerId, gameData, updateTime = true) {
            // Base prefix from the trigger (e.g. 'next_date' -> 'next_')
            let prefix = triggerId.replace('date', ''); 
            
            // Intelligent Prefix Detection for Mixed IDs (e.g. Game Preview uses match_date but game_num)
            // If prefix is empty, but we don't have a 'date' input, check for 'match_date'
            if (prefix === '' && !document.getElementById('date')) {
                if (document.getElementById('match_date')) {
                    prefix = 'match_';
                }
            }

            const setVal = (id, val) => {
                const el = document.getElementById(id);
                if (el) {
                    el.value = val;
                    // If it's a team select, we must trigger the player population
                    if(el.classList.contains('team-select')) {
                        populatePlayers(el);
                    }
                    // Dispatch change event for text/number inputs too if needed, 
                    // but mainly needed for selects to trigger downstream logic if any.
                    if(el.tagName === 'SELECT') el.dispatchEvent(new Event('change'));
                }
            };

            setVal(prefix + 'date', gameData.date); 
            if (updateTime) setVal(prefix + 'time', gameData.time);
            
            // Handle Game Num
            // Check specific prefix first, then fallback to global 'game_num' if appropriate
            if (document.getElementById(prefix + 'game_num')) {
                setVal(prefix + 'game_num', gameData.game_num);
            } else if (prefix === 'match_' && document.getElementById('game_num')) {
                 // Game Preview case: prefix is match_ (for date/time) but game_num has no prefix
                 setVal('game_num', gameData.game_num);
            }

            // Update Team Fields
            // Strategy: Try most specific first
            if (document.getElementById(prefix + 'home_team')) {
                setVal(prefix + 'home_team', gameData.home);
                setVal(prefix + 'away_team', gameData.away);
            } else if (document.getElementById(prefix + 'home')) {
                setVal(prefix + 'home', gameData.home);
                setVal(prefix + 'away', gameData.away);
            } else if (prefix === 'match_' && document.getElementById('home_team')) {
                 // Game Preview/Weekday fallback
                 setVal('home_team', gameData.home);
                 setVal('away_team', gameData.away);
            }
            
            // Specific Mode overrides that might not match the prefix strictly
            if (currentMode === 'matchup_highlight' && (prefix === 'next_' || prefix === '')) {
                 // Assuming the main game data drives the matchup selections
                 // But matchup highlight actually has 'next_' block for "Today's Game"
                 // If we update "Today's Game", we likely want to update the matchup selectors too?
                 // User request 2 from previous turn: "è³½å‰å°æˆ°äº®é»...ä¸‹æ–¹çš„å°æˆ°çµ„åˆçƒéšŠï¼Œå¯ä»¥ä¹Ÿè‡ªå‹•æ›´æ–°å—"
                 // If fillGameFields is called for the top block (next_date), we also update mu_ fields
                 setVal('mu_home_team', gameData.home);
                 setVal('mu_away_team', gameData.away);
            }
            
            if (currentMode === 'potg' && (prefix === '' || prefix === 'potg_')) { 
                // POTG uses potg_home/away. If triggered by generic logic, ensure we map it.
                setVal('potg_home', gameData.home);
                setVal('potg_away', gameData.away);
            } else if (currentMode === 'local_player_highlight') {
                // If updating the main game info (which might be inferred), update lp_team
                // Wait, Local Player Highlight has LP_TEAM and LP_NAME at top, and NEXT_GAME at bottom.
                // The request was "æœ¬åœŸçƒå“¡...ä¸‹æ–¹çš„ä¸‹å ´è³½äº‹è³‡è¨Š...è®Šå‹•". This is handled by listener in bindDynamicEvents.
                // This block handles if we auto-fill the TOP block.
                if (prefix === 'lp_' || prefix === '') {
                     setVal('lp_team', gameData.home);
                }
            }
        }

        // ... (Rest of code same) ...
